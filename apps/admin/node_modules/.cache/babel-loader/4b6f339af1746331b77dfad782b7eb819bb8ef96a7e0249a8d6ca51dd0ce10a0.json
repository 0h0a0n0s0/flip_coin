{"ast":null,"code":"import { ElMessage } from 'element-plus';\nconst createTodayRange = () => {\n  const start = new Date();\n  start.setHours(0, 0, 0, 0);\n  const end = new Date();\n  end.setHours(23, 59, 59, 999);\n  return [start, end];\n};\nconst toIsoRange = range => {\n  if (!Array.isArray(range) || range.length !== 2) return null;\n  const [start, end] = range;\n  const startIso = start instanceof Date && !isNaN(start) ? start.toISOString() : null;\n  const endIso = end instanceof Date && !isNaN(end) ? end.toISOString() : null;\n  if (!startIso || !endIso) return null;\n  return [startIso, endIso];\n};\nexport default {\n  name: 'CollectionLogsView',\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      totalItems: 0,\n      pageTotalAmount: 0,\n      totalAmount: 0,\n      pagination: {\n        page: 1,\n        limit: 10\n      },\n      searchParams: {\n        userId: '',\n        user_deposit_address: '',\n        collection_wallet_address: '',\n        status: '',\n        dateRange: createTodayRange()\n      }\n    };\n  },\n  created() {\n    this.handleSearch();\n  },\n  methods: {\n    async fetchLogs() {\n      if (this.loading) return;\n      this.loading = true;\n      try {\n        const isoRange = toIsoRange(this.searchParams.dateRange);\n        const params = {\n          ...this.pagination,\n          userId: this.searchParams.userId || undefined,\n          user_deposit_address: this.searchParams.user_deposit_address || undefined,\n          collection_wallet_address: this.searchParams.collection_wallet_address || undefined,\n          status: this.searchParams.status || undefined,\n          dateRange: isoRange ? JSON.stringify(isoRange) : undefined\n        };\n        const response = await this.$api.getCollectionLogs(params);\n        this.tableData = response.list;\n        this.totalItems = response.total;\n        this.pageTotalAmount = response.pageTotalAmount || 0;\n        this.totalAmount = response.totalAmount || 0;\n      } catch (error) {\n        console.error('Failed to fetch collection logs:', error);\n        ElMessage.error('载入归集记录失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleSearch() {\n      this.pagination.page = 1;\n      this.fetchLogs();\n    },\n    handleSizeChange(newLimit) {\n      this.pagination.limit = newLimit;\n      this.pagination.page = 1;\n      this.fetchLogs();\n    },\n    handlePageChange(newPage) {\n      this.pagination.page = newPage;\n      this.fetchLogs();\n    },\n    formatCurrency(value) {\n      if (value === null || value === undefined) return '0.00';\n      const num = parseFloat(value);\n      if (isNaN(num)) return '0.00';\n      return num.toFixed(2);\n    },\n    formatDateTime(dateStr) {\n      if (!dateStr) return '-';\n      const date = new Date(dateStr);\n      return date.toLocaleString('zh-TW', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      });\n    },\n    getStatusType(status) {\n      const statusMap = {\n        'completed': 'success',\n        'failed': 'danger',\n        'pending': 'warning'\n      };\n      return statusMap[status] || 'info';\n    },\n    getStatusText(status) {\n      const statusMap = {\n        'completed': '已完成',\n        'failed': '失败',\n        'pending': '处理中'\n      };\n      return statusMap[status] || status;\n    },\n    renderSummary({\n      columns\n    }) {\n      const sums = [];\n      columns.forEach((column, index) => {\n        if (column.property === 'amount') {\n          const pageSum = `${this.formatCurrency(this.pageTotalAmount)} USDT`;\n          const totalSum = `${this.formatCurrency(this.totalAmount)} USDT`;\n          sums[index] = `页面总计：${pageSum}\\n全部查询结果总计：${totalSum}`;\n        } else {\n          sums[index] = '';\n        }\n      });\n      return sums;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}