{"ast":null,"code":"// 档案: admin-ui/src/store.js (新档案 - v7.4 修正版)\n\nimport { reactive } from 'vue';\nimport * as api from './api';\nconst permissionsStore = reactive({\n  permissions: {},\n  isLoaded: false,\n  // (★★★ 1. 新增狀态 ★★★)\n\n  has(resource, action) {\n    return this.permissions[`${resource}:${action}`] === true;\n  },\n  async loadPermissions() {\n    if (this.isLoaded) return; // (★★★ 2. 防止重复加载 ★★★)\n    try {\n      const perms = await api.getMyPermissions();\n      this.permissions = perms;\n      this.isLoaded = true; // (★★★ 3. 标记为已加载 ★★★)\n      console.log('[RBAC Store] Permissions loaded.');\n    } catch (error) {\n      console.error('[RBAC Store] Failed to load permissions:', error);\n      this.permissions = {};\n      this.isLoaded = false;\n      throw error; // (将错误拋给 router guard 处理)\n    }\n  },\n  clearPermissions() {\n    this.permissions = {};\n    this.isLoaded = false; // (★★★ 4. 重置狀态 ★★★)\n  }\n});\nexport default permissionsStore;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}