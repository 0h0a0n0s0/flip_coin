{"ast":null,"code":"// ( ... <script> 标签内的逻辑保持不变 ... )\nimport { ElMessage, ElMessageBox } from 'element-plus';\nexport default {\n  name: 'WalletMonitoringView',\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      totalItems: 0,\n      pagination: {\n        page: 1,\n        limit: 10\n      },\n      searchParams: {\n        name: '',\n        chain_type: '',\n        address: ''\n      },\n      dialogVisible: false,\n      dialogTitle: '',\n      submitLoading: false,\n      walletForm: {\n        id: null,\n        name: '',\n        chain_type: 'TRC20',\n        address: '',\n        is_gas_reserve: false,\n        is_collection: false,\n        is_opener_a: false,\n        is_opener_b: false,\n        is_payout: false,\n        is_active: true,\n        scan_interval_days: 1,\n        days_without_deposit: 7\n      },\n      formRules: {\n        name: [{\n          required: true,\n          message: '请输入钱包名称',\n          trigger: 'blur'\n        }],\n        chain_type: [{\n          required: true,\n          message: '请选择公链类型',\n          trigger: 'change'\n        }],\n        address: [{\n          required: true,\n          message: '请输入钱包地址',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.fetchWallets();\n  },\n  methods: {\n    async fetchWallets() {\n      if (this.loading) return;\n      this.loading = true;\n      try {\n        const params = {\n          ...this.pagination,\n          name: this.searchParams.name || undefined,\n          chain_type: this.searchParams.chain_type || undefined,\n          address: this.searchParams.address || undefined\n        };\n        const response = await this.$api.getWallets(params);\n        this.tableData = response.list;\n        this.totalItems = response.total;\n      } catch (error) {\n        console.error('Failed to fetch wallets:', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleSearch() {\n      this.pagination.page = 1;\n      this.fetchWallets();\n    },\n    handleSizeChange(newLimit) {\n      this.pagination.limit = newLimit;\n      this.pagination.page = 1;\n      this.fetchWallets();\n    },\n    handlePageChange(newPage) {\n      this.pagination.page = newPage;\n      this.fetchWallets();\n    },\n    getEmptyForm() {\n      return {\n        id: null,\n        name: '',\n        chain_type: 'TRC20',\n        address: '',\n        is_gas_reserve: false,\n        is_collection: false,\n        is_opener_a: false,\n        is_opener_b: false,\n        is_payout: false,\n        is_active: true,\n        scan_interval_days: 1,\n        days_without_deposit: 7\n      };\n    },\n    handleAdd() {\n      this.dialogTitle = '新增平台钱包';\n      Object.assign(this.walletForm, this.getEmptyForm());\n      this.dialogVisible = true;\n      this.$nextTick(() => {\n        this.$refs.walletFormRef?.clearValidate();\n      });\n    },\n    async handleEdit(row) {\n      this.dialogTitle = '编辑平台钱包';\n      Object.assign(this.walletForm, {\n        id: row.id,\n        name: row.name,\n        chain_type: row.chain_type,\n        address: row.address,\n        is_gas_reserve: row.is_gas_reserve,\n        is_collection: row.is_collection,\n        is_opener_a: row.is_opener_a,\n        is_opener_b: row.is_opener_b,\n        is_payout: row.is_payout,\n        is_active: row.is_active,\n        scan_interval_days: 1,\n        days_without_deposit: 7\n      });\n\n      // 如果是归集钱包，载入归集设定\n      if (row.is_collection && row.address) {\n        try {\n          const settings = await this.$api.getCollectionSettings();\n          const walletSetting = settings.find(s => s.collection_wallet_address === row.address);\n          if (walletSetting) {\n            this.walletForm.scan_interval_days = walletSetting.scan_interval_days;\n            this.walletForm.days_without_deposit = walletSetting.days_without_deposit;\n          }\n        } catch (error) {\n          console.error('Failed to load collection settings:', error);\n        }\n      }\n      this.dialogVisible = true;\n      this.$nextTick(() => {\n        this.$refs.walletFormRef?.clearValidate();\n      });\n    },\n    async handleSubmit() {\n      const formEl = this.$refs.walletFormRef;\n      if (!formEl) return;\n      await formEl.validate(async valid => {\n        if (valid) {\n          this.submitLoading = true;\n          try {\n            if (this.walletForm.id) {\n              await this.$api.updateWallet(this.walletForm.id, this.walletForm);\n\n              // 如果是归集钱包，更新归集设定\n              if (this.walletForm.is_collection && this.walletForm.address) {\n                try {\n                  await this.$api.updateCollectionSettings({\n                    collection_wallet_address: this.walletForm.address,\n                    scan_interval_days: this.walletForm.scan_interval_days,\n                    days_without_deposit: this.walletForm.days_without_deposit,\n                    is_active: true\n                  });\n                } catch (error) {\n                  console.error('Failed to update collection settings:', error);\n                }\n              }\n              ElMessage.success('钱包更新成功');\n            } else {\n              await this.$api.addWallet(this.walletForm);\n\n              // 如果是归集钱包，創建归集设定\n              if (this.walletForm.is_collection && this.walletForm.address) {\n                try {\n                  await this.$api.updateCollectionSettings({\n                    collection_wallet_address: this.walletForm.address,\n                    scan_interval_days: this.walletForm.scan_interval_days,\n                    days_without_deposit: this.walletForm.days_without_deposit,\n                    is_active: true\n                  });\n                } catch (error) {\n                  console.error('Failed to create collection settings:', error);\n                }\n              }\n              ElMessage.success('钱包新增成功');\n            }\n            this.dialogVisible = false;\n            this.fetchWallets();\n          } catch (error) {\n            console.error('Failed to submit wallet:', error);\n            ElMessage.error('操作失败：' + (error.response?.data?.error || error.message));\n          } finally {\n            this.submitLoading = false;\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    handleDelete(row) {\n      ElMessageBox.confirm(`确定要刪除钱包 \"${row.name}\" (${row.address}) 吗？`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          await this.$api.deleteWallet(row.id);\n          ElMessage.success('钱包刪除成功');\n          this.fetchWallets();\n        } catch (error) {\n          console.error('Failed to delete wallet:', error);\n        }\n      }).catch(() => {});\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}