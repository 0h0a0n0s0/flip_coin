{"ast":null,"code":"import { ElMessage, ElMessageBox } from 'element-plus';\nimport { getSameIpSummary, getUsersByIp, banUsersByIp, unbanUsersByIp } from '@/api';\nexport default {\n  name: 'SameIpMonitor',\n  data() {\n    return {\n      loading: false,\n      ipList: [],\n      threshold: '-',\n      detailDialog: {\n        visible: false,\n        ip: '',\n        loading: false,\n        users: []\n      }\n    };\n  },\n  created() {\n    this.fetchSummary();\n  },\n  methods: {\n    async fetchSummary() {\n      this.loading = true;\n      try {\n        const response = await getSameIpSummary();\n        this.threshold = response.threshold ?? '-';\n        this.ipList = response.list || [];\n      } catch (error) {\n        console.error('Failed to fetch same IP summary:', error);\n        ElMessage.error('载入同 IP 风控资料失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    formatDateTime(value) {\n      if (!value) return '-';\n      try {\n        return new Date(value).toLocaleString('zh-TW', {\n          timeZone: 'Asia/Taipei'\n        });\n      } catch (e) {\n        return value;\n      }\n    },\n    async handleViewDetail(row) {\n      this.detailDialog.visible = true;\n      this.detailDialog.ip = row.ip_address;\n      this.detailDialog.loading = true;\n      this.detailDialog.users = [];\n      try {\n        const response = await getUsersByIp(row.ip_address);\n        this.detailDialog.users = response.list || [];\n      } catch (error) {\n        console.error('Failed to fetch users by IP:', error);\n        ElMessage.error('载入用户详情失败');\n      } finally {\n        this.detailDialog.loading = false;\n      }\n    },\n    async handleBan(row) {\n      try {\n        await ElMessageBox.confirm(`确定要封锁 IP ${row.ip_address} 下的所有用户吗？`, '封锁确认', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        await banUsersByIp(row.ip_address);\n        ElMessage.success('封锁成功');\n        this.fetchSummary();\n        if (this.detailDialog.visible && this.detailDialog.ip === row.ip_address) {\n          this.handleViewDetail(row);\n        }\n      } catch (error) {\n        if (error !== 'cancel') {\n          console.error('Failed to ban users by IP:', error);\n          ElMessage.error(error.response?.data?.error || '封锁失败');\n        }\n      }\n    },\n    async handleUnban(row) {\n      try {\n        await ElMessageBox.confirm(`确定要解禁 IP ${row.ip_address} 下的所有用户吗？`, '解禁确认', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        await unbanUsersByIp(row.ip_address);\n        ElMessage.success('解禁成功');\n        this.fetchSummary();\n        if (this.detailDialog.visible && this.detailDialog.ip === row.ip_address) {\n          this.handleViewDetail(row);\n        }\n      } catch (error) {\n        if (error !== 'cancel') {\n          console.error('Failed to unban users by IP:', error);\n          ElMessage.error(error.response?.data?.error || '解禁失败');\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}