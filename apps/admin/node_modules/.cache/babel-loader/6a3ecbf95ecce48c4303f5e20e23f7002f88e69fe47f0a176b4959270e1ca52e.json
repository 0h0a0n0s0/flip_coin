{"ast":null,"code":"import * as echarts from 'echarts';\nimport { Refresh, User, Coin, Link as Connection, WarningFilled as Warning, Document, Money, Wallet as CreditCard, DataLine as TrendCharts, Box, Lightning } from '@element-plus/icons-vue';\nexport default {\n  name: 'DashboardView',\n  components: {\n    Refresh,\n    User,\n    Coin,\n    Connection,\n    Warning,\n    Document,\n    Money,\n    CreditCard,\n    TrendCharts,\n    Box,\n    Lightning\n  },\n  data() {\n    return {\n      loading: true,\n      walletLoading: false,\n      stats: null,\n      walletMonitoring: null,\n      chartPeriod: 'today',\n      chartInstance: null\n    };\n  },\n  watch: {\n    chartPeriod() {\n      this.updateChart();\n    },\n    stats: {\n      handler() {\n        this.$nextTick(() => {\n          this.updateChart();\n        });\n      },\n      deep: true\n    }\n  },\n  async created() {\n    await Promise.all([this.fetchStats(), this.fetchWalletMonitoring()]);\n  },\n  mounted() {\n    this.initChart();\n  },\n  beforeUnmount() {\n    if (this.chartInstance) {\n      this.chartInstance.dispose();\n    }\n  },\n  methods: {\n    async fetchStats() {\n      this.loading = true;\n      try {\n        const data = await this.$api.getDashboardStats();\n        this.stats = data;\n      } catch (error) {\n        console.error('Failed to fetch stats:', error);\n        this.$message.error('獲取統計數據失敗');\n      } finally {\n        this.loading = false;\n      }\n    },\n    async fetchWalletMonitoring() {\n      this.walletLoading = true;\n      try {\n        const data = await this.$api.getWalletMonitoring();\n        this.walletMonitoring = data;\n      } catch (error) {\n        console.error('Failed to fetch wallet monitoring:', error);\n        this.$message.error('獲取錢包監控數據失敗');\n      } finally {\n        this.walletLoading = false;\n      }\n    },\n    async refreshWallets() {\n      await this.fetchWalletMonitoring();\n      this.$message.success('錢包數據已刷新');\n    },\n    async refreshAll() {\n      await Promise.all([this.fetchStats(), this.fetchWalletMonitoring()]);\n      this.$message.success('數據已刷新');\n    },\n    initChart() {\n      if (!this.$refs.chartContainer) return;\n      this.chartInstance = echarts.init(this.$refs.chartContainer);\n      this.updateChart();\n      window.addEventListener('resize', this.handleResize);\n    },\n    handleResize() {\n      if (this.chartInstance) {\n        this.chartInstance.resize();\n      }\n    },\n    updateChart() {\n      if (!this.chartInstance || !this.stats) return;\n      const periodData = [{\n        name: '當日',\n        data: this.stats.today\n      }, {\n        name: '當周',\n        data: this.stats.week\n      }, {\n        name: '當月',\n        data: this.stats.month\n      }, {\n        name: '上月',\n        data: this.stats.lastMonth\n      }];\n      const currentIndex = ['today', 'week', 'month', 'lastMonth'].indexOf(this.chartPeriod);\n      const selectedData = periodData[currentIndex];\n      const option = {\n        tooltip: {\n          trigger: 'axis',\n          axisPointer: {\n            type: 'cross'\n          },\n          formatter: params => {\n            let result = `<div style=\"margin-bottom: 4px; font-weight: bold;\">${params[0].axisValue}</div>`;\n            params.forEach(param => {\n              const value = param.value >= 0 ? param.value : -param.value;\n              const sign = param.value >= 0 ? '' : '-';\n              result += `<div style=\"margin: 2px 0;\">\n                <span style=\"display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: ${param.color}; margin-right: 5px;\"></span>\n                ${param.seriesName}: ${sign}${this.formatNumber(value)} USDT\n              </div>`;\n            });\n            return result;\n          }\n        },\n        legend: {\n          data: ['投注金額', '派獎金額', '盈虧'],\n          top: 10\n        },\n        grid: {\n          left: '3%',\n          right: '4%',\n          bottom: '3%',\n          top: '15%',\n          containLabel: true\n        },\n        xAxis: {\n          type: 'category',\n          boundaryGap: false,\n          data: periodData.map(item => item.name)\n        },\n        yAxis: {\n          type: 'value',\n          axisLabel: {\n            formatter: value => {\n              if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';\n              if (value >= 1000) return (value / 1000).toFixed(1) + 'K';\n              return value.toFixed(0);\n            }\n          }\n        },\n        series: [{\n          name: '投注金額',\n          type: 'line',\n          smooth: true,\n          data: periodData.map(item => item.data.totalBetAmount),\n          itemStyle: {\n            color: '#409EFF'\n          },\n          areaStyle: {\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n              offset: 0,\n              color: 'rgba(64, 158, 255, 0.3)'\n            }, {\n              offset: 1,\n              color: 'rgba(64, 158, 255, 0.1)'\n            }])\n          }\n        }, {\n          name: '派獎金額',\n          type: 'line',\n          smooth: true,\n          data: periodData.map(item => item.data.totalPayout),\n          itemStyle: {\n            color: '#67C23A'\n          },\n          areaStyle: {\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n              offset: 0,\n              color: 'rgba(103, 194, 58, 0.3)'\n            }, {\n              offset: 1,\n              color: 'rgba(103, 194, 58, 0.1)'\n            }])\n          }\n        }, {\n          name: '盈虧',\n          type: 'line',\n          smooth: true,\n          data: periodData.map(item => item.data.profitLoss),\n          itemStyle: {\n            color: '#E6A23C'\n          },\n          markLine: {\n            data: [{\n              yAxis: 0,\n              lineStyle: {\n                color: '#909399',\n                type: 'dashed'\n              }\n            }]\n          }\n        }]\n      };\n      this.chartInstance.setOption(option);\n    },\n    getCurrentPeriodData() {\n      if (!this.stats) return {\n        betCount: 0,\n        totalBetAmount: 0,\n        totalPayout: 0,\n        profitLoss: 0\n      };\n      return this.stats[this.chartPeriod] || {\n        betCount: 0,\n        totalBetAmount: 0,\n        totalPayout: 0,\n        profitLoss: 0\n      };\n    },\n    formatNumber(num) {\n      if (num === null || num === undefined) return '0.00';\n      return parseFloat(num).toLocaleString('zh-TW', {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n      });\n    },\n    formatBalance(balance, decimals = 6) {\n      if (!balance || balance === '0' || balance === 0) return '0';\n      const num = parseFloat(balance);\n      return num.toLocaleString('zh-TW', {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: decimals === 0 ? 0 : 6\n      });\n    },\n    maskAddress(address) {\n      if (!address) return '';\n      if (address.length <= 10) return address;\n      return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}