{"ast":null,"code":"const createTodayRange = () => {\n  const start = new Date();\n  start.setHours(0, 0, 0, 0);\n  const end = new Date();\n  end.setHours(23, 59, 59, 999);\n  return [start, end];\n};\nexport default {\n  name: 'DepositHistory',\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      totalItems: 0,\n      pagination: {\n        page: 1,\n        limit: 10\n      },\n      searchParams: {\n        username: '',\n        user_id: '',\n        status: '',\n        tx_hash: '',\n        dateRange: createTodayRange()\n      }\n    };\n  },\n  created() {\n    this.handleSearch();\n  },\n  methods: {\n    async fetchData() {\n      if (this.loading) return;\n      this.loading = true;\n      try {\n        const params = {\n          ...this.pagination,\n          username: this.searchParams.username || undefined,\n          status: this.searchParams.status || undefined,\n          tx_hash: this.searchParams.tx_hash || undefined,\n          user_id: this.searchParams.user_id || undefined\n        };\n        if (this.searchParams.dateRange && this.searchParams.dateRange.length === 2) {\n          const [start, end] = this.searchParams.dateRange;\n          if (start instanceof Date && !isNaN(start)) {\n            params.start_time = start.toISOString();\n          }\n          if (end instanceof Date && !isNaN(end)) {\n            params.end_time = end.toISOString();\n          }\n        }\n        // (★★★ v8.1 调用新 API ★★★)\n        const response = await this.$api.getDeposits(params);\n        this.tableData = response.list;\n        this.totalItems = response.total;\n      } catch (error) {\n        console.error('Failed to fetch deposits:', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleSearch() {\n      this.pagination.page = 1;\n      this.fetchData();\n    },\n    handleSizeChange(newLimit) {\n      this.pagination.limit = newLimit;\n      this.pagination.page = 1;\n      this.fetchData();\n    },\n    handlePageChange(newPage) {\n      this.pagination.page = newPage;\n      this.fetchData();\n    },\n    // --- (格式化辅助函数) ---\n    formatDateTime(isoString) {\n      if (!isoString) return '';\n      try {\n        return new Date(isoString).toLocaleString('zh-TW', {\n          timeZone: 'Asia/Taipei'\n        });\n      } catch (e) {\n        return isoString;\n      }\n    },\n    formatStatus(status) {\n      // (目前 TronListener 只会寫入 completed)\n      const map = {\n        'pending': '待处理',\n        'completed': '已完成',\n        'failed': '失败'\n      };\n      return map[status] || status;\n    },\n    getStatusTagType(status) {\n      const map = {\n        'pending': 'warning',\n        'completed': 'success',\n        'failed': 'danger'\n      };\n      return map[status] || 'info';\n    },\n    formatCurrency(value) {\n      if (value === null || value === undefined) return '0.00';\n      const num = parseFloat(value);\n      if (isNaN(num)) return 'N/A';\n      return num.toFixed(2);\n    },\n    getTxLink(chain, hash) {\n      if (chain === 'TRC20') return `https://nile.tronscan.org/#/transaction/${hash}`;\n      if (chain === 'BSC') return `https://testnet.bscscan.com/tx/${hash}`;\n      if (chain === 'ETH') return `https://sepolia.etherscan.io/tx/${hash}`;\n      if (chain === 'POLYGON') return `https://mumbai.polygonscan.com/tx/${hash}`;\n      if (chain === 'SOL') return `https://solscan.io/tx/${hash}?cluster=testnet`;\n      return '#';\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}