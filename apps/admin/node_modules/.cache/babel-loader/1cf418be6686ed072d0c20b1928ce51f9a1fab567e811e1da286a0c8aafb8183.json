{"ast":null,"code":"/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\n/**\n * AUTO-GENERATED FILE. DO NOT MODIFY.\n */\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { __extends } from \"tslib\";\nimport ComponentView from '../../view/Component.js';\nimport BoundingRect from 'zrender/lib/core/BoundingRect.js';\nimport * as matrix from 'zrender/lib/core/matrix.js';\nimport RoamController from '../helper/RoamController.js';\nimport tokens from '../../visual/tokens.js';\nimport { createBoxLayoutReference, getBoxLayoutParams, getLayoutRect } from '../../util/layout.js';\nimport { expandOrShrinkRect, Rect, Group, traverseUpdateZ, retrieveZInfo } from '../../util/graphic.js';\nimport { applyTransform } from 'zrender/lib/core/vector.js';\nimport View from '../../coord/View.js';\nimport { bind, defaults, extend } from 'zrender/lib/core/util.js';\nvar ThumbnailView = /** @class */function (_super) {\n  __extends(ThumbnailView, _super);\n  function ThumbnailView() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.type = ThumbnailView.type;\n    return _this;\n  }\n  ThumbnailView.prototype.render = function (thumbnailModel, ecModel, api) {\n    this._api = api;\n    this._model = thumbnailModel;\n    if (!this._coordSys) {\n      this._coordSys = new View();\n    }\n    if (!this._isEnabled()) {\n      this._clear();\n      return;\n    }\n    this._renderVersion = api.getMainProcessVersion();\n    var group = this.group;\n    group.removeAll();\n    var itemStyleModel = thumbnailModel.getModel('itemStyle');\n    var itemStyle = itemStyleModel.getItemStyle();\n    if (itemStyle.fill == null) {\n      itemStyle.fill = ecModel.get('backgroundColor') || tokens.color.neutral00;\n    }\n    var refContainer = createBoxLayoutReference(thumbnailModel, api).refContainer;\n    var boxRect = getLayoutRect(getBoxLayoutParams(thumbnailModel, true), refContainer);\n    var boxBorderWidth = itemStyle.lineWidth || 0;\n    var contentRect = this._contentRect = expandOrShrinkRect(boxRect.clone(), boxBorderWidth / 2, true, true);\n    var contentGroup = new Group();\n    group.add(contentGroup);\n    contentGroup.setClipPath(new Rect({\n      shape: contentRect.plain()\n    }));\n    var targetGroup = this._targetGroup = new Group();\n    contentGroup.add(targetGroup);\n    // Draw border and background and shadow of thumbnail box.\n    var borderShape = boxRect.plain();\n    borderShape.r = itemStyleModel.getShallow('borderRadius', true);\n    group.add(this._bgRect = new Rect({\n      style: itemStyle,\n      shape: borderShape,\n      silent: false,\n      cursor: 'grab'\n    }));\n    var windowStyleModel = thumbnailModel.getModel('windowStyle');\n    var windowR = windowStyleModel.getShallow('borderRadius', true);\n    contentGroup.add(this._windowRect = new Rect({\n      shape: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        r: windowR\n      },\n      style: windowStyleModel.getItemStyle(),\n      silent: false,\n      cursor: 'grab'\n    }));\n    this._dealRenderContent();\n    this._dealUpdateWindow();\n    updateZ(thumbnailModel, this);\n  };\n  /**\n   * Can be called asynchronously directly.\n   * This method should be idempotent.\n   */\n  ThumbnailView.prototype.renderContent = function (bridgeRendered) {\n    this._bridgeRendered = bridgeRendered;\n    if (this._isEnabled()) {\n      this._dealRenderContent();\n      this._dealUpdateWindow();\n      updateZ(this._model, this);\n    }\n  };\n  ThumbnailView.prototype._dealRenderContent = function () {\n    var bridgeRendered = this._bridgeRendered;\n    if (!bridgeRendered || bridgeRendered.renderVersion !== this._renderVersion) {\n      return;\n    }\n    var targetGroup = this._targetGroup;\n    var coordSys = this._coordSys;\n    var contentRect = this._contentRect;\n    targetGroup.removeAll();\n    if (!bridgeRendered) {\n      return;\n    }\n    var bridgeGroup = bridgeRendered.group;\n    var bridgeRect = bridgeGroup.getBoundingRect();\n    targetGroup.add(bridgeGroup);\n    this._bgRect.z2 = bridgeRendered.z2Range.min - 10;\n    coordSys.setBoundingRect(bridgeRect.x, bridgeRect.y, bridgeRect.width, bridgeRect.height);\n    // Use `getLayoutRect` is just to find an approperiate rect in thumbnail.\n    var viewRect = getLayoutRect({\n      left: 'center',\n      top: 'center',\n      aspect: bridgeRect.width / bridgeRect.height\n    }, contentRect);\n    coordSys.setViewRect(viewRect.x, viewRect.y, viewRect.width, viewRect.height);\n    bridgeGroup.attr(coordSys.getTransformInfo().raw);\n    this._windowRect.z2 = bridgeRendered.z2Range.max + 10;\n    this._resetRoamController(bridgeRendered.roamType);\n  };\n  /**\n   * Can be called from action handler directly.\n   * This method should be idempotent.\n   */\n  ThumbnailView.prototype.updateWindow = function (param) {\n    var bridgeRendered = this._bridgeRendered;\n    if (bridgeRendered && bridgeRendered.renderVersion === param.renderVersion) {\n      bridgeRendered.targetTrans = param.targetTrans;\n    }\n    if (this._isEnabled()) {\n      this._dealUpdateWindow();\n    }\n  };\n  ThumbnailView.prototype._dealUpdateWindow = function () {\n    var bridgeRendered = this._bridgeRendered;\n    if (!bridgeRendered || bridgeRendered.renderVersion !== this._renderVersion) {\n      return;\n    }\n    var invTargetTrans = matrix.invert([], bridgeRendered.targetTrans);\n    var transTargetToThis = matrix.mul([], this._coordSys.transform, invTargetTrans);\n    this._transThisToTarget = matrix.invert([], transTargetToThis);\n    var viewportRect = bridgeRendered.viewportRect;\n    if (!viewportRect) {\n      viewportRect = new BoundingRect(0, 0, this._api.getWidth(), this._api.getHeight());\n    } else {\n      viewportRect = viewportRect.clone();\n    }\n    viewportRect.applyTransform(transTargetToThis);\n    var windowRect = this._windowRect;\n    var r = windowRect.shape.r;\n    windowRect.setShape(defaults({\n      r: r\n    }, viewportRect));\n  };\n  ThumbnailView.prototype._resetRoamController = function (roamType) {\n    var _this = this;\n    var api = this._api;\n    var roamController = this._roamController;\n    if (!roamController) {\n      roamController = this._roamController = new RoamController(api.getZr());\n    }\n    if (!roamType || !this._isEnabled()) {\n      roamController.disable();\n      return;\n    }\n    roamController.enable(roamType, {\n      api: api,\n      zInfo: {\n        component: this._model\n      },\n      triggerInfo: {\n        roamTrigger: null,\n        isInSelf: function (e, x, y) {\n          return _this._contentRect.contain(x, y);\n        }\n      }\n    });\n    roamController.off('pan').off('zoom').on('pan', bind(this._onPan, this)).on('zoom', bind(this._onZoom, this));\n  };\n  ThumbnailView.prototype._onPan = function (event) {\n    var trans = this._transThisToTarget;\n    if (!this._isEnabled() || !trans) {\n      return;\n    }\n    var oldOffset = applyTransform([], [event.oldX, event.oldY], trans);\n    var newOffset = applyTransform([], [event.oldX - event.dx, event.oldY - event.dy], trans);\n    this._api.dispatchAction(makeRoamPayload(this._model.getTarget().baseMapProvider, {\n      dx: newOffset[0] - oldOffset[0],\n      dy: newOffset[1] - oldOffset[1]\n    }));\n  };\n  ThumbnailView.prototype._onZoom = function (event) {\n    var trans = this._transThisToTarget;\n    if (!this._isEnabled() || !trans) {\n      return;\n    }\n    var offset = applyTransform([], [event.originX, event.originY], trans);\n    this._api.dispatchAction(makeRoamPayload(this._model.getTarget().baseMapProvider, {\n      zoom: 1 / event.scale,\n      originX: offset[0],\n      originY: offset[1]\n    }));\n  };\n  /**\n   * This method is also responsible for check enable in asynchronous situation,\n   * e.g., in event listeners that is supposed to be outdated but not be removed.\n   */\n  ThumbnailView.prototype._isEnabled = function () {\n    var thumbnailModel = this._model;\n    if (!thumbnailModel || !thumbnailModel.shouldShow()) {\n      return false;\n    }\n    var baseMapProvider = thumbnailModel.getTarget().baseMapProvider;\n    if (!baseMapProvider) {\n      return false;\n    }\n    return true;\n  };\n  ThumbnailView.prototype._clear = function () {\n    this.group.removeAll();\n    this._bridgeRendered = null;\n    if (this._roamController) {\n      this._roamController.disable();\n    }\n  };\n  ThumbnailView.prototype.remove = function () {\n    this._clear();\n  };\n  ThumbnailView.prototype.dispose = function () {\n    this._clear();\n  };\n  ThumbnailView.type = 'thumbnail';\n  return ThumbnailView;\n}(ComponentView);\nexport { ThumbnailView };\nfunction makeRoamPayload(baseMapProvider, params) {\n  var type = baseMapProvider.mainType === 'series' ? baseMapProvider.subType + \"Roam\" // e.g. 'graphRoam'\n  : baseMapProvider.mainType + \"Roam\"; // e.g., 'geoRoam'\n  var payload = {\n    type: type\n  };\n  payload[baseMapProvider.mainType + \"Id\"] = baseMapProvider.id;\n  extend(payload, params);\n  return payload;\n}\nfunction updateZ(thumbnailModel, thumbnailView) {\n  var zInfo = retrieveZInfo(thumbnailModel);\n  traverseUpdateZ(thumbnailView.group, zInfo.z, zInfo.zlevel);\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}