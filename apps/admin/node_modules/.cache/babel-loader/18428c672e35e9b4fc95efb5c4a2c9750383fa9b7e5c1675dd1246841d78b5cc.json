{"ast":null,"code":"import { ElMessage } from 'element-plus';\nexport default {\n  name: 'LoginQueryView',\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      totalItems: 0,\n      pagination: {\n        page: 1,\n        limit: 20\n      },\n      searchParams: {\n        userId: '',\n        loginIp: '',\n        registrationIp: '',\n        betIp: '',\n        dateRange: null\n      },\n      detailDialogVisible: false,\n      detailDialogTitle: '',\n      detailType: '',\n      detailUserId: '',\n      detailData: [],\n      detailLoading: false,\n      detailDateRange: null\n    };\n  },\n  created() {\n    this.fetchData();\n  },\n  methods: {\n    async fetchData() {\n      if (this.loading) return;\n      this.loading = true;\n      try {\n        const params = {\n          ...this.pagination,\n          userId: this.searchParams.userId || undefined,\n          loginIp: this.searchParams.loginIp || undefined,\n          registrationIp: this.searchParams.registrationIp || undefined,\n          betIp: this.searchParams.betIp || undefined,\n          dateRange: this.searchParams.dateRange ? JSON.stringify(this.searchParams.dateRange) : undefined\n        };\n        const response = await this.$api.getLoginQuery(params);\n        this.tableData = response.list;\n        this.totalItems = response.total;\n      } catch (error) {\n        console.error('Failed to fetch login query data:', error);\n        ElMessage.error('加载数据失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    async showDetailDialog(type, row) {\n      this.detailType = type;\n      this.detailUserId = row.user_id;\n      this.detailDateRange = null;\n      this.detailData = [];\n      const titles = {\n        loginIp: '详情',\n        registrationIp: '详情',\n        betIp: '详情',\n        registrationPassword: '详情',\n        withdrawalPassword: '详情',\n        deviceId: '详情'\n      };\n      this.detailDialogTitle = titles[type] || '详情';\n      this.detailDialogVisible = true;\n      await this.fetchDetailData();\n    },\n    async fetchDetailData() {\n      this.detailLoading = true;\n      try {\n        const endpointMap = {\n          loginIp: `/login-query/same-login-ip/${this.detailUserId}`,\n          registrationIp: `/login-query/same-registration-ip/${this.detailUserId}`,\n          betIp: `/login-query/same-bet-ip/${this.detailUserId}`,\n          registrationPassword: `/login-query/same-registration-password/${this.detailUserId}`,\n          withdrawalPassword: `/login-query/same-withdrawal-password/${this.detailUserId}`,\n          deviceId: `/login-query/same-device-id/${this.detailUserId}`\n        };\n        const endpoint = endpointMap[this.detailType];\n        if (!endpoint) {\n          ElMessage.error('未知的详情类型');\n          return;\n        }\n        const response = await this.$api.getLoginQueryDetail(endpoint);\n        this.detailData = response.list || [];\n\n        // 如果有日期筛选，进行过滤\n        if (this.detailDateRange && this.detailDateRange.length === 2) {\n          const [startDate, endDate] = this.detailDateRange;\n          this.detailData = this.detailData.filter(item => {\n            const loginTime = new Date(item.last_login_time);\n            return loginTime >= new Date(startDate) && loginTime <= new Date(endDate);\n          });\n        }\n      } catch (error) {\n        console.error('Failed to fetch detail data:', error);\n        ElMessage.error('加载详情数据失败');\n      } finally {\n        this.detailLoading = false;\n      }\n    },\n    handleSearch() {\n      this.pagination.page = 1;\n      this.fetchData();\n    },\n    handleSizeChange(newLimit) {\n      this.pagination.limit = newLimit;\n      this.pagination.page = 1;\n      this.fetchData();\n    },\n    handlePageChange(newPage) {\n      this.pagination.page = newPage;\n      this.fetchData();\n    },\n    handleExport() {\n      ElMessage.info('导出功能开发中');\n    },\n    handleDetailExport() {\n      ElMessage.info('导出功能开发中');\n    },\n    formatDateTime(isoString) {\n      if (!isoString) return '';\n      try {\n        return new Date(isoString).toLocaleString('zh-TW', {\n          timeZone: 'Asia/Taipei'\n        });\n      } catch (e) {\n        return isoString;\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}