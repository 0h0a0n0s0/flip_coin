{"ast":null,"code":"import { ElMessage, ElMessageBox } from 'element-plus';\nimport { InfoFilled } from '@element-plus/icons-vue';\n\n// ★★★ 关键修改：让此函数直接返回 Date 对象，而不是字符串 ★★★\nconst createTodayRange = () => {\n  const start = new Date();\n  start.setHours(0, 0, 0, 0);\n  const end = new Date();\n  end.setHours(23, 59, 59, 999);\n  return [start, end];\n};\nexport default {\n  name: 'WithdrawalReview',\n  components: {\n    InfoFilled\n  },\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      totalItems: 0,\n      pagination: {\n        page: 1,\n        limit: 10\n      },\n      searchParams: {\n        username: '',\n        user_id: '',\n        status: '',\n        address: '',\n        tx_hash: '',\n        // 初始化为 Date 数组\n        dateRange: createTodayRange()\n      }\n    };\n  },\n  created() {\n    // 移除 setDefaultDateRange 调用，因为 data 中已经初始化了\n    this.handleSearch();\n  },\n  methods: {\n    async fetchData() {\n      if (this.loading) return;\n      this.loading = true;\n      try {\n        const params = {\n          ...this.pagination,\n          username: this.searchParams.username || undefined,\n          status: this.searchParams.status || undefined,\n          address: this.searchParams.address || undefined,\n          tx_hash: this.searchParams.tx_hash || undefined,\n          user_id: this.searchParams.user_id || undefined\n        };\n\n        // ★★★ 关键修改：在发请求前，手动将 Date 对象转为 ISO 字符串 ★★★\n        // 这样 Element Plus 组件只处理 Date 对象（不会报错），而后端收到的是它想要的字符串\n        if (this.searchParams.dateRange && this.searchParams.dateRange.length === 2) {\n          const [start, end] = this.searchParams.dateRange;\n          // 确保是有效的 Date 对象\n          if (start instanceof Date && !isNaN(start)) {\n            params.start_time = start.toISOString();\n          }\n          if (end instanceof Date && !isNaN(end)) {\n            params.end_time = end.toISOString();\n          }\n        }\n        const response = await this.$api.getWithdrawals(params);\n        this.tableData = response.list;\n        this.totalItems = response.total;\n      } catch (error) {\n        console.error('Failed to fetch withdrawals:', error);\n        ElMessage.error('获取数据失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleSearch() {\n      this.pagination.page = 1;\n      this.fetchData();\n    },\n    handleSizeChange(newLimit) {\n      this.pagination.limit = newLimit;\n      this.pagination.page = 1;\n      this.fetchData();\n    },\n    handlePageChange(newPage) {\n      this.pagination.page = newPage;\n      this.fetchData();\n    },\n    // (批准)\n    handleApprove(row) {\n      ElMessageBox.confirm(`确定要批准用户 [${row.username}] 的 ${row.amount} USDT 提款吗？<br>狀态将变为 [出款中]，等待财务手动操作。`, '批准确认', {\n        dangerouslyUseHTMLString: true,\n        confirmButtonText: '确定批准',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          await this.$api.approveWithdrawal(row.id);\n          ElMessage.success('批准成功，狀态已更新');\n          await this.fetchData();\n        } catch (error) {\n          console.error('Failed to approve:', error);\n        }\n      }).catch(() => {});\n    },\n    // (拒绝)\n    handleReject(row) {\n      ElMessageBox.prompt('请输入拒绝理由 (将退款给用户)', '拒绝提款', {\n        confirmButtonText: '确认拒绝',\n        cancelButtonText: '取消',\n        inputPattern: /.+/,\n        inputErrorMessage: '拒绝理由不能为空'\n      }).then(async ({\n        value\n      }) => {\n        try {\n          await this.$api.rejectWithdrawal(row.id, {\n            reason: value\n          });\n          ElMessage.success('拒绝成功，款项已退回用户余额');\n          await this.fetchData();\n        } catch (error) {\n          console.error('Failed to reject:', error);\n        }\n      }).catch(() => {});\n    },\n    // (手动完成)\n    handleComplete(row) {\n      ElMessageBox.prompt('请输入出款 TX Hash（交易哈希）', '标记为完成', {\n        confirmButtonText: '下一步',\n        cancelButtonText: '取消',\n        inputPattern: /.+/,\n        inputErrorMessage: 'TX Hash 不能为空',\n        inputPlaceholder: '请输入完整的交易哈希'\n      }).then(async ({\n        value: txHash\n      }) => {\n        ElMessageBox.prompt('请输入 Gas 成本 (USDT)', 'Gas 成本', {\n          confirmButtonText: '确认完成',\n          cancelButtonText: '取消',\n          inputPattern: /^[0-9]+\\.?[0-9]*$/,\n          inputErrorMessage: 'Gas Fee 必须为有效的数字',\n          inputPlaceholder: '例如：0.001',\n          inputValue: '0'\n        }).then(async ({\n          value: gasFee\n        }) => {\n          try {\n            await this.$api.completeWithdrawal(row.id, {\n              tx_hash: txHash.trim(),\n              gas_fee: parseFloat(gasFee) || 0\n            });\n            ElMessage.success('提款已标记为完成');\n            await this.fetchData();\n          } catch (error) {\n            console.error('Failed to complete withdrawal:', error);\n            ElMessage.error(error.response?.data?.error || '标记完成失败');\n          }\n        }).catch(() => {});\n      }).catch(() => {});\n    },\n    // --- (格式化辅助函数) ---\n    formatDateTime(isoString) {\n      if (!isoString) return '';\n      try {\n        return new Date(isoString).toLocaleString('zh-TW', {\n          timeZone: 'Asia/Taipei'\n        });\n      } catch (e) {\n        return isoString;\n      }\n    },\n    formatStatus(status) {\n      const map = {\n        'pending': '待審核',\n        'rejected': '審核拒绝',\n        'processing': '出款中',\n        'completed': '出款完成'\n      };\n      return map[status] || status;\n    },\n    getStatusTagType(status) {\n      const map = {\n        'pending': 'warning',\n        'rejected': 'danger',\n        'processing': 'primary',\n        'completed': 'success'\n      };\n      return map[status] || 'info';\n    },\n    formatCurrency(value, allowZero = false) {\n      if (value === null || value === undefined) return allowZero ? '0.00' : '-';\n      const num = parseFloat(value);\n      if (isNaN(num)) return 'N/A';\n      if (num === 0 && !allowZero) return '-';\n      return num.toFixed(2);\n    },\n    getTxLink(chain, hash) {\n      if (chain === 'TRC20') return `https://nile.tronscan.org/#/transaction/${hash}`;\n      if (chain === 'BSC') return `https://testnet.bscscan.com/tx/${hash}`;\n      if (chain === 'ETH') return `https://sepolia.etherscan.io/tx/${hash}`;\n      if (chain === 'POLYGON') return `https://mumbai.polygonscan.com/tx/${hash}`;\n      if (chain === 'SOL') return `https://solscan.io/tx/${hash}?cluster=testnet`;\n      return '#';\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}