{"ast":null,"code":"// 创建当日日期范围\nconst createTodayRange = () => {\n  const start = new Date();\n  start.setHours(0, 0, 0, 0);\n  const end = new Date();\n  end.setHours(23, 59, 59, 999);\n  return [start, end];\n};\n\n// 将日期范围转换为 ISO 字符串数组\nconst toIsoRange = range => {\n  if (!Array.isArray(range) || range.length !== 2) return null;\n  const [start, end] = range;\n  const startIso = start instanceof Date && !isNaN(start) ? start.toISOString() : null;\n  const endIso = end instanceof Date && !isNaN(end) ? end.toISOString() : null;\n  if (!startIso || !endIso) return null;\n  return [startIso, endIso];\n};\nexport default {\n  name: 'AuditLogsView',\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      totalItems: 0,\n      pagination: {\n        page: 1,\n        limit: 20\n      },\n      searchParams: {\n        adminUsername: '',\n        action: '',\n        dateRange: createTodayRange()\n      },\n      // 可用动作列表（用于下拉选单）\n      availableActions: [{\n        value: 'update_user',\n        label: '更新用户资料'\n      }, {\n        value: 'update_user_status',\n        label: '更新用户状态'\n      }, {\n        value: 'create_wallet',\n        label: '新增钱包'\n      }, {\n        value: 'update_wallet',\n        label: '更新钱包'\n      }, {\n        value: 'delete_wallet',\n        label: '删除钱包'\n      }, {\n        value: 'update_setting',\n        label: '更新系统设定'\n      }, {\n        value: 'create_admin_account',\n        label: '新增后台帐号'\n      }, {\n        value: 'update_admin_account',\n        label: '更新后台帐号'\n      }, {\n        value: 'delete_admin_account',\n        label: '删除后台帐号'\n      }, {\n        value: 'add_ip_whitelist',\n        label: '新增IP白名单'\n      }, {\n        value: 'delete_ip_whitelist',\n        label: '删除IP白名单'\n      }, {\n        value: 'create_role',\n        label: '新增权限组'\n      }, {\n        value: 'update_role',\n        label: '更新权限组'\n      }, {\n        value: 'delete_role',\n        label: '删除权限组'\n      }, {\n        value: 'approve_withdrawal',\n        label: '批准提款'\n      }, {\n        value: 'reject_withdrawal',\n        label: '拒绝提款'\n      }, {\n        value: 'complete_withdrawal',\n        label: '完成提款'\n      }],\n      // 动作映射表（用于显示）\n      actionMap: {\n        'update_user': '更新用户资料',\n        'update_user_status': '更新用户状态',\n        'create_wallet': '新增钱包',\n        'update_wallet': '更新钱包',\n        'delete_wallet': '删除钱包',\n        'update_setting': '更新系统设定',\n        'create_admin_account': '新增后台帐号',\n        'update_admin_account': '更新后台帐号',\n        'delete_admin_account': '删除后台帐号',\n        'add_ip_whitelist': '新增IP白名单',\n        'delete_ip_whitelist': '删除IP白名单',\n        'create_role': '新增权限组',\n        'update_role': '更新权限组',\n        'delete_role': '删除权限组',\n        'approve_withdrawal': '批准提款',\n        'reject_withdrawal': '拒绝提款',\n        'complete_withdrawal': '完成提款'\n      },\n      // 资源映射表（用于显示）\n      resourceMap: {\n        'users': '用户',\n        'platform_wallets': '平台钱包',\n        'system_settings': '系统设定',\n        'admin_users': '后台帐号',\n        'admin_ip_whitelist': 'IP白名单',\n        'admin_roles': '权限组',\n        'withdrawals': '提款'\n      }\n    };\n  },\n  created() {\n    this.handleSearch();\n  },\n  methods: {\n    async fetchLogs() {\n      if (this.loading) return;\n      this.loading = true;\n      try {\n        const isoRange = toIsoRange(this.searchParams.dateRange);\n        const params = {\n          ...this.pagination,\n          adminUsername: this.searchParams.adminUsername || undefined,\n          action: this.searchParams.action || undefined,\n          dateRange: isoRange ? JSON.stringify(isoRange) : undefined\n        };\n        const response = await this.$api.getAuditLogs(params);\n        this.tableData = response.list || [];\n        this.totalItems = response.total || 0;\n      } catch (error) {\n        console.error('Failed to fetch audit logs:', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleSearch() {\n      this.pagination.page = 1;\n      this.fetchLogs();\n    },\n    handleSizeChange(newLimit) {\n      this.pagination.limit = newLimit;\n      this.pagination.page = 1;\n      this.fetchLogs();\n    },\n    handlePageChange(newPage) {\n      this.pagination.page = newPage;\n      this.fetchLogs();\n    },\n    formatDate(value) {\n      if (!value) return '-';\n      try {\n        return new Date(value).toLocaleString('zh-TW', {\n          timeZone: 'Asia/Taipei'\n        });\n      } catch (e) {\n        return value;\n      }\n    },\n    formatAction(action) {\n      return this.actionMap[action] || action || '-';\n    },\n    formatResource(resource) {\n      return this.resourceMap[resource] || resource || '-';\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}