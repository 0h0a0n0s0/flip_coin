(()=>{"use strict";var e={6726:(e,a,t)=>{var l={};t.r(l),t.d(l,{addAdminAccount:()=>H,addBlockedRegion:()=>z,addIpToWhitelist:()=>Z,addRole:()=>oe,addUserLevel:()=>B,addWallet:()=>R,approveWithdrawal:()=>me,banUsersByIp:()=>te,completeWithdrawal:()=>he,deleteAdminAccount:()=>j,deleteBlockedRegion:()=>M,deleteIpFromWhitelist:()=>K,deleteRole:()=>de,deleteUserLevel:()=>q,deleteWallet:()=>$,getAdminAccounts:()=>G,getAllPermissions:()=>se,getAuditLogs:()=>J,getBets:()=>S,getBlockedRegions:()=>E,getCollectionLogs:()=>fe,getCollectionSettings:()=>ge,getDashboardStats:()=>C,getDeposits:()=>ue,getIpWhitelist:()=>Y,getLoginQuery:()=>_e,getLoginQueryDetail:()=>ke,getMyPermissions:()=>y,getProfitLossReport:()=>T,getReferrals:()=>I,getRoleDetails:()=>re,getRoles:()=>ie,getSameIpSummary:()=>ee,getSettings:()=>A,getUserDepositAddresses:()=>W,getUserLevels:()=>N,getUsers:()=>L,getUsersByIp:()=>ae,getWalletMonitoring:()=>D,getWallets:()=>x,getWithdrawals:()=>ce,login:()=>w,rejectWithdrawal:()=>pe,unbanUsersByIp:()=>le,updateAdminAccount:()=>Q,updateCollectionSettings:()=>be,updateRole:()=>ne,updateSetting:()=>X,updateUser:()=>P,updateUserLevel:()=>O,updateUserStatus:()=>V,updateWallet:()=>U});var i=t(5130),r=t(6768);function s(e,a){const t=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.Wv)(t)}var o=t(1241);const n={},d=(0,o.A)(n,[["render",s]]),u=d;var c=t(8512),m=t(5068),p=t(1219),h=t(144),g=t(4373),b=t(2933);const f=g.A.create({baseURL:"/",timeout:1e4});let _=localStorage.getItem("debug_real_ip")||null;const k=[{url:"https://api.ipify.org?format=json",key:"ip"},{url:"https://api.seeip.org/jsonip",key:"ip"},{url:"https://api.my-ip.io/ip.json",key:"ip"},{url:"https://ipapi.co/json/",key:"ip"}];async function v(){if(_)return _;console.log("[Frontend] Auto-detecting IP...");for(const t of k)try{const e=new AbortController,a=setTimeout(()=>e.abort(),3e3),l=await fetch(t.url,{signal:e.signal});if(clearTimeout(a),l.ok){const e=await l.json(),a=e[t.key];if(a)return console.log(`[Frontend] Detected IP via ${t.url}: ${a}`),_=a,sessionStorage.setItem("cached_real_ip",a),a}}catch(a){console.warn(`[Frontend] Source failed: ${t.url}`,a.message)}const e=sessionStorage.getItem("cached_real_ip");return e||(console.error("[Frontend] All IP services failed!"),null)}f.interceptors.request.use(async e=>{const a=localStorage.getItem("admin_token");a&&(e.headers["Authorization"]=`Bearer ${a}`);let t=await v();return t||(t=localStorage.getItem("FORCE_IP"),t&&console.log("[Frontend] Using FORCED IP:",t)),t&&(e.headers["X-Client-Real-IP"]=t),e},e=>(console.error("Request error:",e),Promise.reject(e))),f.interceptors.response.use(e=>e.data,e=>{console.error("Response error:",e.response);let a="请求失败";if(e.response){if(403===e.response.status&&e.response.data?.error?.includes("Access Denied")&&!localStorage.getItem("FORCE_IP"))return b.s.prompt("无法自动检测您的 IP (可能被防火墙拦截)。请输入您的真实 IP 以继续：","IP 检测失败",{confirmButtonText:"保存并重试",inputPattern:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,inputErrorMessage:"IP 格式不正确"}).then(({value:e})=>{localStorage.setItem("FORCE_IP",e),location.reload()}).catch(()=>{}),Promise.reject(e);if(e.response.data&&e.response.data.error&&(a=e.response.data.error),401===e.response.status){const a=e.config.url;if(!a.includes("/login"))return localStorage.removeItem("admin_token"),location.href="/admin/login",Promise.reject(e)}}return p.nk.error(a),Promise.reject(e)});const F=f;function w(e){return F({url:"/api/admin/login",method:"post",data:e})}function y(){return F({url:"/api/admin/my-permissions",method:"get"})}function C(){return F({url:"/api/admin/stats",method:"get"})}function D(){return F({url:"/api/admin/wallet-monitoring",method:"get"})}function L(e){return F({url:"/api/admin/users",method:"get",params:e})}function V(e,a){return F({url:`/api/admin/users/${e}/status`,method:"patch",data:{status:a}})}function P(e,a){return F({url:`/api/admin/users/${e}`,method:"put",data:a})}function I(e){return F({url:`/api/admin/users/by-referrer/${e}`,method:"get"})}function W(e){return F({url:"/api/admin/users/deposit-addresses",method:"get",params:e})}function S(e){return F({url:"/api/admin/bets",method:"get",params:e})}function T(e){return F({url:"/api/admin/reports/profit-loss",method:"get",params:e})}function x(e){return F({url:"/api/admin/wallets",method:"get",params:e})}function R(e){return F({url:"/api/admin/wallets",method:"post",data:e})}function U(e,a){return F({url:`/api/admin/wallets/${e}`,method:"put",data:a})}function $(e){return F({url:`/api/admin/wallets/${e}`,method:"delete"})}function A(){return F({url:"/api/admin/settings",method:"get"})}function X(e,a){return F({url:`/api/admin/settings/${e}`,method:"put",data:{value:a}})}function E(){return F({url:"/api/admin/blocked-regions",method:"get"})}function z(e){return F({url:"/api/admin/blocked-regions",method:"post",data:e})}function M(e){return F({url:`/api/admin/blocked-regions/${e}`,method:"delete"})}function N(){return F({url:"/api/admin/user-levels",method:"get"})}function B(e){return F({url:"/api/admin/user-levels",method:"post",data:e})}function O(e,a){return F({url:`/api/admin/user-levels/${e}`,method:"put",data:a})}function q(e){return F({url:`/api/admin/user-levels/${e}`,method:"delete"})}function G(){return F({url:"/api/admin/accounts",method:"get"})}function H(e){return F({url:"/api/admin/accounts",method:"post",data:e})}function Q(e,a){return F({url:`/api/admin/accounts/${e}`,method:"put",data:a})}function j(e){return F({url:`/api/admin/accounts/${e}`,method:"delete"})}function Y(){return F({url:"/api/admin/ip-whitelist",method:"get"})}function Z(e){return F({url:"/api/admin/ip-whitelist",method:"post",data:e})}function K(e){return F({url:`/api/admin/ip-whitelist/${e}`,method:"delete"})}function J(e){return F({url:"/api/admin/audit-logs",method:"get",params:e})}function ee(){return F({url:"/api/admin/risk/same-ip",method:"get"})}function ae(e){return F({url:`/api/admin/risk/same-ip/${encodeURIComponent(e)}/users`,method:"get"})}function te(e){return F({url:`/api/admin/risk/same-ip/${encodeURIComponent(e)}/ban`,method:"post"})}function le(e){return F({url:`/api/admin/risk/same-ip/${encodeURIComponent(e)}/unban`,method:"post"})}function ie(){return F({url:"/api/admin/roles",method:"get"})}function re(e){return F({url:`/api/admin/roles/${e}`,method:"get"})}function se(){return F({url:"/api/admin/permissions",method:"get"})}function oe(e){return F({url:"/api/admin/roles",method:"post",data:e})}function ne(e,a){return F({url:`/api/admin/roles/${e}`,method:"put",data:a})}function de(e){return F({url:`/api/admin/roles/${e}`,method:"delete"})}function ue(e){return F({url:"/api/admin/deposits",method:"get",params:e})}function ce(e){return F({url:"/api/admin/withdrawals",method:"get",params:e})}function me(e){return F({url:`/api/admin/withdrawals/${e}/approve`,method:"post"})}function pe(e,a){return F({url:`/api/admin/withdrawals/${e}/reject`,method:"post",data:a})}function he(e,a){return F({url:`/api/admin/withdrawals/${e}/complete`,method:"post",data:a})}function ge(){return F({url:"/api/admin/collection/settings",method:"get"})}function be(e){return F({url:"/api/admin/collection/settings",method:"post",data:e})}function fe(e){return F({url:"/api/admin/collection/logs",method:"get",params:e})}function _e(e){return F({url:"/api/admin/login-query",method:"get",params:e})}function ke(e){return F({url:`/api/admin${e}`,method:"get"})}const ve=(0,h.Kh)({permissions:{},isLoaded:!1,has(e,a){return!0===this.permissions[`${e}:${a}`]},async loadPermissions(){if(!this.isLoaded)try{const e=await y();this.permissions=e,this.isLoaded=!0,console.log("[RBAC Store] Permissions loaded.")}catch(e){throw console.error("[RBAC Store] Failed to load permissions:",e),this.permissions={},this.isLoaded=!1,e}},clearPermissions(){this.permissions={},this.isLoaded=!1}}),Fe=ve;var we=t(4232);const ye={class:"login-container"};function Ce(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-button"),c=(0,r.g2)("el-form"),m=(0,r.g2)("el-card");return(0,r.uX)(),(0,r.CE)("div",ye,[(0,r.bF)(m,{class:"login-card"},{header:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"FlipCoin 管理後台登入")],-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(c,{model:s.loginForm,onSubmit:(0,i.D$)(o.handleLogin,["prevent"])},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"帐号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.loginForm.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.loginForm.username=e),placeholder:"请输入帐号",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"密码"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.loginForm.password,"onUpdate:modelValue":a[1]||(a[1]=e=>s.loginForm.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"primary",onClick:o.handleLogin,loading:s.loading,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(s.loading?"登入中...":"登 入"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1})])}const De={name:"LoginView",data(){return{loading:!1,loginForm:{username:"admin",password:""}}},methods:{async handleLogin(){if(!this.loading){if(this.loading=!0,!this.loginForm.username||!this.loginForm.password)return this.$message.error("帐号和密码不能为空"),void(this.loading=!1);try{const e=await this.$api.login(this.loginForm);e&&e.token?(localStorage.setItem("admin_token",e.token),this.$router.push("/dashboard")):console.error("登入失败，但未拋出错误。")}catch(e){console.error("Login failed (handled by interceptor):",e)}finally{this.loading=!1}}}}},Le=(0,o.A)(De,[["render",Ce],["__scopeId","data-v-c6a7b6f0"]]),Ve=Le;function Pe(e,a,t,l,i,s){const o=(0,r.g2)("el-button"),n=(0,r.g2)("el-header"),d=(0,r.g2)("DataLine"),u=(0,r.g2)("el-icon"),c=(0,r.g2)("el-menu-item"),m=(0,r.g2)("User"),p=(0,r.g2)("el-sub-menu"),h=(0,r.g2)("Coin"),g=(0,r.g2)("PieChart"),b=(0,r.g2)("Money"),f=(0,r.g2)("Lock"),_=(0,r.g2)("Setting"),k=(0,r.g2)("el-menu"),v=(0,r.g2)("el-aside"),F=(0,r.g2)("router-view"),w=(0,r.g2)("el-main"),y=(0,r.g2)("el-container");return(0,r.uX)(),(0,r.Wv)(y,{class:"layout-container"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{class:"layout-header"},{default:(0,r.k6)(()=>[(0,r.Lk)("span",null,"FlipCoin 管理後台 (用户: "+(0,we.v_)(i.username)+")",1),(0,r.bF)(o,{type:"danger",onClick:s.handleLogout},{default:(0,r.k6)(()=>[...a[0]||(a[0]=[(0,r.eW)("登出",-1)])]),_:1},8,["onClick"])]),_:1}),(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(v,{width:"200px",class:"layout-aside"},{default:(0,r.k6)(()=>[e.$permissions.isLoaded?((0,r.uX)(),(0,r.Wv)(k,{key:0,"default-active":s.activeMenu,class:"el-menu-vertical-demo",router:!0,"unique-opened":!0,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},{default:(0,r.k6)(()=>[e.$permissions.has("dashboard","read")?((0,r.uX)(),(0,r.Wv)(c,{key:0,index:"/dashboard"},{default:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(d)]),_:1}),a[1]||(a[1]=(0,r.Lk)("span",null,"仪表板",-1))]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("users","read")||e.$permissions.has("users_addresses","read")?((0,r.uX)(),(0,r.Wv)(p,{key:1,index:"user-management"},{title:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(m)]),_:1}),a[2]||(a[2]=(0,r.Lk)("span",null,"用户管理",-1))]),default:(0,r.k6)(()=>[e.$permissions.has("users","read")?((0,r.uX)(),(0,r.Wv)(c,{key:0,index:"/users"},{default:(0,r.k6)(()=>[...a[3]||(a[3]=[(0,r.eW)("用户列表",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("users_addresses","read")?((0,r.uX)(),(0,r.Wv)(c,{key:1,index:"/users/deposit-addresses"},{default:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.eW)("用户充值地址",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("users","read")?((0,r.uX)(),(0,r.Wv)(c,{key:2,index:"/users/login-query"},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("登录查询",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("users","update_status")?((0,r.uX)(),(0,r.Wv)(c,{key:3,index:"/risk/same-ip"},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("同 IP 风控监控",-1)])]),_:1})):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("bets","read")?((0,r.uX)(),(0,r.Wv)(p,{key:2,index:"bet-management"},{title:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),a[7]||(a[7]=(0,r.Lk)("span",null,"投注管理",-1))]),default:(0,r.k6)(()=>[(0,r.bF)(c,{index:"/bets"},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)("注单列表",-1)])]),_:1})]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("reports","read")||e.$permissions.has("wallets","read")?((0,r.uX)(),(0,r.Wv)(p,{key:3,index:"report-management"},{title:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(g)]),_:1}),a[9]||(a[9]=(0,r.Lk)("span",null,"数据报表管理",-1))]),default:(0,r.k6)(()=>[e.$permissions.has("reports","read")?((0,r.uX)(),(0,r.Wv)(c,{key:0,index:"/reports"},{default:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.eW)("盈虧报表",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("reports","read")?((0,r.uX)(),(0,r.Wv)(c,{key:1,index:"/collection-logs"},{default:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)("归集记录",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("wallets","read")?((0,r.uX)(),(0,r.Wv)(c,{key:2,index:"/wallet-monitoring"},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("钱包监控",-1)])]),_:1})):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("withdrawals","read")||e.$permissions.has("deposits","read")?((0,r.uX)(),(0,r.Wv)(p,{key:4,index:"finance-management"},{title:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1}),a[13]||(a[13]=(0,r.Lk)("span",null,"财务管理",-1))]),default:(0,r.k6)(()=>[e.$permissions.has("withdrawals","read")?((0,r.uX)(),(0,r.Wv)(c,{key:0,index:"/finance/withdrawals"},{default:(0,r.k6)(()=>[...a[14]||(a[14]=[(0,r.eW)("提款審核",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("deposits","read")?((0,r.uX)(),(0,r.Wv)(c,{key:1,index:"/finance/deposits"},{default:(0,r.k6)(()=>[...a[15]||(a[15]=[(0,r.eW)("充值记录",-1)])]),_:1})):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("admin_accounts","read")||e.$permissions.has("admin_permissions","read")||e.$permissions.has("admin_ip_whitelist","read")?((0,r.uX)(),(0,r.Wv)(p,{key:5,index:"admin-management"},{title:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1}),a[16]||(a[16]=(0,r.Lk)("span",null,"後台管理",-1))]),default:(0,r.k6)(()=>[e.$permissions.has("admin_accounts","read")?((0,r.uX)(),(0,r.Wv)(c,{key:0,index:"/admin/accounts"},{default:(0,r.k6)(()=>[...a[17]||(a[17]=[(0,r.eW)("帐号管理",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("admin_permissions","read")?((0,r.uX)(),(0,r.Wv)(c,{key:1,index:"/admin/permissions"},{default:(0,r.k6)(()=>[...a[18]||(a[18]=[(0,r.eW)("权限组设定",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("admin_ip_whitelist","read")?((0,r.uX)(),(0,r.Wv)(c,{key:2,index:"/admin/ip-whitelist"},{default:(0,r.k6)(()=>[...a[19]||(a[19]=[(0,r.eW)("後台ip白名单",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("admin_permissions","read")?((0,r.uX)(),(0,r.Wv)(c,{key:3,index:"/admin/audit-logs"},{default:(0,r.k6)(()=>[...a[20]||(a[20]=[(0,r.eW)("操作稽核日志",-1)])]),_:1})):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("settings_game","read")||e.$permissions.has("settings_regions","read")||e.$permissions.has("settings_levels","read")?((0,r.uX)(),(0,r.Wv)(p,{key:6,index:"system-settings"},{title:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(_)]),_:1}),a[21]||(a[21]=(0,r.Lk)("span",null,"系统设定",-1))]),default:(0,r.k6)(()=>[e.$permissions.has("settings_game","read")?((0,r.uX)(),(0,r.Wv)(c,{key:0,index:"/settings/game-parameters"},{default:(0,r.k6)(()=>[...a[22]||(a[22]=[(0,r.eW)("系统参数",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("settings_regions","read")?((0,r.uX)(),(0,r.Wv)(c,{key:1,index:"/settings/blocked-regions"},{default:(0,r.k6)(()=>[...a[23]||(a[23]=[(0,r.eW)("阻挡地区",-1)])]),_:1})):(0,r.Q3)("",!0),e.$permissions.has("settings_levels","read")?((0,r.uX)(),(0,r.Wv)(c,{key:2,index:"/settings/user-levels"},{default:(0,r.k6)(()=>[...a[24]||(a[24]=[(0,r.eW)("用户等级",-1)])]),_:1})):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["default-active"])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(w,{class:"layout-main"},{default:(0,r.k6)(()=>[(0,r.bF)(F)]),_:1})]),_:1})]),_:1})}var Ie=t(7477);const We={name:"LayoutView",data(){return{username:"N/A"}},computed:{activeMenu(){return this.$route.path}},components:{DataLine:Ie.dlO,User:Ie.KJW,Coin:Ie.KOj,PieChart:Ie.rW1,Setting:Ie.B5R,Lock:Ie.c_I,Money:Ie.v0_},created(){this.decodeToken()},methods:{decodeToken(){try{const e=localStorage.getItem("admin_token");if(e){const a=(0,m.s)(e);this.username=a.username}else this.handleLogout(!0)}catch(e){console.error("Failed to decode token:",e),p.nk.error("Token 验证失败，请重新登入。"),this.handleLogout(!0)}},handleLogout(e=!1){localStorage.removeItem("admin_token"),this.$permissions&&this.$permissions.clearPermissions(),this.$router.push("/login"),e||p.nk.success("登出成功")}}},Se=(0,o.A)(We,[["render",Pe],["__scopeId","data-v-301274d7"]]),Te=Se,xe={class:"dashboard"},Re={class:"dashboard-header"},Ue={class:"stat-card-content"},$e={class:"stat-icon"},Ae={class:"stat-info"},Xe={class:"stat-value"},Ee={class:"stat-card-content"},ze={class:"stat-icon"},Me={class:"stat-info"},Ne={class:"stat-value"},Be={class:"stat-card-content"},Oe={class:"stat-icon"},qe={class:"stat-info"},Ge={class:"stat-value online"},He={class:"stat-card-content"},Qe={class:"stat-icon"},je={class:"stat-info"},Ye={class:"stat-value"},Ze={class:"card-header"},Ke={ref:"chartContainer",class:"chart-container"},Je={key:0,class:"stats-detail"},ea={class:"stat-detail-item"},aa={class:"detail-label"},ta={class:"detail-value"},la={class:"stat-detail-item"},ia={class:"detail-label"},ra={class:"detail-value"},sa={class:"stat-detail-item"},oa={class:"detail-label"},na={class:"detail-value"},da={class:"stat-detail-item highlight"},ua={class:"detail-label"},ca={class:"card-header"},ma={key:0,class:"wallet-grid"},pa={key:0,class:"wallet-group"},ha={class:"wallet-group-header"},ga={class:"wallet-list"},ba={class:"wallet-name"},fa={class:"wallet-address"},_a={class:"wallet-balances"},ka={class:"balance-item"},va={class:"balance-value"},Fa={class:"balance-item"},wa={class:"balance-value"},ya={key:1,class:"wallet-group"},Ca={class:"wallet-group-header"},Da={class:"wallet-list"},La={class:"wallet-name"},Va={class:"wallet-address"},Pa={class:"wallet-balances"},Ia={class:"balance-item"},Wa={class:"balance-value"},Sa={class:"balance-item"},Ta={class:"balance-value"},xa={class:"balance-item"},Ra={class:"balance-value"},Ua={key:2,class:"wallet-group"},$a={class:"wallet-group-header"},Aa={class:"wallet-list"},Xa={class:"wallet-name"},Ea={class:"wallet-address"},za={class:"wallet-balances"},Ma={class:"balance-item"},Na={class:"balance-value"},Ba={class:"balance-item"},Oa={class:"balance-value"},qa={key:3,class:"empty-state"};function Ga(e,a,t,l,i,s){const o=(0,r.g2)("el-button"),n=(0,r.g2)("User"),d=(0,r.g2)("el-icon"),u=(0,r.g2)("el-card"),c=(0,r.g2)("el-col"),m=(0,r.g2)("Coin"),p=(0,r.g2)("Connection"),h=(0,r.g2)("Warning"),g=(0,r.g2)("el-row"),b=(0,r.g2)("el-radio-button"),f=(0,r.g2)("el-radio-group"),_=(0,r.g2)("Document"),k=(0,r.g2)("Money"),v=(0,r.g2)("CreditCard"),F=(0,r.g2)("TrendCharts"),w=(0,r.g2)("Box"),y=(0,r.g2)("Lightning"),C=(0,r.g2)("el-empty"),D=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",xe,[(0,r.Lk)("div",Re,[a[1]||(a[1]=(0,r.Lk)("h2",null,"儀表板",-1)),(0,r.bF)(o,{type:"primary",icon:e.Refresh,circle:"",onClick:s.refreshAll,loading:i.loading||i.walletLoading},null,8,["icon","onClick","loading"])]),(0,r.bF)(g,{gutter:20,class:"mb-20"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{xs:24,sm:12,md:6},{default:(0,r.k6)(()=>[(0,r.bF)(u,{class:"stat-card stat-card-users",shadow:"hover"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Ue,[(0,r.Lk)("div",$e,[(0,r.bF)(d,{size:32},{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1})]),(0,r.Lk)("div",Ae,[a[2]||(a[2]=(0,r.Lk)("div",{class:"stat-label"},"總用戶數",-1)),(0,r.Lk)("div",Xe,(0,we.v_)(i.stats?.totalUsers||0),1)])])]),_:1})]),_:1}),(0,r.bF)(c,{xs:24,sm:12,md:6},{default:(0,r.k6)(()=>[(0,r.bF)(u,{class:"stat-card stat-card-bets",shadow:"hover"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Ee,[(0,r.Lk)("div",ze,[(0,r.bF)(d,{size:32},{default:(0,r.k6)(()=>[(0,r.bF)(m)]),_:1})]),(0,r.Lk)("div",Me,[a[3]||(a[3]=(0,r.Lk)("div",{class:"stat-label"},"總投注數",-1)),(0,r.Lk)("div",Ne,(0,we.v_)(i.stats?.totalBets||0),1)])])]),_:1})]),_:1}),(0,r.bF)(c,{xs:24,sm:12,md:6},{default:(0,r.k6)(()=>[(0,r.bF)(u,{class:"stat-card stat-card-online",shadow:"hover"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Be,[(0,r.Lk)("div",Oe,[(0,r.bF)(d,{size:32},{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1})]),(0,r.Lk)("div",qe,[a[4]||(a[4]=(0,r.Lk)("div",{class:"stat-label"},"即時線上人數",-1)),(0,r.Lk)("div",Ge,(0,we.v_)(i.stats?.onlineUsers||0),1)])])]),_:1})]),_:1}),(0,r.bF)(c,{xs:24,sm:12,md:6},{default:(0,r.k6)(()=>[(0,r.bF)(u,{class:"stat-card stat-card-pending",shadow:"hover"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",He,[(0,r.Lk)("div",Qe,[(0,r.bF)(d,{size:32},{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1})]),(0,r.Lk)("div",je,[a[5]||(a[5]=(0,r.Lk)("div",{class:"stat-label"},"異常訂單",-1)),(0,r.Lk)("div",Ye,(0,we.v_)(i.stats?.pendingPayouts||0),1)])])]),_:1})]),_:1})]),_:1}),(0,r.bF)(g,{gutter:20,class:"mb-20"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{xs:24,lg:16},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{class:"chart-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",Ze,[a[10]||(a[10]=(0,r.Lk)("span",{class:"card-title"},"FlipCoin 遊戲數據趨勢",-1)),(0,r.bF)(f,{modelValue:i.chartPeriod,"onUpdate:modelValue":a[0]||(a[0]=e=>i.chartPeriod=e),size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"today"},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("當日",-1)])]),_:1}),(0,r.bF)(b,{label:"week"},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)("當周",-1)])]),_:1}),(0,r.bF)(b,{label:"month"},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)("當月",-1)])]),_:1}),(0,r.bF)(b,{label:"lastMonth"},{default:(0,r.k6)(()=>[...a[9]||(a[9]=[(0,r.eW)("上月",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",Ke,null,512)]),_:1})),[[D,i.loading]])]),_:1}),(0,r.bF)(c,{xs:24,lg:8},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{class:"stats-card",shadow:"hover"},{header:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"card-title"},"統計數據")],-1)])]),default:(0,r.k6)(()=>[i.stats?((0,r.uX)(),(0,r.CE)("div",Je,[(0,r.Lk)("div",ea,[(0,r.Lk)("div",aa,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(_)]),_:1}),a[12]||(a[12]=(0,r.Lk)("span",null,"投注量",-1))]),(0,r.Lk)("div",ta,(0,we.v_)(s.getCurrentPeriodData().betCount)+" 筆",1)]),(0,r.Lk)("div",la,[(0,r.Lk)("div",ia,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[13]||(a[13]=(0,r.Lk)("span",null,"投注金額",-1))]),(0,r.Lk)("div",ra,(0,we.v_)(s.formatNumber(s.getCurrentPeriodData().totalBetAmount))+" USDT",1)]),(0,r.Lk)("div",sa,[(0,r.Lk)("div",oa,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[14]||(a[14]=(0,r.Lk)("span",null,"派獎金額",-1))]),(0,r.Lk)("div",na,(0,we.v_)(s.formatNumber(s.getCurrentPeriodData().totalPayout))+" USDT",1)]),(0,r.Lk)("div",da,[(0,r.Lk)("div",ua,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(F)]),_:1}),a[15]||(a[15]=(0,r.Lk)("span",null,"盈虧",-1))]),(0,r.Lk)("div",{class:(0,we.C4)(["detail-value",s.getCurrentPeriodData().profitLoss>=0?"profit":"loss"])},(0,we.v_)(s.formatNumber(s.getCurrentPeriodData().profitLoss))+" USDT ",3)])])):(0,r.Q3)("",!0)]),_:1})),[[D,i.loading]])]),_:1})]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{class:"wallet-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",ca,[a[17]||(a[17]=(0,r.Lk)("span",{class:"card-title"},"錢包監控",-1)),(0,r.bF)(o,{type:"primary",size:"small",icon:e.Refresh,onClick:s.refreshWallets},{default:(0,r.k6)(()=>[...a[16]||(a[16]=[(0,r.eW)("刷新",-1)])]),_:1},8,["icon","onClick"])])]),default:(0,r.k6)(()=>[i.walletMonitoring?((0,r.uX)(),(0,r.CE)("div",ma,[i.walletMonitoring.payout&&i.walletMonitoring.payout.length>0?((0,r.uX)(),(0,r.CE)("div",pa,[(0,r.Lk)("div",ha,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[18]||(a[18]=(0,r.Lk)("span",null,"自動出款",-1))]),(0,r.Lk)("div",ga,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.walletMonitoring.payout,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"wallet-item"},[(0,r.Lk)("div",ba,(0,we.v_)(e.name),1),(0,r.Lk)("div",fa,(0,we.v_)(s.maskAddress(e.address)),1),(0,r.Lk)("div",_a,[(0,r.Lk)("div",ka,[a[19]||(a[19]=(0,r.Lk)("span",{class:"balance-label"},"TRX",-1)),(0,r.Lk)("span",va,(0,we.v_)(s.formatBalance(e.trxBalance)),1)]),(0,r.Lk)("div",Fa,[a[20]||(a[20]=(0,r.Lk)("span",{class:"balance-label"},"USDT",-1)),(0,r.Lk)("span",wa,(0,we.v_)(s.formatBalance(e.usdtBalance)),1)])])]))),128))])])):(0,r.Q3)("",!0),i.walletMonitoring.collection&&i.walletMonitoring.collection.length>0?((0,r.uX)(),(0,r.CE)("div",ya,[(0,r.Lk)("div",Ca,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(w)]),_:1}),a[21]||(a[21]=(0,r.Lk)("span",null,"歸集",-1))]),(0,r.Lk)("div",Da,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.walletMonitoring.collection,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"wallet-item"},[(0,r.Lk)("div",La,(0,we.v_)(e.name),1),(0,r.Lk)("div",Va,(0,we.v_)(s.maskAddress(e.address)),1),(0,r.Lk)("div",Pa,[(0,r.Lk)("div",Ia,[a[22]||(a[22]=(0,r.Lk)("span",{class:"balance-label"},"TRX",-1)),(0,r.Lk)("span",Wa,(0,we.v_)(s.formatBalance(e.trxBalance)),1)]),(0,r.Lk)("div",Sa,[a[23]||(a[23]=(0,r.Lk)("span",{class:"balance-label"},"USDT",-1)),(0,r.Lk)("span",Ta,(0,we.v_)(s.formatBalance(e.usdtBalance)),1)]),(0,r.Lk)("div",xa,[a[24]||(a[24]=(0,r.Lk)("span",{class:"balance-label"},"能量",-1)),(0,r.Lk)("span",Ra,(0,we.v_)(s.formatBalance(e.energy,0)),1)])])]))),128))])])):(0,r.Q3)("",!0),i.walletMonitoring.gasReserve&&i.walletMonitoring.gasReserve.length>0?((0,r.uX)(),(0,r.CE)("div",Ua,[(0,r.Lk)("div",$a,[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(y)]),_:1}),a[25]||(a[25]=(0,r.Lk)("span",null,"Gas 儲備",-1))]),(0,r.Lk)("div",Aa,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.walletMonitoring.gasReserve,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"wallet-item"},[(0,r.Lk)("div",Xa,(0,we.v_)(e.name),1),(0,r.Lk)("div",Ea,(0,we.v_)(s.maskAddress(e.address)),1),(0,r.Lk)("div",za,[(0,r.Lk)("div",Ma,[a[26]||(a[26]=(0,r.Lk)("span",{class:"balance-label"},"TRX",-1)),(0,r.Lk)("span",Na,(0,we.v_)(s.formatBalance(e.trxBalance)),1)]),(0,r.Lk)("div",Ba,[a[27]||(a[27]=(0,r.Lk)("span",{class:"balance-label"},"USDT",-1)),(0,r.Lk)("span",Oa,(0,we.v_)(s.formatBalance(e.usdtBalance)),1)])])]))),128))])])):(0,r.Q3)("",!0),i.walletMonitoring.payout?.length||i.walletMonitoring.collection?.length||i.walletMonitoring.gasReserve?.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",qa,[(0,r.bF)(C,{description:"暫無錢包數據"})]))])):(0,r.Q3)("",!0)]),_:1})),[[D,i.walletLoading]])])}var Ha=t(8497);const Qa={name:"DashboardView",components:{Refresh:Ie.C42,User:Ie.KJW,Coin:Ie.KOj,Connection:Ie.N_E,Warning:Ie.BFW,Document:Ie.yoT,Money:Ie.v0_,CreditCard:Ie.uWV,TrendCharts:Ie.dlO,Box:Ie.azJ,Lightning:Ie.lMz},data(){return{loading:!0,walletLoading:!1,stats:null,walletMonitoring:null,chartPeriod:"today",chartInstance:null}},watch:{chartPeriod(){this.updateChart()},stats:{handler(){this.$nextTick(()=>{this.updateChart()})},deep:!0}},async created(){await Promise.all([this.fetchStats(),this.fetchWalletMonitoring()])},mounted(){this.initChart()},beforeUnmount(){this.chartInstance&&this.chartInstance.dispose()},methods:{async fetchStats(){this.loading=!0;try{const e=await this.$api.getDashboardStats();this.stats=e}catch(e){console.error("Failed to fetch stats:",e),this.$message.error("獲取統計數據失敗")}finally{this.loading=!1}},async fetchWalletMonitoring(){this.walletLoading=!0;try{const e=await this.$api.getWalletMonitoring();this.walletMonitoring=e}catch(e){console.error("Failed to fetch wallet monitoring:",e),this.$message.error("獲取錢包監控數據失敗")}finally{this.walletLoading=!1}},async refreshWallets(){await this.fetchWalletMonitoring(),this.$message.success("錢包數據已刷新")},async refreshAll(){await Promise.all([this.fetchStats(),this.fetchWalletMonitoring()]),this.$message.success("數據已刷新")},initChart(){this.$refs.chartContainer&&(this.chartInstance=Ha.Ts(this.$refs.chartContainer),this.updateChart(),window.addEventListener("resize",this.handleResize))},handleResize(){this.chartInstance&&this.chartInstance.resize()},updateChart(){if(!this.chartInstance||!this.stats)return;const e=[{name:"當日",data:this.stats.today},{name:"當周",data:this.stats.week},{name:"當月",data:this.stats.month},{name:"上月",data:this.stats.lastMonth}],a=["today","week","month","lastMonth"].indexOf(this.chartPeriod),t=(e[a],{tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:e=>{let a=`<div style="margin-bottom: 4px; font-weight: bold;">${e[0].axisValue}</div>`;return e.forEach(e=>{const t=e.value>=0?e.value:-e.value,l=e.value>=0?"":"-";a+=`<div style="margin: 2px 0;">\n                <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: ${e.color}; margin-right: 5px;"></span>\n                ${e.seriesName}: ${l}${this.formatNumber(t)} USDT\n              </div>`}),a}},legend:{data:["投注金額","派獎金額","盈虧"],top:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.map(e=>e.name)},yAxis:{type:"value",axisLabel:{formatter:e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toFixed(0)}},series:[{name:"投注金額",type:"line",smooth:!0,data:e.map(e=>e.data.totalBetAmount),itemStyle:{color:"#409EFF"},areaStyle:{color:new Ha.fA.W4(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}])}},{name:"派獎金額",type:"line",smooth:!0,data:e.map(e=>e.data.totalPayout),itemStyle:{color:"#67C23A"},areaStyle:{color:new Ha.fA.W4(0,0,0,1,[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.1)"}])}},{name:"盈虧",type:"line",smooth:!0,data:e.map(e=>e.data.profitLoss),itemStyle:{color:"#E6A23C"},markLine:{data:[{yAxis:0,lineStyle:{color:"#909399",type:"dashed"}}]}}]});this.chartInstance.setOption(t)},getCurrentPeriodData(){return this.stats&&this.stats[this.chartPeriod]||{betCount:0,totalBetAmount:0,totalPayout:0,profitLoss:0}},formatNumber(e){return null===e||void 0===e?"0.00":parseFloat(e).toLocaleString("zh-TW",{minimumFractionDigits:2,maximumFractionDigits:2})},formatBalance(e,a=6){if(!e||"0"===e||0===e)return"0";const t=parseFloat(e);return t.toLocaleString("zh-TW",{minimumFractionDigits:2,maximumFractionDigits:0===a?0:6})},maskAddress(e){return e?e.length<=10?e:`${e.substring(0,6)}...${e.substring(e.length-4)}`:""}}},ja=(0,o.A)(Qa,[["render",Ga],["__scopeId","data-v-305237ee"]]),Ya=ja,Za={class:"user-management-container"},Ka=["title"],Ja={key:1,class:"text-muted"};function et(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),c=(0,r.g2)("el-select"),m=(0,r.g2)("el-date-picker"),p=(0,r.g2)("el-button"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-card"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-switch"),_=(0,r.g2)("el-table"),k=(0,r.g2)("el-pagination"),v=(0,r.g2)("el-input-number"),F=(0,r.g2)("el-dialog"),w=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Za,[a[25]||(a[25]=(0,r.Lk)("h2",null,"用户列表",-1)),(0,r.bF)(g,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.userId=e),placeholder:"用户ID (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户帐号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.username,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.username=e),placeholder:"登入帐号 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户昵称"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.nickname,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.nickname=e),placeholder:"昵称 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"自身邀请码"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.inviteCode,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.inviteCode=e),placeholder:"自身邀请码 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"推荐人邀请码"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.referrerCode,"onUpdate:modelValue":a[4]||(a[4]=e=>s.searchParams.referrerCode=e),placeholder:"推荐人邀请码 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"最新登入IP"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.lastLoginIp,"onUpdate:modelValue":a[5]||(a[5]=e=>s.searchParams.lastLoginIp=e),placeholder:"登入IP (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.searchParams.status,"onUpdate:modelValue":a[6]||(a[6]=e=>s.searchParams.status=e),placeholder:"选择状态",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"正常 (active)",value:"active"}),(0,r.bF)(u,{label:"禁用 (banned)",value:"banned"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"注册时间"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[7]||(a[7]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"最新活动时间"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.activityDateRange,"onUpdate:modelValue":a[8]||(a[8]=e=>s.searchParams.activityDateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[18]||(a[18]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{data:s.tableData,style:{width:"100%"},"cell-style":{paddingTop:"8px",paddingBottom:"8px"}},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"user_id",label:"用户ID",width:"120",fixed:"left"}),(0,r.bF)(b,{prop:"username",label:"用户帐号",width:"150"}),(0,r.bF)(b,{prop:"balance",label:"平台余额 (USDT)",width:"150"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.balance)),1)]),_:1}),(0,r.bF)(b,{prop:"nickname",label:"用户昵称",width:"120"}),(0,r.bF)(b,{prop:"level",label:"用户等级",width:"100"}),(0,r.bF)(b,{prop:"invite_code",label:"自身邀请码",width:"130"},{default:(0,r.k6)(e=>[(0,r.bF)(p,{type:"primary",link:"",onClick:a=>o.handleViewReferrals(e.row)},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(e.row.invite_code),1)]),_:2},1032,["onClick"])]),_:1}),(0,r.bF)(b,{prop:"referrer_code",label:"推荐人邀请码",width:"130"}),(0,r.bF)(b,{prop:"last_login_ip",label:"最新登入IP",width:"150"}),(0,r.bF)(b,{prop:"last_activity_at",label:"最新活动时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.last_activity_at)),1)]),_:1}),(0,r.bF)(b,{prop:"user_agent",label:"User Agent","min-width":"250"},{default:(0,r.k6)(e=>[e.row.user_agent?((0,r.uX)(),(0,r.CE)("span",{key:0,title:e.row.user_agent},(0,we.v_)(e.row.user_agent),9,Ka)):((0,r.uX)(),(0,r.CE)("span",Ja,"-"))]),_:1}),(0,r.bF)(b,{prop:"max_streak",label:"最高連胜",width:"100"}),(0,r.bF)(b,{prop:"created_at",label:"注册时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1}),(0,r.bF)(b,{prop:"status",label:"禁用投注",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":"banned","inactive-value":"active","active-text":"禁用","inactive-text":"正常","inline-prompt":"",style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"#13ce66"},onChange:a=>o.handleStatusChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,r.bF)(b,{label:"操作",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(p,{type:"primary",link:"",onClick:a=>o.handleEdit(e.row)},{default:(0,r.k6)(()=>[...a[19]||(a[19]=[(0,r.eW)(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),(0,r.bF)(k,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[9]||(a[9]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[10]||(a[10]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[w,s.loading]]),(0,r.bF)(F,{modelValue:s.editDialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>s.editDialogVisible=e),title:"编辑用户",width:"600px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.bF)(p,{onClick:a[15]||(a[15]=e=>s.editDialogVisible=!1)},{default:(0,r.k6)(()=>[...a[23]||(a[23]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(p,{type:"primary",onClick:o.handleSubmitEdit,loading:s.editLoading},{default:(0,r.k6)(()=>[...a[24]||(a[24]=[(0,r.eW)("确认储存",-1)])]),_:1},8,["onClick","loading"])]),default:(0,r.k6)(()=>[s.editForm.currentUser?((0,r.uX)(),(0,r.Wv)(h,{key:0,ref:"editFormRef",model:s.editForm,rules:s.editFormRules,"label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{value:s.editForm.currentUser.user_id,disabled:""},null,8,["value"])]),_:1}),(0,r.bF)(d,{label:"用户帐号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{value:s.editForm.currentUser.username,disabled:""},null,8,["value"])]),_:1}),(0,r.bF)(d,{label:"平台余额 (USDT)",prop:"balance"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:s.editForm.balance,"onUpdate:modelValue":a[11]||(a[11]=e=>s.editForm.balance=e),min:0,precision:6,placeholder:"用户平台余额"},null,8,["modelValue"]),a[20]||(a[20]=(0,r.Lk)("div",{class:"form-tip"},"(警告：手动修改余额不会留下金流记录)",-1))]),_:1}),(0,r.bF)(d,{label:"用户昵称",prop:"nickname"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.editForm.nickname,"onUpdate:modelValue":a[12]||(a[12]=e=>s.editForm.nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户等级",prop:"level"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:s.editForm.level,"onUpdate:modelValue":a[13]||(a[13]=e=>s.editForm.level=e),min:1,placeholder:"请输入用户等级"},null,8,["modelValue"]),a[21]||(a[21]=(0,r.Lk)("div",{class:"form-tip"},"(注意：手动调整等级不会派发升级奖金)",-1))]),_:1}),(0,r.bF)(d,{label:"推荐人邀请码",prop:"referrer_code"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.editForm.referrer_code,"onUpdate:modelValue":a[14]||(a[14]=e=>s.editForm.referrer_code=e),placeholder:"(留空可清除推薦人)",clearable:""},null,8,["modelValue"]),a[22]||(a[22]=(0,r.Lk)("div",{class:"form-tip"},"(必须是已存在的其他用户的「自身邀请码」)",-1))]),_:1})]),_:1},8,["model","rules"])):(0,r.Q3)("",!0)]),_:1},8,["modelValue"]),(0,r.bF)(F,{modelValue:s.referralDialogVisible,"onUpdate:modelValue":a[17]||(a[17]=e=>s.referralDialogVisible=e),title:`查看 ${s.referralData.inviteCode} 的推薦列表`,width:"700px","close-on-click-modal":!1},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(_,{data:s.referralData.list},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"user_id",label:"用户ID"}),(0,r.bF)(b,{prop:"nickname",label:"昵称"}),(0,r.bF)(b,{prop:"created_at",label:"注册时间"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1})]),_:1},8,["data"])),[[w,s.referralData.loading]])]),_:1},8,["modelValue","title"])])}const at={name:"UserManagementView",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:10},searchParams:{userId:"",username:"",dateRange:null,nickname:"",status:"",inviteCode:"",referrerCode:"",lastLoginIp:"",activityDateRange:null},editDialogVisible:!1,editLoading:!1,editForm:{currentUser:null,nickname:"",level:1,referrer_code:"",balance:0},editFormRules:{nickname:[{max:50,message:"昵称长度不能超过 50 个字符",trigger:"blur"}],level:[{required:!0,message:"等级不能为空"},{type:"integer",min:1,message:"等级必须是正整数",trigger:"blur"}],referrer_code:[{max:8,message:"邀请码长度不能超过 8 个字符",trigger:"blur"}],balance:[{required:!0,message:"余额不能为空"},{type:"number",min:0,message:"余额必须是非负数",trigger:"blur"}]},referralDialogVisible:!1,referralData:{loading:!1,inviteCode:"",list:[]}}},created(){this.fetchUsers()},methods:{async fetchUsers(){if(!this.loading){this.loading=!0;try{const e={...this.pagination,userId:this.searchParams.userId||void 0,username:this.searchParams.username||void 0,dateRange:this.searchParams.dateRange?JSON.stringify(this.searchParams.dateRange):void 0,nickname:this.searchParams.nickname||void 0,status:this.searchParams.status||void 0,inviteCode:this.searchParams.inviteCode||void 0,referrerCode:this.searchParams.referrerCode||void 0,lastLoginIp:this.searchParams.lastLoginIp||void 0,activityDateRange:this.searchParams.activityDateRange?JSON.stringify(this.searchParams.activityDateRange):void 0},a=await this.$api.getUsers(e);this.tableData=a.list,this.totalItems=a.total}catch(e){console.error("Failed to fetch users:",e)}finally{this.loading=!1}}},async handleStatusChange(e){const a=e.status,t="active"===a?"banned":"active";try{await this.$api.updateUserStatus(e.id,a),p.nk.success(`用户 ${e.user_id} 狀态已更新为 ${a}`)}catch(l){console.error("Failed to update status:",l),e.status=t}},handleSearch(){this.pagination.page=1,this.fetchUsers()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchUsers()},handlePageChange(e){this.pagination.page=e,this.fetchUsers()},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}},formatCurrency(e){if(null===e||void 0===e)return"0.00";try{const a=parseFloat(e);return isNaN(a)?"0.00":a.toFixed(2)}catch(a){return"0.00"}},handleEdit(e){this.editForm.currentUser=e,this.editForm.nickname=e.nickname||"",this.editForm.level=e.level,this.editForm.referrer_code=e.referrer_code||"",this.editForm.balance=parseFloat(e.balance)||0,this.editDialogVisible=!0,this.$nextTick(()=>{this.$refs.editFormRef?.clearValidate()})},async handleSubmitEdit(){const e=this.$refs.editFormRef;e&&await e.validate(async e=>{if(!e)return!1;this.editLoading=!0;try{const e={nickname:this.editForm.nickname,level:this.editForm.level,referrer_code:this.editForm.referrer_code||null,balance:this.editForm.balance};await this.$api.updateUser(this.editForm.currentUser.id,e),p.nk.success("用户资料更新成功"),this.editDialogVisible=!1,await this.fetchUsers()}catch(a){console.error("Failed to update user:",a)}finally{this.editLoading=!1}})},async handleViewReferrals(e){this.referralData.inviteCode=e.invite_code,this.referralData.list=[],this.referralData.loading=!0,this.referralDialogVisible=!0;try{const a=await this.$api.getReferrals(e.invite_code);this.referralData.list=a}catch(a){console.error("Failed to fetch referrals:",a),p.nk.error("载入推薦列表失败")}finally{this.referralData.loading=!1}}}},tt=(0,o.A)(at,[["render",et],["__scopeId","data-v-11edd549"]]),lt=tt,it={class:"user-addresses-container"};function rt(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-button"),c=(0,r.g2)("el-form"),m=(0,r.g2)("el-card"),p=(0,r.g2)("el-table-column"),h=(0,r.g2)("el-table"),g=(0,r.g2)("el-pagination"),b=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",it,[a[8]||(a[8]=(0,r.Lk)("h2",null,"用户充值地址",-1)),a[9]||(a[9]=(0,r.Lk)("p",{class:"page-description"},"查看由 HD 钱包派生给所有用户的专属充值地址。",-1)),(0,r.bF)(m,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.userId=e),placeholder:"用户ID (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户帐号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.username,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.username=e),placeholder:"登入帐号 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"TRC20 地址"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.tronAddress,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.tronAddress=e),placeholder:"TRC20 地址 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"EVM 地址"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.evmAddress,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.evmAddress=e),placeholder:"EVM 地址 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"派生索引"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.pathIndex,"onUpdate:modelValue":a[4]||(a[4]=e=>s.searchParams.pathIndex=e),modelModifiers:{number:!0},type:"number",placeholder:"索引 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(p,{prop:"user_id",label:"用户ID",width:"120",fixed:"left"}),(0,r.bF)(p,{prop:"username",label:"用户帐号",width:"150"}),(0,r.bF)(p,{prop:"deposit_path_index",label:"派生索引 (Path)",width:"150",sortable:""}),(0,r.bF)(p,{label:"TRC20 地址 (T...)"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.tron_deposit_address_masked||e.row.tron_deposit_address),1)]),_:1}),(0,r.bF)(p,{label:"EVM 地址 (0x...)"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.evm_deposit_address_masked||e.row.evm_deposit_address),1)]),_:1})]),_:1},8,["data"]),(0,r.bF)(g,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[5]||(a[5]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[6]||(a[6]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[b,s.loading]])])}const st={name:"UserDepositAddressesView",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:10},searchParams:{userId:"",username:"",tronAddress:"",evmAddress:"",pathIndex:null}}},created(){this.fetchAddresses()},methods:{async fetchAddresses(){if(!this.loading){this.loading=!0;try{const e={...this.pagination,userId:this.searchParams.userId||void 0,username:this.searchParams.username||void 0,tronAddress:this.searchParams.tronAddress||void 0,evmAddress:this.searchParams.evmAddress||void 0,pathIndex:this.searchParams.pathIndex||void 0},a=await this.$api.getUserDepositAddresses(e);this.tableData=a.list,this.totalItems=a.total}catch(e){console.error("Failed to fetch user addresses:",e)}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchAddresses()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchAddresses()},handlePageChange(e){this.pagination.page=e,this.fetchAddresses()}}},ot=(0,o.A)(st,[["render",rt],["__scopeId","data-v-a6f729cc"]]),nt=ot,dt={class:"bet-management-container"},ut=["href"],ct={key:1},mt={key:0},pt={key:1,class:"text-muted"};function ht(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),c=(0,r.g2)("el-select"),m=(0,r.g2)("el-date-picker"),p=(0,r.g2)("el-button"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-card"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-tag"),_=(0,r.g2)("el-table"),k=(0,r.g2)("el-pagination"),v=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",dt,[a[7]||(a[7]=(0,r.Lk)("h2",null,"注单列表",-1)),(0,r.bF)(g,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"注单编号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.betId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.betId=e),placeholder:"注单编号 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.userId,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.userId=e),placeholder:"用户ID (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"注单状态"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.searchParams.status,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.status=e),placeholder:"选择状态",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"处理中",value:"pending"}),(0,r.bF)(u,{label:"中奖",value:"won"}),(0,r.bF)(u,{label:"未中奖",value:"lost"}),(0,r.bF)(u,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"下注完成时间"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","unlink-panels":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{data:s.tableData,style:{width:"100%"},"cell-style":{paddingTop:"8px",paddingBottom:"8px"}},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"id",label:"注单编号",width:"100"}),(0,r.bF)(b,{prop:"user_id",label:"用户ID",width:"120"}),(0,r.bF)(b,{prop:"game_type",label:"游戏类型",width:"120"}),(0,r.bF)(b,{prop:"choice",label:"下注内容",width:"100"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatChoice(e.row.choice)),1)]),_:1}),(0,r.bF)(b,{prop:"amount",label:"投注金额 (USDT)",width:"150"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.amount)),1)]),_:1}),(0,r.bF)(b,{label:"中奖金额 (USDT)",width:"150"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatPrize(e.row)),1)]),_:1}),(0,r.bF)(b,{prop:"tx_hash",label:"开奖 Hash",width:"180"},{default:(0,r.k6)(e=>[e.row.tx_hash?((0,r.uX)(),(0,r.CE)("a",{key:0,href:`https://sepolia.etherscan.io/tx/${e.row.tx_hash}`,target:"_blank",class:"tx-link"},(0,we.v_)(e.row.tx_hash.substring(0,10))+"... ",9,ut)):((0,r.uX)(),(0,r.CE)("span",ct,"-"))]),_:1}),(0,r.bF)(b,{prop:"bet_ip",label:"投注IP",width:"150"},{default:(0,r.k6)(e=>[e.row.bet_ip?((0,r.uX)(),(0,r.CE)("span",mt,(0,we.v_)(e.row.bet_ip),1)):((0,r.uX)(),(0,r.CE)("span",pt,"-"))]),_:1}),(0,r.bF)(b,{prop:"bet_time",label:"下注时间 (系统)",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.bet_time)),1)]),_:1}),(0,r.bF)(b,{prop:"settle_time",label:"开奖时间 (系统)",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.settle_time)),1)]),_:1}),(0,r.bF)(b,{prop:"status",label:"注单状态",width:"120",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{type:o.getStatusTagType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(o.formatStatus(e.row.status)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),(0,r.bF)(k,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[4]||(a[4]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[5]||(a[5]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[v,s.loading]])])}const gt=()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]},bt=e=>{if(!Array.isArray(e)||2!==e.length)return null;const[a,t]=e,l=a instanceof Date&&!isNaN(a)?a.toISOString():null,i=t instanceof Date&&!isNaN(t)?t.toISOString():null;return l&&i?[l,i]:null},ft={name:"BetManagementView",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:10},searchParams:{betId:"",userId:"",status:"",dateRange:gt()}}},created(){this.handleSearch()},methods:{async fetchBets(){if(!this.loading){this.loading=!0;try{const e=bt(this.searchParams.dateRange),a={...this.pagination,betId:this.searchParams.betId||void 0,userId:this.searchParams.userId||void 0,status:this.searchParams.status||void 0,dateRange:e?JSON.stringify(e):void 0},t=await this.$api.getBets(a);this.tableData=t.list,this.totalItems=t.total}catch(e){console.error("Failed to fetch bets:",e)}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchBets()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchBets()},handlePageChange(e){this.pagination.page=e,this.fetchBets()},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}},formatStatus(e){const a={pending:"处理中",won:"中奖",lost:"未中奖",failed:"失败"};return a[e]||e},getStatusTagType(e){const a={pending:"info",won:"success",lost:"danger",failed:"danger"};return a[e]||"default"},formatChoice(e){return"head"===e?"正面":"tail"===e?"反面":e},formatCurrency(e){if(null===e||void 0===e)return"";if(0===parseFloat(e))return"-";try{const a=parseFloat(e);return isNaN(a)?"N/A":a.toFixed(2)}catch(a){return"N/A"}},formatPrize(e){if("won"===e.status)try{const a=parseFloat(e.amount),t=parseInt(e.payout_multiplier,10)||2,l=a*t;return this.formatCurrency(l)}catch(a){return"计算错误"}return"-"}}},_t=(0,o.A)(ft,[["render",ht],["__scopeId","data-v-5cbf428c"]]),kt=_t,vt={class:"report-management-container"},Ft={key:0,class:"report-grid"},wt={class:"report-item"},yt={class:"report-value"},Ct={class:"report-item"},Dt={class:"report-value"},Lt={class:"report-item info"},Vt={class:"report-value"},Pt={class:"report-item info"},It={class:"report-value"},Wt={class:"report-item info"},St={class:"report-value"},Tt={class:"report-item gas-fee"},xt={class:"report-value"},Rt={class:"report-label"},Ut={class:"report-value"},$t={class:"report-label"},At={class:"report-value"};function Xt(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-date-picker"),c=(0,r.g2)("el-button"),m=(0,r.g2)("el-form"),p=(0,r.g2)("el-card"),h=(0,r.g2)("InfoFilled"),g=(0,r.g2)("el-icon"),b=(0,r.g2)("el-tooltip"),f=(0,r.g2)("el-empty"),_=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",vt,[a[13]||(a[13]=(0,r.Lk)("h2",null,"盈虧报表",-1)),(0,r.bF)(p,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户ID/钱包地址"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.userQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.userQuery=e),placeholder:"输入 'system' 查全平台",clearable:""},null,8,["modelValue"]),a[2]||(a[2]=(0,r.Lk)("div",{class:"form-tip"}," (模糊搜寻。若查询用户名为 system，则查询计算全平台) ",-1))]),_:1}),(0,r.bF)(d,{label:"时间"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:!1,"unlink-panels":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",onClick:o.handleSearch,loading:s.loading},{default:(0,r.k6)(()=>[...a[3]||(a[3]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(p,{shadow:"never",class:"result-card"},{header:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.Lk)("div",null,"查询结果",-1)])]),default:(0,r.k6)(()=>[s.reportData?((0,r.uX)(),(0,r.CE)("div",Ft,[(0,r.Lk)("div",wt,[a[5]||(a[5]=(0,r.Lk)("div",{class:"report-label"},"投注 (总额)",-1)),(0,r.Lk)("div",yt,(0,we.v_)(o.formatCurrency(s.reportData.total_bet))+" USDT",1)]),(0,r.Lk)("div",Ct,[a[6]||(a[6]=(0,r.Lk)("div",{class:"report-label"},"派奖 (总额)",-1)),(0,r.Lk)("div",Dt,(0,we.v_)(o.formatCurrency(s.reportData.total_payout))+" USDT",1)]),(0,r.Lk)("div",Lt,[a[7]||(a[7]=(0,r.Lk)("div",{class:"report-label"},"用户等级奖金",-1)),(0,r.Lk)("div",Vt,(0,we.v_)(o.formatCurrency(s.reportData.bonus_level))+" USDT",1)]),(0,r.Lk)("div",Pt,[a[8]||(a[8]=(0,r.Lk)("div",{class:"report-label"},"活动奖金",-1)),(0,r.Lk)("div",It,(0,we.v_)(o.formatCurrency(s.reportData.bonus_event))+" USDT",1)]),(0,r.Lk)("div",Wt,[a[9]||(a[9]=(0,r.Lk)("div",{class:"report-label"},"反佣",-1)),(0,r.Lk)("div",St,(0,we.v_)(o.formatCurrency(s.reportData.bonus_commission))+" USDT",1)]),(0,r.Lk)("div",Tt,[a[10]||(a[10]=(0,r.Lk)("div",{class:"report-label"},"总手续费 (Gas)",-1)),(0,r.Lk)("div",xt,(0,we.v_)(o.formatCurrency(s.reportData.total_gas_fee))+" USDT",1)]),(0,r.Lk)("div",{class:(0,we.C4)(["report-item",s.reportData.platform_profit>=0?"profit":"loss"])},[(0,r.Lk)("div",Rt,[a[11]||(a[11]=(0,r.Lk)("span",null,"平台盈虧",-1)),(0,r.bF)(b,{effect:"dark",content:"公式：投注总额 - 派奖总额",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1})]),_:1})]),(0,r.Lk)("div",Ut,(0,we.v_)(o.formatCurrency(s.reportData.platform_profit))+" USDT",1)],2),(0,r.Lk)("div",{class:(0,we.C4)(["report-item","net-profit",s.reportData.platform_net_profit>=0?"profit":"loss"])},[(0,r.Lk)("div",$t,[a[12]||(a[12]=(0,r.Lk)("span",null,"平台 *净* 营利",-1)),(0,r.bF)(b,{effect:"dark",content:"公式：投注 - 派奖 - 奖金 - 手续费",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1})]),_:1})]),(0,r.Lk)("div",At,(0,we.v_)(o.formatCurrency(s.reportData.platform_net_profit))+" USDT",1)],2)])):((0,r.uX)(),(0,r.Wv)(f,{key:1,description:"请选择时间范围并点击查询"}))]),_:1})),[[_,s.loading]])])}const Et=()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]},zt=e=>{if(!Array.isArray(e)||2!==e.length)return null;const[a,t]=e,l=a instanceof Date&&!isNaN(a)?a.toISOString():null,i=t instanceof Date&&!isNaN(t)?t.toISOString():null;return l&&i?[l,i]:null},Mt={name:"ReportManagementView",components:{InfoFilled:Ie.N_H},data(){return{loading:!1,searchParams:{dateRange:Et(),userQuery:"system"},reportData:null}},created(){this.handleSearch()},methods:{async handleSearch(){if(this.searchParams.dateRange)if(this.searchParams.userQuery){this.loading=!0,this.reportData=null;try{const e=zt(this.searchParams.dateRange);if(!e)return p.nk.error("时间范围选择无效，请重新选择"),void(this.loading=!1);const a={dateRange:JSON.stringify(e),userQuery:this.searchParams.userQuery.trim()},t=await this.$api.getProfitLossReport(a);this.reportData=t}catch(e){console.error("Failed to fetch profit-loss report:",e)}finally{this.loading=!1}}else p.nk.error("请指定查询对象 (输入用户ID/钱包地址，或输入 system 查询全平台)");else p.nk.error("请选择时间范围")},formatCurrency(e){if(null===e||void 0===e)return"0.00";if("number"!==typeof e)try{if(e=parseFloat(e),isNaN(e))return"0.00"}catch(a){return"0.00"}return e.toFixed(2)}}},Nt=(0,o.A)(Mt,[["render",Xt],["__scopeId","data-v-0a2189b6"]]),Bt=Nt,Ot={class:"wallet-monitoring-container"},qt={key:1,class:"collection-settings-block"};function Gt(e,a,t,l,s,o){const n=(0,r.g2)("el-button"),d=(0,r.g2)("el-card"),u=(0,r.g2)("el-input"),c=(0,r.g2)("el-form-item"),m=(0,r.g2)("el-option"),p=(0,r.g2)("el-select"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-table-column"),b=(0,r.g2)("el-tag"),f=(0,r.g2)("el-table"),_=(0,r.g2)("el-pagination"),k=(0,r.g2)("el-divider"),v=(0,r.g2)("el-checkbox"),F=(0,r.g2)("el-switch"),w=(0,r.g2)("el-input-number"),y=(0,r.g2)("el-dialog"),C=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Ot,[a[33]||(a[33]=(0,r.Lk)("h2",null,"钱包监控",-1)),a[34]||(a[34]=(0,r.eW)()),a[35]||(a[35]=(0,r.Lk)("p",{class:"page-description"},"管理平台用于 充值、提現、开奖、归集 的热钱包地址。",-1)),(0,r.bF)(d,{shadow:"never",class:"action-card"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{type:"primary",onClick:o.handleAdd},{default:(0,r.k6)(()=>[...a[18]||(a[18]=[(0,r.eW)("新增钱包",-1)])]),_:1},8,["onClick"])]),_:1}),(0,r.bF)(d,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"钱包名称"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.searchParams.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.name=e),placeholder:"名称 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"公链类型"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.searchParams.chain_type,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.chain_type=e),placeholder:"选择公链",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"全部",value:""}),(0,r.bF)(m,{label:"BSC (BEP20)",value:"BSC"}),(0,r.bF)(m,{label:"TRON (TRC20)",value:"TRC20"}),(0,r.bF)(m,{label:"ETH (ERC20)",value:"ETH"}),(0,r.bF)(m,{label:"Polygon",value:"POLYGON"}),(0,r.bF)(m,{label:"Solana",value:"SOL"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"钱包地址"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.searchParams.address,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.address=e),placeholder:"地址 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(n,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[19]||(a[19]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(d,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(f,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(g,{prop:"name",label:"钱包名称",width:"180"}),(0,r.bF)(g,{prop:"chain_type",label:"公链类型",width:"120"}),(0,r.bF)(g,{label:"钱包地址"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.address_masked||e.row.address),1)]),_:1}),(0,r.bF)(g,{label:"功能",width:"420"},{default:(0,r.k6)(e=>[e.row.is_gas_reserve?((0,r.uX)(),(0,r.Wv)(b,{key:0,type:"success",effect:"dark",class:"fn-tag"},{default:(0,r.k6)(()=>[...a[20]||(a[20]=[(0,r.eW)("Gas 储备",-1)])]),_:1})):(0,r.Q3)("",!0),e.row.is_collection?((0,r.uX)(),(0,r.Wv)(b,{key:1,type:"danger",effect:"dark",class:"fn-tag"},{default:(0,r.k6)(()=>[...a[21]||(a[21]=[(0,r.eW)("归集",-1)])]),_:1})):(0,r.Q3)("",!0),e.row.is_payout?((0,r.uX)(),(0,r.Wv)(b,{key:2,type:"warning",effect:"dark",class:"fn-tag"},{default:(0,r.k6)(()=>[...a[22]||(a[22]=[(0,r.eW)("自动出款",-1)])]),_:1})):(0,r.Q3)("",!0),a[25]||(a[25]=(0,r.eW)()),e.row.is_opener_a?((0,r.uX)(),(0,r.Wv)(b,{key:3,class:"fn-tag"},{default:(0,r.k6)(()=>[...a[23]||(a[23]=[(0,r.eW)("开奖A",-1)])]),_:1})):(0,r.Q3)("",!0),e.row.is_opener_b?((0,r.uX)(),(0,r.Wv)(b,{key:4,class:"fn-tag"},{default:(0,r.k6)(()=>[...a[24]||(a[24]=[(0,r.eW)("开奖B",-1)])]),_:1})):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(g,{prop:"is_active",label:"狀态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(b,{type:e.row.is_active?"success":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(e.row.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(g,{label:"操作",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(n,{type:"primary",link:"",onClick:a=>o.handleEdit(e.row)},{default:(0,r.k6)(()=>[...a[26]||(a[26]=[(0,r.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,r.bF)(n,{type:"danger",link:"",onClick:a=>o.handleDelete(e.row)},{default:(0,r.k6)(()=>[...a[27]||(a[27]=[(0,r.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),(0,r.bF)(_,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[3]||(a[3]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[4]||(a[4]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[C,s.loading]]),(0,r.bF)(y,{modelValue:s.dialogVisible,"onUpdate:modelValue":a[17]||(a[17]=e=>s.dialogVisible=e),title:s.dialogTitle,width:"700px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.bF)(n,{onClick:a[16]||(a[16]=e=>s.dialogVisible=!1)},{default:(0,r.k6)(()=>[...a[31]||(a[31]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(n,{type:"primary",onClick:o.handleSubmit,loading:s.submitLoading},{default:(0,r.k6)(()=>[...a[32]||(a[32]=[(0,r.eW)("确认",-1)])]),_:1},8,["onClick","loading"])]),default:(0,r.k6)(()=>[(0,r.bF)(h,{ref:"walletFormRef",model:s.walletForm,rules:s.formRules,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"钱包名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.walletForm.name,"onUpdate:modelValue":a[5]||(a[5]=e=>s.walletForm.name=e),placeholder:"请输入钱包名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"公链类型",prop:"chain_type"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.walletForm.chain_type,"onUpdate:modelValue":a[6]||(a[6]=e=>s.walletForm.chain_type=e),placeholder:"请选择公链"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"BSC (BEP20)",value:"BSC"}),(0,r.bF)(m,{label:"TRON (TRC20)",value:"TRC20"}),(0,r.bF)(m,{label:"ETH (ERC20)",value:"ETH"}),(0,r.bF)(m,{label:"Polygon",value:"POLYGON"}),(0,r.bF)(m,{label:"Solana",value:"SOL"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"钱包地址",prop:"address"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.walletForm.address,"onUpdate:modelValue":a[7]||(a[7]=e=>s.walletForm.address=e),placeholder:"请输入钱包地址 (T... 或 0x... 或 Sol...)"},null,8,["modelValue"])]),_:1}),(0,r.bF)(k),(0,r.bF)(c,{label:"钱包功能",prop:"functions"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:s.walletForm.is_gas_reserve,"onUpdate:modelValue":a[8]||(a[8]=e=>s.walletForm.is_gas_reserve=e),label:"Gas 储备 (TRX/BNB)"},null,8,["modelValue"]),(0,r.bF)(v,{modelValue:s.walletForm.is_collection,"onUpdate:modelValue":a[9]||(a[9]=e=>s.walletForm.is_collection=e),label:"归集 (USDT)"},null,8,["modelValue"]),(0,r.bF)(v,{modelValue:s.walletForm.is_payout,"onUpdate:modelValue":a[10]||(a[10]=e=>s.walletForm.is_payout=e),label:"自动出款 (USDT)"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"开奖功能",prop:"opener"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:s.walletForm.is_opener_a,"onUpdate:modelValue":a[11]||(a[11]=e=>s.walletForm.is_opener_a=e),label:"开奖地址 A (支付方)"},null,8,["modelValue"]),(0,r.bF)(v,{modelValue:s.walletForm.is_opener_b,"onUpdate:modelValue":a[12]||(a[12]=e=>s.walletForm.is_opener_b=e),label:"开奖地址 B (接收方)"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"钱包狀态",prop:"is_active"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{modelValue:s.walletForm.is_active,"onUpdate:modelValue":a[13]||(a[13]=e=>s.walletForm.is_active=e),"active-text":"启用","inactive-text":"禁用","inline-prompt":""},null,8,["modelValue"])]),_:1}),s.walletForm.is_collection?((0,r.uX)(),(0,r.Wv)(k,{key:0})):(0,r.Q3)("",!0),s.walletForm.is_collection?((0,r.uX)(),(0,r.CE)("div",qt,[a[30]||(a[30]=(0,r.Lk)("h4",null,"归集参数设定",-1)),(0,r.bF)(c,{label:"每x天扫描一次",prop:"scan_interval_days"},{default:(0,r.k6)(()=>[(0,r.bF)(w,{modelValue:s.walletForm.scan_interval_days,"onUpdate:modelValue":a[14]||(a[14]=e=>s.walletForm.scan_interval_days=e),min:1,max:30,style:{width:"200px"},placeholder:"天数"},null,8,["modelValue"]),a[28]||(a[28]=(0,r.Lk)("div",{class:"form-tip"},"每隔多少天执行一次归集扫描",-1))]),_:1}),(0,r.bF)(c,{label:"用户n天無充值时归集",prop:"days_without_deposit"},{default:(0,r.k6)(()=>[(0,r.bF)(w,{modelValue:s.walletForm.days_without_deposit,"onUpdate:modelValue":a[15]||(a[15]=e=>s.walletForm.days_without_deposit=e),min:1,max:365,style:{width:"200px"},placeholder:"天数"},null,8,["modelValue"]),a[29]||(a[29]=(0,r.Lk)("div",{class:"form-tip"},"用户最後一笔充值後多少天無新充值，則执行归集",-1))]),_:1})])):(0,r.Q3)("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const Ht={name:"WalletMonitoringView",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:10},searchParams:{name:"",chain_type:"",address:""},dialogVisible:!1,dialogTitle:"",submitLoading:!1,walletForm:{id:null,name:"",chain_type:"TRC20",address:"",is_gas_reserve:!1,is_collection:!1,is_opener_a:!1,is_opener_b:!1,is_payout:!1,is_active:!0,scan_interval_days:1,days_without_deposit:7},formRules:{name:[{required:!0,message:"请输入钱包名称",trigger:"blur"}],chain_type:[{required:!0,message:"请选择公链类型",trigger:"change"}],address:[{required:!0,message:"请输入钱包地址",trigger:"blur"}]}}},created(){this.fetchWallets()},methods:{async fetchWallets(){if(!this.loading){this.loading=!0;try{const e={...this.pagination,name:this.searchParams.name||void 0,chain_type:this.searchParams.chain_type||void 0,address:this.searchParams.address||void 0},a=await this.$api.getWallets(e);this.tableData=a.list,this.totalItems=a.total}catch(e){console.error("Failed to fetch wallets:",e)}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchWallets()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchWallets()},handlePageChange(e){this.pagination.page=e,this.fetchWallets()},getEmptyForm(){return{id:null,name:"",chain_type:"TRC20",address:"",is_gas_reserve:!1,is_collection:!1,is_opener_a:!1,is_opener_b:!1,is_payout:!1,is_active:!0,scan_interval_days:1,days_without_deposit:7}},handleAdd(){this.dialogTitle="新增平台钱包",Object.assign(this.walletForm,this.getEmptyForm()),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.walletFormRef?.clearValidate()})},async handleEdit(e){if(this.dialogTitle="编辑平台钱包",Object.assign(this.walletForm,{id:e.id,name:e.name,chain_type:e.chain_type,address:e.address,is_gas_reserve:e.is_gas_reserve,is_collection:e.is_collection,is_opener_a:e.is_opener_a,is_opener_b:e.is_opener_b,is_payout:e.is_payout,is_active:e.is_active,scan_interval_days:1,days_without_deposit:7}),e.is_collection&&e.address)try{const a=await this.$api.getCollectionSettings(),t=a.find(a=>a.collection_wallet_address===e.address);t&&(this.walletForm.scan_interval_days=t.scan_interval_days,this.walletForm.days_without_deposit=t.days_without_deposit)}catch(a){console.error("Failed to load collection settings:",a)}this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.walletFormRef?.clearValidate()})},async handleSubmit(){const e=this.$refs.walletFormRef;e&&await e.validate(async e=>{if(!e)return!1;this.submitLoading=!0;try{if(this.walletForm.id){if(await this.$api.updateWallet(this.walletForm.id,this.walletForm),this.walletForm.is_collection&&this.walletForm.address)try{await this.$api.updateCollectionSettings({collection_wallet_address:this.walletForm.address,scan_interval_days:this.walletForm.scan_interval_days,days_without_deposit:this.walletForm.days_without_deposit,is_active:!0})}catch(a){console.error("Failed to update collection settings:",a)}p.nk.success("钱包更新成功")}else{if(await this.$api.addWallet(this.walletForm),this.walletForm.is_collection&&this.walletForm.address)try{await this.$api.updateCollectionSettings({collection_wallet_address:this.walletForm.address,scan_interval_days:this.walletForm.scan_interval_days,days_without_deposit:this.walletForm.days_without_deposit,is_active:!0})}catch(a){console.error("Failed to create collection settings:",a)}p.nk.success("钱包新增成功")}this.dialogVisible=!1,this.fetchWallets()}catch(a){console.error("Failed to submit wallet:",a),p.nk.error("操作失败："+(a.response?.data?.error||a.message))}finally{this.submitLoading=!1}})},handleDelete(e){b.s.confirm(`确定要刪除钱包 "${e.name}" (${e.address}) 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.deleteWallet(e.id),p.nk.success("钱包刪除成功"),this.fetchWallets()}catch(a){console.error("Failed to delete wallet:",a)}}).catch(()=>{})}}},Qt=(0,o.A)(Ht,[["render",Gt],["__scopeId","data-v-3f43e34c"]]),jt=Qt,Yt={class:"withdrawal-review-container"},Zt={class:"title-with-tip"},Kt=["href"],Jt={key:1},el={key:0},al={key:1},tl={key:2};function ll(e,a,t,l,s,o){const n=(0,r.g2)("el-tooltip"),d=(0,r.g2)("el-input"),u=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),m=(0,r.g2)("el-select"),p=(0,r.g2)("el-date-picker"),h=(0,r.g2)("el-button"),g=(0,r.g2)("el-form"),b=(0,r.g2)("el-card"),f=(0,r.g2)("el-table-column"),_=(0,r.g2)("el-tag"),k=(0,r.g2)("InfoFilled"),v=(0,r.g2)("el-icon"),F=(0,r.g2)("el-table"),w=(0,r.g2)("el-pagination"),y=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Yt,[(0,r.Lk)("h2",Zt,[a[9]||(a[9]=(0,r.eW)(" 提款審核 ",-1)),(0,r.bF)(n,{content:"審核：批准改為出款中；拒绝退回余额；完成需填写TX Hash與Gas",placement:"right"},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.Lk)("span",{class:"info-tag"},"i",-1)])]),_:1})]),(0,r.bF)(b,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"用户名"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.searchParams.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.username=e),placeholder:"用户名 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.searchParams.user_id,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.user_id=e),placeholder:"精确用户ID",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"提款地址"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.searchParams.address,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.address=e),placeholder:"地址 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"TX Hash"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.searchParams.tx_hash,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.tx_hash=e),placeholder:"Hash (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"提款狀态"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.status,"onUpdate:modelValue":a[4]||(a[4]=e=>s.searchParams.status=e),placeholder:"选择状态",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"待審核",value:"pending"}),(0,r.bF)(c,{label:"審核拒绝",value:"rejected"}),(0,r.bF)(c,{label:"出款中",value:"processing"}),(0,r.bF)(c,{label:"出款完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"发起时间"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[5]||(a[5]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","unlink-panels":"",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(h,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(f,{prop:"id",label:"ID",width:"80"}),(0,r.bF)(f,{prop:"username",label:"用户名",width:"130"}),(0,r.bF)(f,{prop:"user_id",label:"用户ID",width:"120"}),(0,r.bF)(f,{prop:"chain_type",label:"区块链",width:"100"}),(0,r.bF)(f,{prop:"address",label:"提款地址"}),(0,r.bF)(f,{prop:"amount",label:"提款金额",width:"120",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.amount)),1)]),_:1}),(0,r.bF)(f,{prop:"total_profit_loss",label:"累计盈虧",width:"120",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.total_profit_loss)),1)]),_:1}),(0,r.bF)(f,{prop:"gas_fee",label:"Gas 成本",width:"100"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.gas_fee,!0)),1)]),_:1}),(0,r.bF)(f,{prop:"request_time",label:"发起时间",width:"170"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.request_time)),1)]),_:1}),(0,r.bF)(f,{prop:"review_time",label:"審核时间",width:"170"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.review_time)),1)]),_:1}),(0,r.bF)(f,{prop:"reviewer_name",label:"審核人",width:"100"}),(0,r.bF)(f,{prop:"tx_hash",label:"出款 Hash",width:"120"},{default:(0,r.k6)(e=>[e.row.tx_hash?((0,r.uX)(),(0,r.CE)("a",{key:0,href:o.getTxLink(e.row.chain_type,e.row.tx_hash),target:"_blank",class:"tx-link"},(0,we.v_)(e.row.tx_hash.substring(0,10))+"... ",9,Kt)):((0,r.uX)(),(0,r.CE)("span",Jt,"-"))]),_:1}),(0,r.bF)(f,{prop:"status",label:"狀态",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(_,{type:o.getStatusTagType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(o.formatStatus(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(f,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(t=>["pending"===t.row.status?((0,r.uX)(),(0,r.CE)("div",el,[e.$permissions.has("withdrawals","update")?((0,r.uX)(),(0,r.Wv)(h,{key:0,type:"success",link:"",onClick:e=>o.handleApprove(t.row)},{default:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)("批准",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0),e.$permissions.has("withdrawals","update")?((0,r.uX)(),(0,r.Wv)(h,{key:1,type:"danger",link:"",onClick:e=>o.handleReject(t.row)},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("拒绝",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),"processing"===t.row.status?((0,r.uX)(),(0,r.CE)("div",al,[e.$permissions.has("withdrawals","update")?((0,r.uX)(),(0,r.Wv)(h,{key:0,type:"primary",link:"",onClick:e=>o.handleComplete(t.row)},{default:(0,r.k6)(()=>[...a[13]||(a[13]=[(0,r.eW)("手动完成",-1)])]),_:1},8,["onClick"])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),"rejected"===t.row.status?((0,r.uX)(),(0,r.CE)("div",tl,[(0,r.bF)(n,{content:t.row.rejection_reason||"無理由",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(v,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1})]),_:1},8,["content"])])):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["data"]),(0,r.bF)(w,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[6]||(a[6]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[7]||(a[7]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[y,s.loading]])])}const il=()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]},rl={name:"WithdrawalReview",components:{InfoFilled:Ie.N_H},data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:10},searchParams:{username:"",user_id:"",status:"",address:"",tx_hash:"",dateRange:il()}}},created(){this.handleSearch()},methods:{async fetchData(){if(!this.loading){this.loading=!0;try{const e={...this.pagination,username:this.searchParams.username||void 0,status:this.searchParams.status||void 0,address:this.searchParams.address||void 0,tx_hash:this.searchParams.tx_hash||void 0,user_id:this.searchParams.user_id||void 0};if(this.searchParams.dateRange&&2===this.searchParams.dateRange.length){const[a,t]=this.searchParams.dateRange;a instanceof Date&&!isNaN(a)&&(e.start_time=a.toISOString()),t instanceof Date&&!isNaN(t)&&(e.end_time=t.toISOString())}const a=await this.$api.getWithdrawals(e);this.tableData=a.list,this.totalItems=a.total}catch(e){console.error("Failed to fetch withdrawals:",e),p.nk.error("获取数据失败")}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchData()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchData()},handlePageChange(e){this.pagination.page=e,this.fetchData()},handleApprove(e){b.s.confirm(`确定要批准用户 [${e.username}] 的 ${e.amount} USDT 提款吗？<br>狀态将变为 [出款中]，等待财务手动操作。`,"批准确认",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定批准",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.approveWithdrawal(e.id),p.nk.success("批准成功，狀态已更新"),await this.fetchData()}catch(a){console.error("Failed to approve:",a)}}).catch(()=>{})},handleReject(e){b.s.prompt("请输入拒绝理由 (将退款给用户)","拒绝提款",{confirmButtonText:"确认拒绝",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"拒绝理由不能为空"}).then(async({value:a})=>{try{await this.$api.rejectWithdrawal(e.id,{reason:a}),p.nk.success("拒绝成功，款项已退回用户余额"),await this.fetchData()}catch(t){console.error("Failed to reject:",t)}}).catch(()=>{})},handleComplete(e){b.s.prompt("请输入出款 TX Hash（交易哈希）","标记为完成",{confirmButtonText:"下一步",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"TX Hash 不能为空",inputPlaceholder:"请输入完整的交易哈希"}).then(async({value:a})=>{b.s.prompt("请输入 Gas 成本 (USDT)","Gas 成本",{confirmButtonText:"确认完成",cancelButtonText:"取消",inputPattern:/^[0-9]+\.?[0-9]*$/,inputErrorMessage:"Gas Fee 必须为有效的数字",inputPlaceholder:"例如：0.001",inputValue:"0"}).then(async({value:t})=>{try{await this.$api.completeWithdrawal(e.id,{tx_hash:a.trim(),gas_fee:parseFloat(t)||0}),p.nk.success("提款已标记为完成"),await this.fetchData()}catch(l){console.error("Failed to complete withdrawal:",l),p.nk.error(l.response?.data?.error||"标记完成失败")}}).catch(()=>{})}).catch(()=>{})},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}},formatStatus(e){const a={pending:"待審核",rejected:"審核拒绝",processing:"出款中",completed:"出款完成"};return a[e]||e},getStatusTagType(e){const a={pending:"warning",rejected:"danger",processing:"primary",completed:"success"};return a[e]||"info"},formatCurrency(e,a=!1){if(null===e||void 0===e)return a?"0.00":"-";const t=parseFloat(e);return isNaN(t)?"N/A":0!==t||a?t.toFixed(2):"-"},getTxLink(e,a){return"TRC20"===e?`https://nile.tronscan.org/#/transaction/${a}`:"BSC"===e?`https://testnet.bscscan.com/tx/${a}`:"ETH"===e?`https://sepolia.etherscan.io/tx/${a}`:"POLYGON"===e?`https://mumbai.polygonscan.com/tx/${a}`:"SOL"===e?`https://solscan.io/tx/${a}?cluster=testnet`:"#"}}},sl=(0,o.A)(rl,[["render",ll],["__scopeId","data-v-1a41b0ee"]]),ol=sl,nl={class:"deposit-history-container"},dl=["href"],ul={key:1};function cl(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),c=(0,r.g2)("el-select"),m=(0,r.g2)("el-date-picker"),p=(0,r.g2)("el-button"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-card"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-tag"),_=(0,r.g2)("el-table"),k=(0,r.g2)("el-pagination"),v=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",nl,[a[8]||(a[8]=(0,r.Lk)("h2",null,"充值记录",-1)),(0,r.bF)(g,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户名"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.username=e),placeholder:"用户名 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.user_id,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.user_id=e),placeholder:"精确用户ID",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"TX Hash"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.tx_hash,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.tx_hash=e),placeholder:"Hash (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"充值狀态"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.searchParams.status,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.status=e),placeholder:"选择状态",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"已完成",value:"completed"}),(0,r.bF)(u,{label:"待处理",value:"pending"}),(0,r.bF)(u,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"时间区间"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[4]||(a[4]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","unlink-panels":"",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"id",label:"ID",width:"80"}),(0,r.bF)(b,{prop:"username",label:"用户名",width:"130"}),(0,r.bF)(b,{prop:"user_id",label:"用户ID",width:"130"}),(0,r.bF)(b,{prop:"chain",label:"区块链",width:"100"}),(0,r.bF)(b,{prop:"amount",label:"充值金额",width:"120",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.amount)),1)]),_:1}),(0,r.bF)(b,{prop:"created_at",label:"到帐时间",width:"170"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1}),(0,r.bF)(b,{prop:"tx_hash",label:"充值 Hash"},{default:(0,r.k6)(e=>[e.row.tx_hash?((0,r.uX)(),(0,r.CE)("a",{key:0,href:o.getTxLink(e.row.chain,e.row.tx_hash),target:"_blank",class:"tx-link"},(0,we.v_)(e.row.tx_hash),9,dl)):((0,r.uX)(),(0,r.CE)("span",ul,"-"))]),_:1}),(0,r.bF)(b,{prop:"status",label:"狀态",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{type:o.getStatusTagType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(o.formatStatus(e.row.status)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),(0,r.bF)(k,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[5]||(a[5]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[6]||(a[6]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[v,s.loading]])])}const ml=()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]},pl={name:"DepositHistory",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:10},searchParams:{username:"",user_id:"",status:"",tx_hash:"",dateRange:ml()}}},created(){this.handleSearch()},methods:{async fetchData(){if(!this.loading){this.loading=!0;try{const e={...this.pagination,username:this.searchParams.username||void 0,status:this.searchParams.status||void 0,tx_hash:this.searchParams.tx_hash||void 0,user_id:this.searchParams.user_id||void 0};if(this.searchParams.dateRange&&2===this.searchParams.dateRange.length){const[a,t]=this.searchParams.dateRange;a instanceof Date&&!isNaN(a)&&(e.start_time=a.toISOString()),t instanceof Date&&!isNaN(t)&&(e.end_time=t.toISOString())}const a=await this.$api.getDeposits(e);this.tableData=a.list,this.totalItems=a.total}catch(e){console.error("Failed to fetch deposits:",e)}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchData()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchData()},handlePageChange(e){this.pagination.page=e,this.fetchData()},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}},formatStatus(e){const a={pending:"待处理",completed:"已完成",failed:"失败"};return a[e]||e},getStatusTagType(e){const a={pending:"warning",completed:"success",failed:"danger"};return a[e]||"info"},formatCurrency(e){if(null===e||void 0===e)return"0.00";const a=parseFloat(e);return isNaN(a)?"N/A":a.toFixed(2)},getTxLink(e,a){return"TRC20"===e?`https://nile.tronscan.org/#/transaction/${a}`:"BSC"===e?`https://testnet.bscscan.com/tx/${a}`:"ETH"===e?`https://sepolia.etherscan.io/tx/${a}`:"POLYGON"===e?`https://mumbai.polygonscan.com/tx/${a}`:"SOL"===e?`https://solscan.io/tx/${a}?cluster=testnet`:"#"}}},hl=(0,o.A)(pl,[["render",cl],["__scopeId","data-v-9e1a905c"]]),gl=hl,bl={class:"game-parameters-container"},fl={class:"form-tip"},_l={class:"form-tip"},kl={class:"form-tip"},vl={class:"form-tip"},Fl={class:"form-tip"};function wl(e,a,t,l,i,s){const o=(0,r.g2)("el-input"),n=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-button"),u=(0,r.g2)("el-form"),c=(0,r.g2)("el-empty"),m=(0,r.g2)("el-tab-pane"),p=(0,r.g2)("el-switch"),h=(0,r.g2)("el-input-number"),g=(0,r.g2)("el-tabs"),b=(0,r.g2)("el-card"),f=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",bl,[a[14]||(a[14]=(0,r.Lk)("h2",null,"系统参数",-1)),a[15]||(a[15]=(0,r.Lk)("p",{class:"page-description"},"管理遊戏参数、金流参数、风控参数等系统设定。",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{shadow:"never"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:i.activeTab,"onUpdate:modelValue":a[8]||(a[8]=e=>i.activeTab=e)},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"遊戏参数",name:"Game"},{default:(0,r.k6)(()=>[i.formGroups.Game?((0,r.uX)(),(0,r.Wv)(u,{key:0,ref:"gameFormRef",model:i.formGroups.Game,"label-width":"200px",class:"settings-form"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"派奖倍数",prop:"PAYOUT_MULTIPLIER.value",rules:[{required:!0,message:"派奖倍数不能为空"},{validator:s.validateInteger,trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(o,{modelValue:i.formGroups.Game.PAYOUT_MULTIPLIER.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.formGroups.Game.PAYOUT_MULTIPLIER.value=e),style:{width:"200px"},placeholder:"请输入正整数"},{append:(0,r.k6)(()=>[...a[9]||(a[9]=[(0,r.eW)("倍",-1)])]),_:1},8,["modelValue"]),(0,r.Lk)("div",fl,(0,we.v_)(i.formGroups.Game.PAYOUT_MULTIPLIER.description),1)]),_:1},8,["rules"]),(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{type:"primary",onClick:a[1]||(a[1]=e=>s.handleSubmit("Game")),loading:i.submitLoading},{default:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.eW)("储存遊戏参数",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):((0,r.uX)(),(0,r.Wv)(c,{key:1,description:"無遊戏参数"}))]),_:1}),(0,r.bF)(m,{label:"金流参数",name:"Finance"},{default:(0,r.k6)(()=>[i.formGroups.Finance?((0,r.uX)(),(0,r.Wv)(u,{key:0,ref:"financeFormRef",model:i.formGroups.Finance,"label-width":"200px",class:"settings-form"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"自动出款门槛",prop:"AUTO_WITHDRAW_THRESHOLD.value",rules:[{required:!0,message:"门槛不能为空"},{validator:s.validateNumeric,trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(o,{modelValue:i.formGroups.Finance.AUTO_WITHDRAW_THRESHOLD.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i.formGroups.Finance.AUTO_WITHDRAW_THRESHOLD.value=e),style:{width:"200px"},placeholder:"例如: 10"},{append:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)("USDT",-1)])]),_:1},8,["modelValue"]),(0,r.Lk)("div",_l,(0,we.v_)(i.formGroups.Finance.AUTO_WITHDRAW_THRESHOLD.description),1)]),_:1},8,["rules"]),(0,r.bF)(n,{label:"开放 TRC20 充值",prop:"ALLOW_TRC20.value",rules:[{required:!0,message:"必须选择"}]},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:i.formGroups.Finance.ALLOW_TRC20.value,"onUpdate:modelValue":a[3]||(a[3]=e=>i.formGroups.Finance.ALLOW_TRC20.value=e),"active-value":"true","inactive-value":"false"},null,8,["modelValue"]),(0,r.Lk)("div",kl,(0,we.v_)(i.formGroups.Finance.ALLOW_TRC20.description),1)]),_:1}),(0,r.bF)(n,{label:"开放 BSC 充值",prop:"ALLOW_BSC.value",rules:[{required:!0,message:"必须选择"}]},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:i.formGroups.Finance.ALLOW_BSC.value,"onUpdate:modelValue":a[4]||(a[4]=e=>i.formGroups.Finance.ALLOW_BSC.value=e),"active-value":"true","inactive-value":"false"},null,8,["modelValue"]),(0,r.Lk)("div",vl,(0,we.v_)(i.formGroups.Finance.ALLOW_BSC.description),1)]),_:1}),(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{type:"primary",onClick:a[5]||(a[5]=e=>s.handleSubmit("Finance")),loading:i.submitLoading},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("储存金流参数",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):((0,r.uX)(),(0,r.Wv)(c,{key:1,description:"無金流参数"}))]),_:1}),(0,r.bF)(m,{label:"风控参数",name:"RiskControl"},{default:(0,r.k6)(()=>[i.formGroups.RiskControl?((0,r.uX)(),(0,r.Wv)(u,{key:0,ref:"riskControlFormRef",model:i.formGroups.RiskControl,"label-width":"200px",class:"settings-form"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"同IP最大用户数",prop:"MAX_SAME_IP_USERS.value",rules:[{required:!0,message:"同IP最大用户数不能为空"},{validator:s.validateInteger,trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(h,{modelValue:i.formGroups.RiskControl.MAX_SAME_IP_USERS.value,"onUpdate:modelValue":a[6]||(a[6]=e=>i.formGroups.RiskControl.MAX_SAME_IP_USERS.value=e),min:1,max:100,step:1,"step-strictly":"",style:{width:"200px"},placeholder:"请输入正整数"},null,8,["modelValue"]),(0,r.Lk)("div",Fl,(0,we.v_)(i.formGroups.RiskControl.MAX_SAME_IP_USERS.description),1)]),_:1},8,["rules"]),(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{type:"primary",onClick:a[7]||(a[7]=e=>s.handleSubmit("RiskControl")),loading:i.submitLoading},{default:(0,r.k6)(()=>[...a[13]||(a[13]=[(0,r.eW)("储存风控参数",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):((0,r.uX)(),(0,r.Wv)(c,{key:1,description:"無风控参数"}))]),_:1}),(0,r.bF)(m,{label:"其他参数",name:"General"},{default:(0,r.k6)(()=>[i.formGroups.General?((0,r.uX)(),(0,r.Wv)(u,{key:0,ref:"generalFormRef",model:i.formGroups.General,"label-width":"200px",class:"settings-form"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{description:"無其他参数"})]),_:1},8,["model"])):((0,r.uX)(),(0,r.Wv)(c,{key:1,description:"無其他参数"}))]),_:1})]),_:1},8,["modelValue"])]),_:1})),[[f,i.loading]])])}const yl={name:"GameParametersView",data(){return{loading:!0,submitLoading:!1,activeTab:"Game",formGroups:{Game:null,Finance:null,RiskControl:null,General:null},originalSettings:{}}},created(){this.fetchSettings()},methods:{validateNumeric(e,a,t){const l=parseFloat(a);isNaN(l)||l<0?t(new Error("必须是非负数")):t()},validateInteger(e,a,t){const l=parseFloat(a);isNaN(l)||l<=0||!Number.isInteger(l)?t(new Error("必须是正整数")):t()},async fetchSettings(){this.loading=!0;try{const e=await this.$api.getSettings();this.originalSettings=JSON.parse(JSON.stringify(e)),this.formGroups=e,this.formGroups[this.activeTab]||(this.formGroups.Finance?this.activeTab="Finance":this.formGroups.RiskControl?this.activeTab="RiskControl":this.formGroups.General&&(this.activeTab="General"))}catch(e){console.error("Failed to fetch settings:",e),p.nk.error("载入设定失败")}finally{this.loading=!1}},async handleSubmit(e){const a=`${e.toLowerCase()}FormRef`,t=this.$refs[a];t&&await t.validate(async a=>{if(!a)return p.nk.error("表单验证失败"),!1;{this.submitLoading=!0;const a=this.formGroups[e],l=this.originalSettings[e]||{};try{const e=[];for(const t in a)a[t].value!==l[t]?.value&&e.push(this.$api.updateSetting(t,a[t].value));if(0===e.length)return p.nk.info("设定未变动"),void(this.submitLoading=!1);await Promise.all(e),p.nk.success("设定储存成功！"),await this.fetchSettings()}catch(t){console.error("Failed to save settings:",t),p.nk.error("储存设定失败")}finally{this.submitLoading=!1}}})}}},Cl=(0,o.A)(yl,[["render",wl],["__scopeId","data-v-56c2a02f"]]),Dl=Cl,Ll={class:"same-ip-monitor"},Vl={class:"dialog-ip"};function Pl(e,a,t,l,i,s){const o=(0,r.g2)("el-button"),n=(0,r.g2)("el-card"),d=(0,r.g2)("el-table-column"),u=(0,r.g2)("el-table"),c=(0,r.g2)("el-tag"),m=(0,r.g2)("el-dialog"),p=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Ll,[a[8]||(a[8]=(0,r.Lk)("h2",null,"同 IP 风控监控",-1)),(0,r.bF)(n,{shadow:"never",class:"info-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("p",null,[a[2]||(a[2]=(0,r.eW)(" 当前风控阈值： ",-1)),(0,r.Lk)("strong",null,(0,we.v_)(i.threshold),1),a[3]||(a[3]=(0,r.Lk)("span",{class:"note"},"（超过该数量的同 IP 账号会触发自动封锁）",-1))]),(0,r.bF)(o,{type:"primary",link:"",onClick:a[0]||(a[0]=a=>e.$router.push("/settings/game-parameters"))},{default:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.eW)(" 前往系统参数设定 ",-1)])]),_:1})]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(n,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{data:i.ipList,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"ip_address",label:"IP 地址",width:"180"}),(0,r.bF)(d,{prop:"total_count",label:"总用户数",width:"120"}),(0,r.bF)(d,{prop:"active_count",label:"启用中",width:"120"}),(0,r.bF)(d,{prop:"banned_count",label:"已封锁",width:"120"}),(0,r.bF)(d,{prop:"last_activity_at",label:"最后活动时间",width:"200"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatDateTime(e.row.last_activity_at)),1)]),_:1}),(0,r.bF)(d,{label:"操作",width:"240",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(o,{size:"small",onClick:a=>s.handleViewDetail(e.row)},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("查看详情",-1)])]),_:1},8,["onClick"]),(0,r.bF)(o,{size:"small",type:"danger",onClick:a=>s.handleBan(e.row),disabled:e.row.banned_count===e.row.total_count},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("一键封锁",-1)])]),_:1},8,["onClick","disabled"]),(0,r.bF)(o,{size:"small",type:"success",onClick:a=>s.handleUnban(e.row),disabled:e.row.active_count===e.row.total_count},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)("一键解禁",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})),[[p,i.loading]]),(0,r.bF)(m,{modelValue:i.detailDialog.visible,"onUpdate:modelValue":a[1]||(a[1]=e=>i.detailDialog.visible=e),title:"IP 用户详情",width:"800px","close-on-click-modal":!1},{default:(0,r.k6)(()=>[(0,r.Lk)("p",Vl,"IP："+(0,we.v_)(i.detailDialog.ip),1),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{data:i.detailDialog.users,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"user_id",label:"用户ID",width:"120"}),(0,r.bF)(d,{prop:"username",label:"帐号",width:"150"}),(0,r.bF)(d,{prop:"nickname",label:"昵称",width:"150"}),(0,r.bF)(d,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(c,{type:"active"===e.row.status?"success":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)("active"===e.row.status?"启用":"封锁"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(d,{prop:"last_activity_at",label:"最后活动时间",width:"200"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatDateTime(e.row.last_activity_at)),1)]),_:1})]),_:1},8,["data"])),[[p,i.detailDialog.loading]])]),_:1},8,["modelValue"])])}const Il={name:"SameIpMonitor",data(){return{loading:!1,ipList:[],threshold:"-",detailDialog:{visible:!1,ip:"",loading:!1,users:[]}}},created(){this.fetchSummary()},methods:{async fetchSummary(){this.loading=!0;try{const e=await ee();this.threshold=e.threshold??"-",this.ipList=e.list||[]}catch(e){console.error("Failed to fetch same IP summary:",e),p.nk.error("载入同 IP 风控资料失败")}finally{this.loading=!1}},formatDateTime(e){if(!e)return"-";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}},async handleViewDetail(e){this.detailDialog.visible=!0,this.detailDialog.ip=e.ip_address,this.detailDialog.loading=!0,this.detailDialog.users=[];try{const a=await ae(e.ip_address);this.detailDialog.users=a.list||[]}catch(a){console.error("Failed to fetch users by IP:",a),p.nk.error("载入用户详情失败")}finally{this.detailDialog.loading=!1}},async handleBan(e){try{await b.s.confirm(`确定要封锁 IP ${e.ip_address} 下的所有用户吗？`,"封锁确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await te(e.ip_address),p.nk.success("封锁成功"),this.fetchSummary(),this.detailDialog.visible&&this.detailDialog.ip===e.ip_address&&this.handleViewDetail(e)}catch(a){"cancel"!==a&&(console.error("Failed to ban users by IP:",a),p.nk.error(a.response?.data?.error||"封锁失败"))}},async handleUnban(e){try{await b.s.confirm(`确定要解禁 IP ${e.ip_address} 下的所有用户吗？`,"解禁确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await le(e.ip_address),p.nk.success("解禁成功"),this.fetchSummary(),this.detailDialog.visible&&this.detailDialog.ip===e.ip_address&&this.handleViewDetail(e)}catch(a){"cancel"!==a&&(console.error("Failed to unban users by IP:",a),p.nk.error(a.response?.data?.error||"解禁失败"))}}}},Wl=(0,o.A)(Il,[["render",Pl],["__scopeId","data-v-531d22b0"]]),Sl=Wl,Tl={class:"blocked-regions-container"};function xl(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-button"),c=(0,r.g2)("el-form"),m=(0,r.g2)("el-card"),p=(0,r.g2)("el-table-column"),h=(0,r.g2)("el-table"),g=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Tl,[a[6]||(a[6]=(0,r.Lk)("h2",null,"阻挡地区设定",-1)),a[7]||(a[7]=(0,r.Lk)("p",{class:"page-description"},"在此处新增或刪除要阻挡的 IP 地址或 CIDR 范围。",-1)),(0,r.bF)(m,{shadow:"never",class:"add-card"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{ref:"addFormRef",model:s.addForm,rules:s.addFormRules,inline:!0,onSubmit:(0,i.D$)(o.handleAddRegion,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"IP / CIDR",prop:"ip_range"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.addForm.ip_range,"onUpdate:modelValue":a[0]||(a[0]=e=>s.addForm.ip_range=e),placeholder:"例如: 1.2.3.4/32 或 1.2.3.0/24"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"描述 (选填)"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.addForm.description,"onUpdate:modelValue":a[1]||(a[1]=e=>s.addForm.description=e),placeholder:"例如: 地区名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"primary",onClick:o.handleAddRegion,loading:s.addLoading},{default:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.eW)("新增",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules","onSubmit"]),a[3]||(a[3]=(0,r.Lk)("div",{class:"form-tip"}," 请使用 CIDR 格式。单一 IP 请使用 /32 结尾 (例如 1.2.3.4/32)。 ",-1))]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{shadow:"never",class:"table-card"},{header:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.Lk)("div",null,"已阻挡列表",-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(h,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(p,{prop:"ip_range",label:"IP / CIDR 范围"}),(0,r.bF)(p,{prop:"description",label:"描述"}),(0,r.bF)(p,{prop:"created_at",label:"新增时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1}),(0,r.bF)(p,{label:"操作",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(u,{type:"danger",link:"",onClick:a=>o.handleDelete(e.row)},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[g,s.loading]])])}const Rl={name:"BlockedRegionsView",data(){return{loading:!0,addLoading:!1,tableData:[],addForm:{ip_range:"",description:""},addFormRules:{ip_range:[{required:!0,message:"请输入 IP / CIDR",trigger:"blur"},{pattern:/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$/,message:"格式错误，请使用 CIDR (e.g., 1.2.3.4/32 or 1.2.3.0/24)",trigger:"blur"}]}}},created(){this.fetchRegions()},methods:{async fetchRegions(){this.loading=!0;try{this.tableData=await this.$api.getBlockedRegions()}catch(e){console.error("Failed to fetch blocked regions:",e)}finally{this.loading=!1}},async handleAddRegion(){const e=this.$refs.addFormRef;e&&await e.validate(async a=>{if(!a)return!1;this.addLoading=!0;try{await this.$api.addBlockedRegion(this.addForm),p.nk.success("阻挡地区新增成功"),e.resetFields(),await this.fetchRegions()}catch(t){console.error("Failed to add region:",t)}finally{this.addLoading=!1}})},handleDelete(e){b.s.confirm(`确定要刪除阻挡规則 "${e.ip_range}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.deleteBlockedRegion(e.id),p.nk.success("阻挡规則刪除成功"),await this.fetchRegions()}catch(a){console.error("Failed to delete region:",a)}}).catch(()=>{})},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}}}},Ul=(0,o.A)(Rl,[["render",xl],["__scopeId","data-v-d11bdab6"]]),$l=Ul,Al={class:"user-levels-container"},Xl={key:0,class:"form-tip"};function El(e,a,t,l,i,s){const o=(0,r.g2)("el-button"),n=(0,r.g2)("el-card"),d=(0,r.g2)("el-table-column"),u=(0,r.g2)("el-table"),c=(0,r.g2)("el-input-number"),m=(0,r.g2)("el-form-item"),p=(0,r.g2)("el-input"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-dialog"),b=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Al,[a[18]||(a[18]=(0,r.Lk)("h2",null,"用户等级设定",-1)),a[19]||(a[19]=(0,r.Lk)("p",{class:"page-description"},"管理用户等级及其升级条件和奖励。",-1)),(0,r.bF)(n,{shadow:"never",class:"action-card"},{default:(0,r.k6)(()=>[(0,r.bF)(o,{type:"primary",onClick:s.handleAdd},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)("新增等级",-1)])]),_:1},8,["onClick"]),a[9]||(a[9]=(0,r.Lk)("span",{class:"action-tip"},"(等级必须从 1 开始連续设定)",-1))]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(n,{shadow:"never",class:"table-card"},{header:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.Lk)("div",null,"等级列表",-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(u,{data:i.tableData,style:{width:"100%"},"row-key":"level"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"level",label:"等级",width:"80",sortable:""}),(0,r.bF)(d,{prop:"name",label:"等级名称",width:"150"}),(0,r.bF)(d,{prop:"max_bet_amount",label:"投注限额 (ETH)",width:"150",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatCurrency(e.row.max_bet_amount)),1)]),_:1}),(0,r.bF)(d,{prop:"required_bets_for_upgrade",label:"升级所需注单数",width:"160",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.required_bets_for_upgrade>0?e.row.required_bets_for_upgrade:"最高级"),1)]),_:1}),(0,r.bF)(d,{prop:"min_bet_amount_for_upgrade",label:"升级注单最小金额 (ETH)",width:"200",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatCurrency(e.row.min_bet_amount_for_upgrade)),1)]),_:1}),(0,r.bF)(d,{prop:"upgrade_reward_amount",label:"升级奖励金额 (ETH)",width:"180",sortable:""},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatCurrency(e.row.upgrade_reward_amount)),1)]),_:1}),(0,r.bF)(d,{label:"操作",width:"150",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(o,{type:"primary",link:"",onClick:a=>s.handleEdit(e.row)},{default:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,r.bF)(o,{type:"danger",link:"",onClick:a=>s.handleDelete(e.row),disabled:1===e.row.level},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})),[[b,i.loading]]),(0,r.bF)(g,{modelValue:i.dialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>i.dialogVisible=e),title:i.dialogTitle,width:"700px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.bF)(o,{onClick:a[6]||(a[6]=e=>i.dialogVisible=!1)},{default:(0,r.k6)(()=>[...a[16]||(a[16]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(o,{type:"primary",onClick:s.handleSubmit,loading:i.submitLoading},{default:(0,r.k6)(()=>[...a[17]||(a[17]=[(0,r.eW)("确认",-1)])]),_:1},8,["onClick","loading"])]),default:(0,r.k6)(()=>[(0,r.bF)(h,{ref:"levelFormRef",model:i.levelForm,rules:i.formRules,"label-width":"180px"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"等级",prop:"level"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.levelForm.level,"onUpdate:modelValue":a[0]||(a[0]=e=>i.levelForm.level=e),min:1,step:1,"step-strictly":"",disabled:i.isEditMode},null,8,["modelValue","disabled"]),!i.isEditMode&&s.nextLevel>1?((0,r.uX)(),(0,r.CE)("div",Xl,"建议下一個等级为 "+(0,we.v_)(s.nextLevel),1)):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(m,{label:"等级名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:i.levelForm.name,"onUpdate:modelValue":a[1]||(a[1]=e=>i.levelForm.name=e),placeholder:"例如: VIP 1, 新手"},null,8,["modelValue"])]),_:1}),(0,r.bF)(m,{label:"投注限额 (ETH)",prop:"max_bet_amount"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.levelForm.max_bet_amount,"onUpdate:modelValue":a[2]||(a[2]=e=>i.levelForm.max_bet_amount=e),min:0,precision:8,placeholder:"此等级最高投注额"},null,8,["modelValue"])]),_:1}),(0,r.bF)(m,{label:"升级所需注单数",prop:"required_bets_for_upgrade"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.levelForm.required_bets_for_upgrade,"onUpdate:modelValue":a[3]||(a[3]=e=>i.levelForm.required_bets_for_upgrade=e),min:0,"step-strictly":"",placeholder:"升到下一级所需注单数"},null,8,["modelValue"]),a[13]||(a[13]=(0,r.Lk)("div",{class:"form-tip"},"设为 0 表示此等级为最高等级，無法再升级。",-1))]),_:1}),(0,r.bF)(m,{label:"升级注单最小金额 (ETH)",prop:"min_bet_amount_for_upgrade"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.levelForm.min_bet_amount_for_upgrade,"onUpdate:modelValue":a[4]||(a[4]=e=>i.levelForm.min_bet_amount_for_upgrade=e),min:0,precision:8,placeholder:"多少金额以上计入升级"},null,8,["modelValue"]),a[14]||(a[14]=(0,r.Lk)("div",{class:"form-tip"},"只有投注额大于等于此金额的注单，才会计入「升级所需注单数」。",-1))]),_:1}),(0,r.bF)(m,{label:"升级奖励金额 (ETH)",prop:"upgrade_reward_amount"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.levelForm.upgrade_reward_amount,"onUpdate:modelValue":a[5]||(a[5]=e=>i.levelForm.upgrade_reward_amount=e),min:0,precision:8,placeholder:"升到下一级的奖励"},null,8,["modelValue"]),a[15]||(a[15]=(0,r.Lk)("div",{class:"form-tip"},"用户从上一级升到此等级时获得的奖励。",-1))]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const zl={name:"UserLevelsView",data(){const e=(e,a,t)=>{null===a||void 0===a||""===a?t(new Error("此栏位不能为空")):"number"!==typeof a||a<0?t(new Error("必须是非负数")):t()},a=(e,a,t)=>{null===a||void 0===a||""===a?t(new Error("此栏位不能为空")):"number"!==typeof a||a<0||!Number.isInteger(a)?t(new Error("必须是非负整数")):t()};return{loading:!0,submitLoading:!1,tableData:[],dialogVisible:!1,dialogTitle:"",isEditMode:!1,levelForm:{level:null,name:"",max_bet_amount:null,required_bets_for_upgrade:null,min_bet_amount_for_upgrade:null,upgrade_reward_amount:null},formRules:{level:[{required:!0,message:"等级不能为空",trigger:"blur"},{type:"integer",min:1,message:"等级必须是正整数",trigger:"blur"}],name:[{required:!0,message:"等级名称不能为空",trigger:"blur"}],max_bet_amount:[{required:!0,validator:e,trigger:"blur"}],required_bets_for_upgrade:[{required:!0,validator:a,trigger:"blur"}],min_bet_amount_for_upgrade:[{required:!0,validator:e,trigger:"blur"}],upgrade_reward_amount:[{required:!0,validator:e,trigger:"blur"}]}}},computed:{nextLevel(){if(!this.tableData||0===this.tableData.length)return 1;const e=Math.max(...this.tableData.map(e=>e.level));return e+1}},created(){this.fetchLevels()},methods:{async fetchLevels(){this.loading=!0;try{this.tableData=await this.$api.getUserLevels()}catch(e){console.error("Failed to fetch user levels:",e)}finally{this.loading=!1}},handleAdd(){this.dialogTitle="新增用户等级",this.isEditMode=!1,Object.assign(this.levelForm,{level:this.nextLevel,name:`Level ${this.nextLevel}`,max_bet_amount:null,required_bets_for_upgrade:null,min_bet_amount_for_upgrade:null,upgrade_reward_amount:null}),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.levelFormRef?.clearValidate()})},handleEdit(e){this.dialogTitle=`编辑等级 ${e.level}`,this.isEditMode=!0,Object.assign(this.levelForm,{level:e.level,name:e.name,max_bet_amount:parseFloat(e.max_bet_amount)||0,required_bets_for_upgrade:parseInt(e.required_bets_for_upgrade)||0,min_bet_amount_for_upgrade:parseFloat(e.min_bet_amount_for_upgrade)||0,upgrade_reward_amount:parseFloat(e.upgrade_reward_amount)||0}),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.levelFormRef?.clearValidate()})},async handleSubmit(){const e=this.$refs.levelFormRef;e&&await e.validate(async e=>{if(!e)return!1;this.submitLoading=!0;try{const e={...this.levelForm};this.isEditMode?(await this.$api.updateUserLevel(this.levelForm.level,e),p.nk.success("等级更新成功")):(await this.$api.addUserLevel(e),p.nk.success("等级新增成功")),this.dialogVisible=!1,await this.fetchLevels()}catch(a){console.error("Failed to submit user level:",a)}finally{this.submitLoading=!1}})},handleDelete(e){b.s.confirm(`确定要刪除等级 ${e.level} (${e.name}) 吗？`,"警告",{confirmButtonText:"确定刪除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.deleteUserLevel(e.level),p.nk.success("等级刪除成功"),await this.fetchLevels()}catch(a){console.error("Failed to delete user level:",a)}}).catch(()=>{})},formatCurrency(e){if(null===e||void 0===e)return"";if("string"===typeof e)try{e=parseFloat(e)}catch(a){return"N/A"}return"number"!==typeof e?"N/A":e.toFixed(8)}}},Ml=(0,o.A)(zl,[["render",El],["__scopeId","data-v-0ef0f171"]]),Nl=Ml,Bl={class:"account-management-container"};function Ol(e,a,t,l,i,s){const o=(0,r.g2)("el-button"),n=(0,r.g2)("el-card"),d=(0,r.g2)("el-table-column"),u=(0,r.g2)("el-tag"),c=(0,r.g2)("el-table"),m=(0,r.g2)("el-input"),p=(0,r.g2)("el-form-item"),h=(0,r.g2)("el-option"),g=(0,r.g2)("el-select"),b=(0,r.g2)("el-radio"),f=(0,r.g2)("el-radio-group"),_=(0,r.g2)("el-form"),k=(0,r.g2)("el-dialog"),v=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Bl,[a[15]||(a[15]=(0,r.Lk)("h2",null,"帐号管理",-1)),a[16]||(a[16]=(0,r.Lk)("p",{class:"page-description"},"管理可以登入後台的管理员帐号。",-1)),(0,r.bF)(n,{shadow:"never",class:"action-card"},{default:(0,r.k6)(()=>[(0,r.bF)(o,{type:"primary",onClick:s.handleAdd},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.eW)("新增帐号",-1)])]),_:1},8,["onClick"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(n,{shadow:"never",class:"table-card"},{header:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.Lk)("div",null,"帐号列表",-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(c,{data:i.tableData,style:{width:"100%"},"row-key":"id"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"id",label:"ID",width:"80",sortable:""}),(0,r.bF)(d,{prop:"username",label:"登入帐号",width:"200"}),(0,r.bF)(d,{prop:"role_name",label:"角色 (权限组)",width:"150"},{default:(0,r.k6)(e=>[e.row.role_id?((0,r.uX)(),(0,r.Wv)(u,{key:0},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(e.row.role_name||`ID: ${e.row.role_id}`),1)]),_:2},1024)):((0,r.uX)(),(0,r.Wv)(u,{key:1,type:"info"},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)("未分配",-1)])]),_:1}))]),_:1}),(0,r.bF)(d,{prop:"status",label:"狀态",width:"120"},{default:(0,r.k6)(e=>[(0,r.bF)(u,{type:"active"===e.row.status?"success":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)("active"===e.row.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(d,{prop:"created_at",label:"建立时间"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatDateTime(e.row.created_at)),1)]),_:1}),(0,r.bF)(d,{label:"操作",width:"150",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(o,{type:"primary",link:"",onClick:a=>s.handleEdit(e.row)},{default:(0,r.k6)(()=>[...a[9]||(a[9]=[(0,r.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,r.bF)(o,{type:"danger",link:"",onClick:a=>s.handleDelete(e.row),disabled:1===e.row.id||e.row.id===i.currentUserId},{default:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.eW)("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})),[[v,i.loading]]),(0,r.bF)(k,{modelValue:i.dialogVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>i.dialogVisible=e),title:i.dialogTitle,width:"600px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.bF)(o,{onClick:a[4]||(a[4]=e=>i.dialogVisible=!1)},{default:(0,r.k6)(()=>[...a[13]||(a[13]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(o,{type:"primary",onClick:s.handleSubmit,loading:i.submitLoading},{default:(0,r.k6)(()=>[...a[14]||(a[14]=[(0,r.eW)("确认",-1)])]),_:1},8,["onClick","loading"])]),default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(_,{ref:"accountFormRef",model:i.accountForm,rules:i.formRules,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{label:"登入帐号",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:i.accountForm.username,"onUpdate:modelValue":a[0]||(a[0]=e=>i.accountForm.username=e),placeholder:"请输入登入帐号"},null,8,["modelValue"])]),_:1}),(0,r.bF)(p,{label:"登入密码",prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:i.accountForm.password,"onUpdate:modelValue":a[1]||(a[1]=e=>i.accountForm.password=e),type:"password","show-password":"",placeholder:"留空表示不修改密码"},null,8,["modelValue"])]),_:1}),(0,r.bF)(p,{label:"角色",prop:"role_id"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:i.accountForm.role_id,"onUpdate:modelValue":a[2]||(a[2]=e=>i.accountForm.role_id=e),placeholder:"请选择权限组",style:{width:"100%"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.rolesList,e=>((0,r.uX)(),(0,r.Wv)(h,{key:e.id,label:`${e.name} (ID: ${e.id})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(p,{label:"狀态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(f,{modelValue:i.accountForm.status,"onUpdate:modelValue":a[3]||(a[3]=e=>i.accountForm.status=e)},{default:(0,r.k6)(()=>[(0,r.bF)(b,{label:"active"},{default:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)("启用",-1)])]),_:1}),(0,r.bF)(b,{label:"disabled"},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[v,i.dialogLoading]])]),_:1},8,["modelValue","title"])])}const ql={name:"AccountManagementView",data(){const e=(e,a,t)=>{this.isEditMode||a&&!(a.length<6)?this.isEditMode&&a&&a.length<6?t(new Error("密码至少 6 位")):t():t(new Error("新增帐号时，密码为必填且至少 6 位"))};return{loading:!0,submitLoading:!1,dialogLoading:!1,tableData:[],rolesList:[],dialogVisible:!1,dialogTitle:"",isEditMode:!1,currentUserId:null,accountForm:{id:null,username:"",password:"",role_id:null,status:"active"},formRules:{username:[{required:!0,message:"登入帐号不能为空",trigger:"blur"}],password:[{validator:e,trigger:"blur"}],role_id:[{required:!0,message:"必须选择一個角色",trigger:"change"}],status:[{required:!0,message:"狀态必须选择",trigger:"change"}]}}},created(){this.fetchAccounts(),this.fetchRolesList(),this.getCurrentUserId()},methods:{getCurrentUserId(){try{const e=localStorage.getItem("admin_token"),a=(0,m.s)(e);this.currentUserId=a.id}catch(e){console.error("Failed to decode token:",e),this.$router.push("/login")}},async fetchAccounts(){this.loading=!0;try{this.tableData=await this.$api.getAdminAccounts()}catch(e){console.error("Failed to fetch admin accounts:",e)}finally{this.loading=!1}},async fetchRolesList(){try{this.rolesList=await this.$api.getRoles()}catch(e){console.error("Failed to fetch roles list:",e),p.nk.error("無法载入权限组列表")}},resetForm(){Object.assign(this.accountForm,{id:null,username:"",password:"",role_id:null,status:"active"})},handleAdd(){this.dialogTitle="新增後台帐号",this.isEditMode=!1,this.resetForm(),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.accountFormRef?.clearValidate()})},handleEdit(e){this.dialogTitle=`编辑帐号 ${e.username}`,this.isEditMode=!0,Object.assign(this.accountForm,{id:e.id,username:e.username,password:"",role_id:e.role_id,status:e.status}),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.accountFormRef?.clearValidate()})},async handleSubmit(){const e=this.$refs.accountFormRef;e&&await e.validate(async e=>{if(!e)return!1;this.submitLoading=!0;try{const e={username:this.accountForm.username,role_id:this.accountForm.role_id,status:this.accountForm.status};this.accountForm.password&&(e.password=this.accountForm.password),this.isEditMode?(await this.$api.updateAdminAccount(this.accountForm.id,e),p.nk.success("帐号更新成功")):(await this.$api.addAdminAccount(e),p.nk.success("帐号新增成功")),this.dialogVisible=!1,await this.fetchAccounts()}catch(a){console.error("Failed to submit account:",a)}finally{this.submitLoading=!1}})},handleDelete(e){1!==e.id&&e.id!==this.currentUserId?b.s.confirm(`确定要刪除帐号 "${e.username}" 吗？`,"警告",{confirmButtonText:"确定刪除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.deleteAdminAccount(e.id),p.nk.success("帐号刪除成功"),await this.fetchAccounts()}catch(a){console.error("Failed to delete account:",a)}}).catch(()=>{}):p.nk.warning("無法刪除此帐号")},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}}}},Gl=(0,o.A)(ql,[["render",Ol],["__scopeId","data-v-a2644dce"]]),Hl=Gl,Ql={class:"permissions-container"},jl={key:0,class:"permissions-tree"},Yl={class:"category-title"},Zl={key:1};function Kl(e,a,t,l,i,s){const o=(0,r.g2)("el-button"),n=(0,r.g2)("el-card"),d=(0,r.g2)("el-table-column"),u=(0,r.g2)("el-table"),c=(0,r.g2)("el-input"),m=(0,r.g2)("el-form-item"),p=(0,r.g2)("el-divider"),h=(0,r.g2)("el-checkbox"),g=(0,r.g2)("el-checkbox-group"),b=(0,r.g2)("el-form"),f=(0,r.g2)("el-dialog"),_=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Ql,[a[11]||(a[11]=(0,r.Lk)("h2",null,"权限组设定",-1)),a[12]||(a[12]=(0,r.Lk)("p",{class:"page-description"},"管理後台帐号的角色 (权限组) 及其权限。",-1)),(0,r.bF)(n,{shadow:"never",class:"action-card"},{default:(0,r.k6)(()=>[(0,r.bF)(o,{type:"primary",onClick:s.handleAddRole},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("新增权限组",-1)])]),_:1},8,["onClick"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(n,{shadow:"never",class:"table-card"},{header:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.Lk)("div",null,"权限组列表",-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(u,{data:i.rolesList,style:{width:"100%"},"row-key":"id"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"id",label:"ID",width:"80",sortable:""}),(0,r.bF)(d,{prop:"name",label:"角色名称",width:"200"}),(0,r.bF)(d,{prop:"description",label:"描述"}),(0,r.bF)(d,{prop:"created_at",label:"建立时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(s.formatDateTime(e.row.created_at)),1)]),_:1}),(0,r.bF)(d,{label:"操作",width:"150",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(o,{type:"primary",link:"",onClick:a=>s.handleEditRole(e.row),disabled:1===e.row.id},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),(0,r.bF)(o,{type:"danger",link:"",onClick:a=>s.handleDeleteRole(e.row),disabled:[1,2,3].includes(e.row.id)},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})),[[_,i.loading]]),(0,r.bF)(f,{modelValue:i.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=e=>i.dialogVisible=e),title:i.dialogTitle,width:"700px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.bF)(o,{onClick:a[3]||(a[3]=e=>i.dialogVisible=!1)},{default:(0,r.k6)(()=>[...a[9]||(a[9]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(o,{type:"primary",onClick:s.handleSubmit,loading:i.submitLoading},{default:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.eW)("确认储存",-1)])]),_:1},8,["onClick","loading"])]),default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{ref:"roleFormRef",model:i.roleForm,rules:i.formRules,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"角色名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.roleForm.name,"onUpdate:modelValue":a[0]||(a[0]=e=>i.roleForm.name=e),placeholder:"例如: 营運人员"},null,8,["modelValue"])]),_:1}),(0,r.bF)(m,{label:"角色描述",prop:"description"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:i.roleForm.description,"onUpdate:modelValue":a[1]||(a[1]=e=>i.roleForm.description=e),type:"textarea",placeholder:"例如: 僅可读取用户和注单列表"},null,8,["modelValue"])]),_:1}),(0,r.bF)(p),(0,r.bF)(m,{label:"权限设置",prop:"permission_ids"},{default:(0,r.k6)(()=>[i.allPermissions?((0,r.uX)(),(0,r.CE)("div",jl,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Object.keys(i.allPermissions),e=>((0,r.uX)(),(0,r.CE)("div",{key:e,class:"permission-category"},[(0,r.Lk)("h4",Yl,(0,we.v_)(s.translateCategory(e)),1),(0,r.bF)(g,{modelValue:i.roleForm.permission_ids,"onUpdate:modelValue":a[2]||(a[2]=e=>i.roleForm.permission_ids=e),class:"permission-group"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.allPermissions[e],e=>((0,r.uX)(),(0,r.Wv)(h,{key:e.id,label:e.id,value:e.id,border:"",class:"permission-checkbox"},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(e.description)+" ("+(0,we.v_)(e.resource)+":"+(0,we.v_)(e.action)+") ",1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue"])]))),128))])):((0,r.uX)(),(0,r.CE)("div",Zl,"权限加载中..."))]),_:1})]),_:1},8,["model","rules"])),[[_,i.dialogLoading]])]),_:1},8,["modelValue","title"])])}const Jl={name:"PermissionsView",data(){return{loading:!0,submitLoading:!1,dialogLoading:!1,rolesList:[],allPermissions:null,dialogVisible:!1,dialogTitle:"",isEditMode:!1,roleForm:{id:null,name:"",description:"",permission_ids:[]},formRules:{name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],permission_ids:[{type:"array",min:1,message:"至少必须选择一個权限",trigger:"change"}]}}},created(){this.fetchRoles(),this.fetchAllPermissions()},methods:{translateCategory(e){const a={General:"通用权限",UserManagement:"用户管理",BetManagement:"注单管理",ReportManagement:"报表与钱包",System:"系统管理 (高风险)"};return a[e]||e},async fetchRoles(){this.loading=!0;try{this.rolesList=await this.$api.getRoles()}catch(e){console.error("Failed to fetch roles:",e)}finally{this.loading=!1}},async fetchAllPermissions(){try{this.allPermissions=await this.$api.getAllPermissions()}catch(e){console.error("Failed to fetch all permissions:",e),p.nk.error("無法载入权限列表，请刷新页面")}},resetForm(){Object.assign(this.roleForm,{id:null,name:"",description:"",permission_ids:[]})},handleAddRole(){this.dialogTitle="新增权限组",this.isEditMode=!1,this.resetForm(),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.roleFormRef?.clearValidate()})},async handleEditRole(e){this.dialogTitle=`编辑权限组: ${e.name}`,this.isEditMode=!0,this.resetForm(),this.dialogVisible=!0,this.dialogLoading=!0;try{const a=await this.$api.getRoleDetails(e.id);Object.assign(this.roleForm,{id:a.id,name:a.name,description:a.description||"",permission_ids:a.permission_ids||[]}),this.$nextTick(()=>{this.$refs.roleFormRef?.clearValidate()})}catch(a){console.error("Failed to fetch role details:",a),this.dialogVisible=!1}finally{this.dialogLoading=!1}},async handleSubmit(){const e=this.$refs.roleFormRef;e&&await e.validate(async e=>{if(!e)return!1;this.submitLoading=!0;try{const e={name:this.roleForm.name,description:this.roleForm.description,permission_ids:this.roleForm.permission_ids};this.isEditMode?(await this.$api.updateRole(this.roleForm.id,e),p.nk.success("权限组更新成功")):(await this.$api.addRole(e),p.nk.success("权限组新增成功")),this.dialogVisible=!1,await this.fetchRoles()}catch(a){console.error("Failed to submit role:",a)}finally{this.submitLoading=!1}})},handleDeleteRole(e){[1,2,3].includes(e.id)?p.nk.warning("不能刪除系统预设角色"):b.s.confirm(`确定要刪除权限组 "${e.name}" 吗？ (使用此权限组的帐号将失去所有权限)`,"警告",{confirmButtonText:"确定刪除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.deleteRole(e.id),p.nk.success("权限组刪除成功"),await this.fetchRoles()}catch(a){console.error("Failed to delete role:",a)}}).catch(()=>{})},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}}}},ei=(0,o.A)(Jl,[["render",Kl],["__scopeId","data-v-305810ed"]]),ai=ei,ti={class:"ip-whitelist-container"},li={class:"page-description"};function ii(e,a,t,l,s,o){const n=(0,r.g2)("el-alert"),d=(0,r.g2)("el-input"),u=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-button"),m=(0,r.g2)("el-form"),p=(0,r.g2)("el-card"),h=(0,r.g2)("el-table-column"),g=(0,r.g2)("el-table"),b=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",ti,[a[6]||(a[6]=(0,r.Lk)("h2",null,"後台ip白名单",-1)),(0,r.Lk)("p",li,[(0,r.bF)(n,{type:"warning","show-icon":"",closable:!1},{default:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.Lk)("strong",null,"警告：",-1),(0,r.eW)(" 此功能启用後，只有列表中的 IP 才能访问後台。 ",-1),(0,r.Lk)("br",null,null,-1),(0,r.eW)(" 如果您不确定自己的公网 IP，请在新增前查询，并使用 /32 格式 (例如 123.123.123.123/32)。 ",-1),(0,r.Lk)("br",null,null,-1),(0,r.eW)(" 如果白名单为空，則允许所有 IP 访问 (安全模式)。 ",-1)])]),_:1})]),(0,r.bF)(p,{shadow:"never",class:"add-card"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{ref:"addFormRef",model:s.addForm,rules:s.addFormRules,inline:!0,onSubmit:(0,i.D$)(o.handleAddIp,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"IP / CIDR",prop:"ip_range"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.addForm.ip_range,"onUpdate:modelValue":a[0]||(a[0]=e=>s.addForm.ip_range=e),placeholder:"例如: 123.123.123.123/32"},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"描述 (选填)"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.addForm.description,"onUpdate:modelValue":a[1]||(a[1]=e=>s.addForm.description=e),placeholder:"例如: 办公室 IP"},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",onClick:o.handleAddIp,loading:s.addLoading},{default:(0,r.k6)(()=>[...a[3]||(a[3]=[(0,r.eW)("新增",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(p,{shadow:"never",class:"table-card"},{header:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.Lk)("div",null,"IP 白名单列表",-1)])]),default:(0,r.k6)(()=>[(0,r.bF)(g,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(h,{prop:"ip_range",label:"IP / CIDR 范围"}),(0,r.bF)(h,{prop:"description",label:"描述"}),(0,r.bF)(h,{prop:"created_at",label:"新增时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1}),(0,r.bF)(h,{label:"操作",width:"100",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.bF)(c,{type:"danger",link:"",onClick:a=>o.handleDelete(e.row)},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})),[[b,s.loading]])])}const ri={name:"IpWhitelistView",data(){return{loading:!0,addLoading:!1,tableData:[],addForm:{ip_range:"",description:""},addFormRules:{ip_range:[{required:!0,message:"请输入 IP / CIDR",trigger:"blur"},{pattern:/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))$/,message:"格式错误，请使用 CIDR (e.g., 1.2.3.4/32)",trigger:"blur"}]}}},created(){this.fetchWhitelist()},methods:{async fetchWhitelist(){this.loading=!0;try{this.tableData=await this.$api.getIpWhitelist()}catch(e){console.error("Failed to fetch IP whitelist:",e)}finally{this.loading=!1}},async handleAddIp(){const e=this.$refs.addFormRef;e&&await e.validate(async a=>{if(!a)return!1;this.addLoading=!0;try{await this.$api.addIpToWhitelist(this.addForm),p.nk.success("IP 新增成功"),e.resetFields(),await this.fetchWhitelist()}catch(t){console.error("Failed to add IP:",t)}finally{this.addLoading=!1}})},handleDelete(e){b.s.confirm(`确定要刪除 IP 规則 "${e.ip_range}" 吗？`,"警告",{confirmButtonText:"确定刪除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await this.$api.deleteIpFromWhitelist(e.id),p.nk.success("IP 规則刪除成功"),await this.fetchWhitelist()}catch(a){console.error("Failed to delete IP:",a)}}).catch(()=>{})},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}}}},si=(0,o.A)(ri,[["render",ii],["__scopeId","data-v-474d76aa"]]),oi=si,ni={class:"audit-logs-container"};function di(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),c=(0,r.g2)("el-select"),m=(0,r.g2)("el-date-picker"),p=(0,r.g2)("el-button"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-card"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-table"),_=(0,r.g2)("el-pagination"),k=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",ni,[a[6]||(a[6]=(0,r.Lk)("h2",null,"操作稽核日志",-1)),a[7]||(a[7]=(0,r.Lk)("p",{class:"page-description"},[(0,r.eW)(" 查看所有后台操作记录，包含管理员、动作、资源与时间。 "),(0,r.Lk)("br"),(0,r.Lk)("strong",null,"资源（Resource）"),(0,r.eW)("：表示被操作的对象类型，例如「用户」、「平台钱包」、「提款」等。 "),(0,r.Lk)("br"),(0,r.Lk)("strong",null,"资源ID（Resource ID）"),(0,r.eW)("：表示被操作的具体对象ID，例如用户ID、钱包ID、提款单ID等。 ")],-1)),(0,r.bF)(g,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"管理员帐号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.adminUsername,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.adminUsername=e),placeholder:"帐号 (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"动作"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.searchParams.action,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.action=e),placeholder:"选择动作",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.availableActions,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"时间范围"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","unlink-panels":"",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(f,{data:s.tableData,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"admin_username",label:"管理员",width:"150"}),(0,r.bF)(b,{prop:"action",label:"动作",width:"160"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatAction(e.row.action)),1)]),_:1}),(0,r.bF)(b,{prop:"resource",label:"被操作对象",width:"160"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatResource(e.row.resource)),1)]),_:1}),(0,r.bF)(b,{prop:"resource_id",label:"被操作对象ID",width:"120"}),(0,r.bF)(b,{prop:"description",label:"描述","min-width":"220"}),(0,r.bF)(b,{prop:"ip_address",label:"IP",width:"140"}),(0,r.bF)(b,{prop:"user_agent",label:"User Agent","min-width":"220"}),(0,r.bF)(b,{prop:"created_at",label:"时间",width:"180",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDate(e.row.created_at)),1)]),_:1})]),_:1},8,["data"]),(0,r.bF)(_,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[3]||(a[3]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[4]||(a[4]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[k,s.loading]])])}const ui=()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]},ci=e=>{if(!Array.isArray(e)||2!==e.length)return null;const[a,t]=e,l=a instanceof Date&&!isNaN(a)?a.toISOString():null,i=t instanceof Date&&!isNaN(t)?t.toISOString():null;return l&&i?[l,i]:null},mi={name:"AuditLogsView",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:20},searchParams:{adminUsername:"",action:"",dateRange:ui()},availableActions:[{value:"update_user",label:"更新用户资料"},{value:"update_user_status",label:"更新用户状态"},{value:"create_wallet",label:"新增钱包"},{value:"update_wallet",label:"更新钱包"},{value:"delete_wallet",label:"删除钱包"},{value:"update_setting",label:"更新系统设定"},{value:"create_admin_account",label:"新增后台帐号"},{value:"update_admin_account",label:"更新后台帐号"},{value:"delete_admin_account",label:"删除后台帐号"},{value:"add_ip_whitelist",label:"新增IP白名单"},{value:"delete_ip_whitelist",label:"删除IP白名单"},{value:"create_role",label:"新增权限组"},{value:"update_role",label:"更新权限组"},{value:"delete_role",label:"删除权限组"},{value:"approve_withdrawal",label:"批准提款"},{value:"reject_withdrawal",label:"拒绝提款"},{value:"complete_withdrawal",label:"完成提款"}],actionMap:{update_user:"更新用户资料",update_user_status:"更新用户状态",create_wallet:"新增钱包",update_wallet:"更新钱包",delete_wallet:"删除钱包",update_setting:"更新系统设定",create_admin_account:"新增后台帐号",update_admin_account:"更新后台帐号",delete_admin_account:"删除后台帐号",add_ip_whitelist:"新增IP白名单",delete_ip_whitelist:"删除IP白名单",create_role:"新增权限组",update_role:"更新权限组",delete_role:"删除权限组",approve_withdrawal:"批准提款",reject_withdrawal:"拒绝提款",complete_withdrawal:"完成提款"},resourceMap:{users:"用户",platform_wallets:"平台钱包",system_settings:"系统设定",admin_users:"后台帐号",admin_ip_whitelist:"IP白名单",admin_roles:"权限组",withdrawals:"提款"}}},created(){this.handleSearch()},methods:{async fetchLogs(){if(!this.loading){this.loading=!0;try{const e=ci(this.searchParams.dateRange),a={...this.pagination,adminUsername:this.searchParams.adminUsername||void 0,action:this.searchParams.action||void 0,dateRange:e?JSON.stringify(e):void 0},t=await this.$api.getAuditLogs(a);this.tableData=t.list||[],this.totalItems=t.total||0}catch(e){console.error("Failed to fetch audit logs:",e)}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchLogs()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchLogs()},handlePageChange(e){this.pagination.page=e,this.fetchLogs()},formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}},formatAction(e){return this.actionMap[e]||e||"-"},formatResource(e){return this.resourceMap[e]||e||"-"}}},pi=(0,o.A)(mi,[["render",di],["__scopeId","data-v-7d1b27ec"]]),hi=pi,gi={class:"collection-logs-container"},bi={key:0,class:"tx-hash"},fi={key:1,class:"no-tx"},_i={key:0},ki={key:1},vi={key:0,class:"error-message"},Fi={key:1};function wi(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),c=(0,r.g2)("el-select"),m=(0,r.g2)("el-date-picker"),p=(0,r.g2)("el-button"),h=(0,r.g2)("el-form"),g=(0,r.g2)("el-card"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-tag"),_=(0,r.g2)("el-table"),k=(0,r.g2)("el-pagination"),v=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",gi,[a[8]||(a[8]=(0,r.Lk)("h2",null,"归集记录",-1)),a[9]||(a[9]=(0,r.Lk)("p",{class:"page-description"},"查询和管理用户充值地址的归集记录。",-1)),(0,r.bF)(g,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.userId=e),placeholder:"用户ID (模糊)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"用户充值地址"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.user_deposit_address,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.user_deposit_address=e),placeholder:"充值地址 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"归集钱包地址"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.collection_wallet_address,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.collection_wallet_address=e),placeholder:"归集地址 (精确)",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"狀态"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.searchParams.status,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.status=e),placeholder:"选择狀态",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"全部",value:""}),(0,r.bF)(u,{label:"已完成",value:"completed"}),(0,r.bF)(u,{label:"失败",value:"failed"}),(0,r.bF)(u,{label:"处理中",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"时间"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[4]||(a[4]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:"","unlink-panels":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",onClick:o.handleSearch,loading:s.loading},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{data:s.tableData,style:{width:"100%"},"show-summary":"","summary-method":o.renderSummary},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"user_id",label:"用户ID",width:"120"}),(0,r.bF)(b,{prop:"username",label:"用户名",width:"150"}),(0,r.bF)(b,{label:"用户充值地址",width:"200"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.user_deposit_address_masked||e.row.user_deposit_address),1)]),_:1}),(0,r.bF)(b,{label:"归集钱包地址",width:"200"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.collection_wallet_address_masked||e.row.collection_wallet_address),1)]),_:1}),(0,r.bF)(b,{prop:"amount",label:"归集金额",width:"120"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatCurrency(e.row.amount))+" USDT ",1)]),_:1}),(0,r.bF)(b,{prop:"tx_hash",label:"交易Hash",width:"200"},{default:(0,r.k6)(e=>[e.row.tx_hash?((0,r.uX)(),(0,r.CE)("span",bi,(0,we.v_)(e.row.tx_hash_masked||e.row.tx_hash),1)):((0,r.uX)(),(0,r.CE)("span",fi,"-"))]),_:1}),(0,r.bF)(b,{prop:"energy_used",label:"能量消耗",width:"120"},{default:(0,r.k6)(e=>[e.row.energy_used?((0,r.uX)(),(0,r.CE)("span",_i,(0,we.v_)(e.row.energy_used.toLocaleString()),1)):((0,r.uX)(),(0,r.CE)("span",ki,"-"))]),_:1}),(0,r.bF)(b,{prop:"status",label:"狀态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{type:o.getStatusType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,we.v_)(o.getStatusText(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(b,{prop:"error_message",label:"错误讯息","min-width":"200"},{default:(0,r.k6)(e=>[e.row.error_message?((0,r.uX)(),(0,r.CE)("span",vi,(0,we.v_)(e.row.error_message),1)):((0,r.uX)(),(0,r.CE)("span",Fi,"-"))]),_:1}),(0,r.bF)(b,{prop:"created_at",label:"归集时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1})]),_:1},8,["data","summary-method"]),(0,r.bF)(k,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[5]||(a[5]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[6]||(a[6]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[v,s.loading]])])}const yi=()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date;return a.setHours(23,59,59,999),[e,a]},Ci=e=>{if(!Array.isArray(e)||2!==e.length)return null;const[a,t]=e,l=a instanceof Date&&!isNaN(a)?a.toISOString():null,i=t instanceof Date&&!isNaN(t)?t.toISOString():null;return l&&i?[l,i]:null},Di={name:"CollectionLogsView",data(){return{loading:!1,tableData:[],totalItems:0,pageTotalAmount:0,totalAmount:0,pagination:{page:1,limit:10},searchParams:{userId:"",user_deposit_address:"",collection_wallet_address:"",status:"",dateRange:yi()}}},created(){this.handleSearch()},methods:{async fetchLogs(){if(!this.loading){this.loading=!0;try{const e=Ci(this.searchParams.dateRange),a={...this.pagination,userId:this.searchParams.userId||void 0,user_deposit_address:this.searchParams.user_deposit_address||void 0,collection_wallet_address:this.searchParams.collection_wallet_address||void 0,status:this.searchParams.status||void 0,dateRange:e?JSON.stringify(e):void 0},t=await this.$api.getCollectionLogs(a);this.tableData=t.list,this.totalItems=t.total,this.pageTotalAmount=t.pageTotalAmount||0,this.totalAmount=t.totalAmount||0}catch(e){console.error("Failed to fetch collection logs:",e),p.nk.error("载入归集记录失败")}finally{this.loading=!1}}},handleSearch(){this.pagination.page=1,this.fetchLogs()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchLogs()},handlePageChange(e){this.pagination.page=e,this.fetchLogs()},formatCurrency(e){if(null===e||void 0===e)return"0.00";const a=parseFloat(e);return isNaN(a)?"0.00":a.toFixed(2)},formatDateTime(e){if(!e)return"-";const a=new Date(e);return a.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},getStatusType(e){const a={completed:"success",failed:"danger",pending:"warning"};return a[e]||"info"},getStatusText(e){const a={completed:"已完成",failed:"失败",pending:"处理中"};return a[e]||e},renderSummary({columns:e}){const a=[];return e.forEach((e,t)=>{if("amount"===e.property){const e=`${this.formatCurrency(this.pageTotalAmount)} USDT`,l=`${this.formatCurrency(this.totalAmount)} USDT`;a[t]=`页面总计：${e}\n全部查询结果总计：${l}`}else a[t]=""}),a}}},Li=(0,o.A)(Di,[["render",wi],["__scopeId","data-v-1b00014f"]]),Vi=Li,Pi={class:"login-query-container"},Ii={key:1},Wi={key:1},Si={key:1},Ti={key:1},xi={key:1},Ri={key:1},Ui={class:"detail-header"};function $i(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-date-picker"),c=(0,r.g2)("el-button"),m=(0,r.g2)("el-form"),p=(0,r.g2)("el-card"),h=(0,r.g2)("el-table-column"),g=(0,r.g2)("el-table"),b=(0,r.g2)("el-pagination"),f=(0,r.g2)("el-dialog"),_=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Pi,[a[13]||(a[13]=(0,r.Lk)("h2",null,"登录查询",-1)),(0,r.bF)(p,{shadow:"never",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{inline:!0,model:s.searchParams,onSubmit:(0,i.D$)(o.handleSearch,["prevent"]),class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户ID"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchParams.userId=e),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"登录IP"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.loginIp,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchParams.loginIp=e),placeholder:"请输入登录IP查询",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"注册IP"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.registrationIp,"onUpdate:modelValue":a[2]||(a[2]=e=>s.searchParams.registrationIp=e),placeholder:"请输入注册IP",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"下注IP"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.searchParams.betIp,"onUpdate:modelValue":a[3]||(a[3]=e=>s.searchParams.betIp=e),placeholder:"请输入下注IP查询",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"日期"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.searchParams.dateRange,"onUpdate:modelValue":a[4]||(a[4]=e=>s.searchParams.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DDTHH:mm:ssZ",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",onClick:o.handleSearch},{default:(0,r.k6)(()=>[...a[9]||(a[9]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"]),(0,r.bF)(c,{onClick:o.handleExport},{default:(0,r.k6)(()=>[...a[10]||(a[10]=[(0,r.eW)("导出",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onSubmit"])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(p,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{data:s.tableData,style:{width:"100%"},"cell-style":{paddingTop:"8px",paddingBottom:"8px"}},{default:(0,r.k6)(()=>[(0,r.bF)(h,{prop:"user_id",label:"用户ID",width:"120",fixed:"left"}),(0,r.bF)(h,{prop:"username",label:"用户帐号",width:"150"}),(0,r.bF)(h,{prop:"first_login_country",label:"首次登陆地区",width:"150"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(e.row.first_login_country||"-"),1)]),_:1}),(0,r.bF)(h,{label:"登陆同IP",width:"130"},{default:(0,r.k6)(e=>[e.row.same_login_ip_count>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",link:"",onClick:a=>o.showDetailDialog("loginIp",e.row)},{default:(0,r.k6)(()=>[(0,r.eW)(" 重复IP("+(0,we.v_)(e.row.same_login_ip_count)+") ",1)]),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.CE)("span",Ii,"-"))]),_:1}),(0,r.bF)(h,{label:"注册同IP",width:"130"},{default:(0,r.k6)(e=>[e.row.same_registration_ip_count>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",link:"",onClick:a=>o.showDetailDialog("registrationIp",e.row)},{default:(0,r.k6)(()=>[(0,r.eW)(" 重复IP("+(0,we.v_)(e.row.same_registration_ip_count)+") ",1)]),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.CE)("span",Wi,"-"))]),_:1}),(0,r.bF)(h,{label:"下注同IP",width:"130"},{default:(0,r.k6)(e=>[e.row.same_bet_ip_count>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",link:"",onClick:a=>o.showDetailDialog("betIp",e.row)},{default:(0,r.k6)(()=>[(0,r.eW)(" 重复IP("+(0,we.v_)(e.row.same_bet_ip_count)+") ",1)]),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.CE)("span",Si,"-"))]),_:1}),(0,r.bF)(h,{label:"注册同密码",width:"130"},{default:(0,r.k6)(e=>[e.row.same_registration_password_count>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",link:"",onClick:a=>o.showDetailDialog("registrationPassword",e.row)},{default:(0,r.k6)(()=>[(0,r.eW)(" 同密码("+(0,we.v_)(e.row.same_registration_password_count)+") ",1)]),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.CE)("span",Ti,"-"))]),_:1}),(0,r.bF)(h,{label:"资金同密码",width:"130"},{default:(0,r.k6)(e=>[e.row.same_withdrawal_password_count>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",link:"",onClick:a=>o.showDetailDialog("withdrawalPassword",e.row)},{default:(0,r.k6)(()=>[(0,r.eW)(" 同密码("+(0,we.v_)(e.row.same_withdrawal_password_count)+") ",1)]),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.CE)("span",xi,"-"))]),_:1}),(0,r.bF)(h,{label:"同设备ID",width:"130"},{default:(0,r.k6)(e=>[e.row.same_device_id_count>0?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"primary",link:"",onClick:a=>o.showDetailDialog("deviceId",e.row)},{default:(0,r.k6)(()=>[(0,r.eW)(" 同设备ID("+(0,we.v_)(e.row.same_device_id_count)+") ",1)]),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.CE)("span",Ri,"-"))]),_:1}),(0,r.bF)(h,{prop:"created_at",label:"注册时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.created_at)),1)]),_:1})]),_:1},8,["data"]),(0,r.bF)(b,{class:"pagination-container",layout:"total, sizes, prev, pager, next, jumper",total:s.totalItems,"current-page":s.pagination.page,"onUpdate:currentPage":a[5]||(a[5]=e=>s.pagination.page=e),"page-size":s.pagination.limit,"onUpdate:pageSize":a[6]||(a[6]=e=>s.pagination.limit=e),"page-sizes":[10,20,50,100],onSizeChange:o.handleSizeChange,onCurrentChange:o.handlePageChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])]),_:1})),[[_,s.loading]]),(0,r.bF)(f,{modelValue:s.detailDialogVisible,"onUpdate:modelValue":a[8]||(a[8]=e=>s.detailDialogVisible=e),title:s.detailDialogTitle,width:"800px","close-on-click-modal":!1},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Ui,[(0,r.bF)(m,{inline:!0},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"日期:"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.detailDateRange,"onUpdate:modelValue":a[7]||(a[7]=e=>s.detailDateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DDTHH:mm:ssZ",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",onClick:o.fetchDetailData},{default:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)("查询",-1)])]),_:1},8,["onClick"]),(0,r.bF)(c,{onClick:o.handleDetailExport},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("导出",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{data:s.detailData,style:{"margin-top":"20px"}},{default:(0,r.k6)(()=>[(0,r.bF)(h,{prop:"user_id",label:"玩家ID",width:"120"}),"loginIp"===s.detailType||"registrationIp"===s.detailType||"betIp"===s.detailType?((0,r.uX)(),(0,r.Wv)(h,{key:0,prop:"betIp"===s.detailType?"bet_ip":"registrationIp"===s.detailType?"registration_ip":"login_ip",label:"IP地址",width:"150"},null,8,["prop"])):(0,r.Q3)("",!0),"registrationPassword"===s.detailType||"withdrawalPassword"===s.detailType?((0,r.uX)(),(0,r.Wv)(h,{key:1,prop:"masked_password",label:"密码",width:"200"})):(0,r.Q3)("",!0),"deviceId"===s.detailType?((0,r.uX)(),(0,r.Wv)(h,{key:2,prop:"device_id",label:"设备ID",width:"200"})):(0,r.Q3)("",!0),(0,r.bF)(h,{prop:"registration_time",label:"注册时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.registration_time)),1)]),_:1}),(0,r.bF)(h,{prop:"last_login_time",label:"登录时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,we.v_)(o.formatDateTime(e.row.last_login_time)),1)]),_:1})]),_:1},8,["data"])),[[_,s.detailLoading]])]),_:1},8,["modelValue","title"])])}const Ai={name:"LoginQueryView",data(){return{loading:!1,tableData:[],totalItems:0,pagination:{page:1,limit:20},searchParams:{userId:"",loginIp:"",registrationIp:"",betIp:"",dateRange:null},detailDialogVisible:!1,detailDialogTitle:"",detailType:"",detailUserId:"",detailData:[],detailLoading:!1,detailDateRange:null}},created(){this.fetchData()},methods:{async fetchData(){if(!this.loading){this.loading=!0;try{const e={...this.pagination,userId:this.searchParams.userId||void 0,loginIp:this.searchParams.loginIp||void 0,registrationIp:this.searchParams.registrationIp||void 0,betIp:this.searchParams.betIp||void 0,dateRange:this.searchParams.dateRange?JSON.stringify(this.searchParams.dateRange):void 0},a=await this.$api.getLoginQuery(e);this.tableData=a.list,this.totalItems=a.total}catch(e){console.error("Failed to fetch login query data:",e),p.nk.error("加载数据失败")}finally{this.loading=!1}}},async showDetailDialog(e,a){this.detailType=e,this.detailUserId=a.user_id,this.detailDateRange=null,this.detailData=[];const t={loginIp:"详情",registrationIp:"详情",betIp:"详情",registrationPassword:"详情",withdrawalPassword:"详情",deviceId:"详情"};this.detailDialogTitle=t[e]||"详情",this.detailDialogVisible=!0,await this.fetchDetailData()},async fetchDetailData(){this.detailLoading=!0;try{const e={loginIp:`/login-query/same-login-ip/${this.detailUserId}`,registrationIp:`/login-query/same-registration-ip/${this.detailUserId}`,betIp:`/login-query/same-bet-ip/${this.detailUserId}`,registrationPassword:`/login-query/same-registration-password/${this.detailUserId}`,withdrawalPassword:`/login-query/same-withdrawal-password/${this.detailUserId}`,deviceId:`/login-query/same-device-id/${this.detailUserId}`},a=e[this.detailType];if(!a)return void p.nk.error("未知的详情类型");const t=await this.$api.getLoginQueryDetail(a);if(this.detailData=t.list||[],this.detailDateRange&&2===this.detailDateRange.length){const[e,a]=this.detailDateRange;this.detailData=this.detailData.filter(t=>{const l=new Date(t.last_login_time);return l>=new Date(e)&&l<=new Date(a)})}}catch(e){console.error("Failed to fetch detail data:",e),p.nk.error("加载详情数据失败")}finally{this.detailLoading=!1}},handleSearch(){this.pagination.page=1,this.fetchData()},handleSizeChange(e){this.pagination.limit=e,this.pagination.page=1,this.fetchData()},handlePageChange(e){this.pagination.page=e,this.fetchData()},handleExport(){p.nk.info("导出功能开发中")},handleDetailExport(){p.nk.info("导出功能开发中")},formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"})}catch(a){return e}}}},Xi=(0,o.A)(Ai,[["render",$i],["__scopeId","data-v-365c2708"]]),Ei=Xi,zi=[{path:"/login",name:"Login",component:Ve},{path:"/",component:Te,redirect:"/dashboard",children:[{path:"dashboard",name:"Dashboard",component:Ya,meta:{requiresAuth:!0,permission:"dashboard:read"}},{path:"users",name:"UserManagement",component:lt,meta:{requiresAuth:!0,permission:"users:read"}},{path:"users/deposit-addresses",name:"UserDepositAddresses",component:nt,meta:{requiresAuth:!0,permission:"users_addresses:read"}},{path:"users/login-query",name:"LoginQuery",component:Ei,meta:{requiresAuth:!0,permission:"users:read"}},{path:"bets",name:"BetManagement",component:kt,meta:{requiresAuth:!0,permission:"bets:read"}},{path:"reports",name:"ReportManagement",component:Bt,meta:{requiresAuth:!0,permission:"reports:read"}},{path:"collection-logs",name:"CollectionLogs",component:Vi,meta:{requiresAuth:!0,permission:"reports:read"}},{path:"wallet-monitoring",name:"WalletMonitoring",component:jt,meta:{requiresAuth:!0,permission:"wallets:read"}},{path:"finance/withdrawals",name:"WithdrawalReview",component:ol,meta:{requiresAuth:!0,permission:"withdrawals:read"}},{path:"finance/deposits",name:"DepositHistory",component:gl,meta:{requiresAuth:!0,permission:"deposits:read"}},{path:"/settings/game-parameters",name:"GameParameters",component:Dl,meta:{requiresAuth:!0,permission:"settings_game:read"}},{path:"/settings/blocked-regions",name:"BlockedRegions",component:$l,meta:{requiresAuth:!0,permission:"settings_regions:read"}},{path:"/settings/user-levels",name:"UserLevels",component:Nl,meta:{requiresAuth:!0,permission:"settings_levels:read"}},{path:"/risk/same-ip",name:"SameIpMonitor",component:Sl,meta:{requiresAuth:!0,permission:"users:update_status"}},{path:"/admin/accounts",name:"AccountManagement",component:Hl,meta:{requiresAuth:!0,permission:"admin_accounts:read"}},{path:"/admin/permissions",name:"Permissions",component:ai,meta:{requiresAuth:!0,permission:"admin_permissions:read"}},{path:"/admin/ip-whitelist",name:"IpWhitelist",component:oi,meta:{requiresAuth:!0,permission:"admin_ip_whitelist:read"}},{path:"/admin/audit-logs",name:"AuditLogs",component:hi,meta:{requiresAuth:!0,permission:"admin_permissions:read"}}]}],Mi=(0,c.aE)({history:(0,c.LA)("/admin/"),routes:zi});Mi.beforeEach(async(e,a,t)=>{const l=localStorage.getItem("admin_token");if(e.meta.requiresAuth)if(l)try{const a=(0,m.s)(l);if(1e3*a.exp<Date.now())throw new Error("Token expired");Fe.isLoaded||(console.log("[Router Guard] Token valid, loading permissions..."),await Fe.loadPermissions());const i=e.meta.permission;if(i){const[a,l]=i.split(":");if(!Fe.has(a,l))return console.warn(`[Router Guard] Denied. Role does not have permission ${i} for route ${e.name}.`),p.nk.warning("您的权限不足，無法访问此页面。"),"Dashboard"===e.name?(localStorage.removeItem("admin_token"),Fe.clearPermissions(),t({name:"Login"})):t({name:"Dashboard"})}t()}catch(i){return console.error("Router Guard: Token/Permission check failed.",i.message),localStorage.removeItem("admin_token"),Fe.clearPermissions(),t({name:"Login"})}else Fe.clearPermissions(),t({name:"Login"});else l&&"Login"===e.name?t({name:"Dashboard"}):t()});const Ni=Mi;var Bi=t(5369);t(4188);const Oi=(0,i.Ef)(u);Oi.config.globalProperties.$api=l,Oi.config.globalProperties.$permissions=Fe,Oi.use(Ni),Oi.use(Bi.A),Oi.mount("#app")}},a={};function t(l){var i=a[l];if(void 0!==i)return i.exports;var r=a[l]={exports:{}};return e[l].call(r.exports,r,r.exports,t),r.exports}t.m=e,(()=>{var e=[];t.O=(a,l,i,r)=>{if(!l){var s=1/0;for(u=0;u<e.length;u++){for(var[l,i,r]=e[u],o=!0,n=0;n<l.length;n++)(!1&r||s>=r)&&Object.keys(t.O).every(e=>t.O[e](l[n]))?l.splice(n--,1):(o=!1,r<s&&(s=r));if(o){e.splice(u--,1);var d=i();void 0!==d&&(a=d)}}return a}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[l,i,r]}})(),(()=>{t.d=(e,a)=>{for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a)})(),(()=>{t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};t.O.j=a=>0===e[a];var a=(a,l)=>{var i,r,[s,o,n]=l,d=0;if(s.some(a=>0!==e[a])){for(i in o)t.o(o,i)&&(t.m[i]=o[i]);if(n)var u=n(t)}for(a&&a(l);d<s.length;d++)r=s[d],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(u)},l=self["webpackChunkadmin_ui"]=self["webpackChunkadmin_ui"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))})();var l=t.O(void 0,[504],()=>t(6726));l=t.O(l)})();